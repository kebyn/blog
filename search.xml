<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>JAR_WAR_EAR</title>
    <url>/2016/06/20/JAR_WAR_EAR/</url>
    <content><![CDATA[<h5 id="本篇探討-EAR、JAR、WAR-之間的異同，主要目的都是將-Java-封裝成檔案，便於存放管理，事實上三者皆採用-zip-或-jar-檔案文件壓縮，但使用目地有其差異："><a href="#本篇探討-EAR、JAR、WAR-之間的異同，主要目的都是將-Java-封裝成檔案，便於存放管理，事實上三者皆採用-zip-或-jar-檔案文件壓縮，但使用目地有其差異：" class="headerlink" title="本篇探討 EAR、JAR、WAR 之間的異同，主要目的都是將 Java 封裝成檔案，便於存放管理，事實上三者皆採用 zip 或 jar 檔案文件壓縮，但使用目地有其差異："></a>本篇探討 EAR、JAR、WAR 之間的異同，主要目的都是將 Java 封裝成檔案，便於存放管理，事實上三者皆採用 zip 或 jar 檔案文件壓縮，但使用目地有其差異：</h5><span id="more"></span>
<h3 id="JAR"><a href="#JAR" class="headerlink" title="JAR"></a>JAR</h3><p>全寫為 Java Archive ，包括 JavaBeans 、Java Classes、資源 (Resources)、輔助文件 (auxilary files)、Property 等，目的是為了產了 Java Library 用，且可以將好幾個 java 內容成單一檔案，是文件封裝的最小單位。</p>
<p>部署文件：application-client.xml</p>
<h3 id="WAR"><a href="#WAR" class="headerlink" title="WAR"></a>WAR</h3><p>全寫為 Web Archive，包括全部的 Web 內容，像是 Servlet class files、JSP、GIF、HTML、tag、library、xml 等等，目的是為了包括全部的 Web Application</p>
<p>部署文件：web.xml</p>
<h3 id="EAR"><a href="#EAR" class="headerlink" title="EAR"></a>EAR</h3><p>全寫為 Enterprise Archive ，包括以上全部的應用程序 (.jar) 及 (.war)，封裝成 .ear 檔之後，可 deploy 到 application server</p>
<p>部署文件：application.xml</p>
<p>每一種文件（.jar, .war, .ear）只能由應用服務器（application servers）、小型服務程序容器（servlet containers）、EJB容器（EJB containers）等進行處理。</p>
]]></content>
      <tags>
        <tag>jar</tag>
        <tag>war</tag>
        <tag>ear</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>apache_conf</title>
    <url>/2014/04/06/apache_configuration_explanation/</url>
    <content><![CDATA[<ol>
<li>尽量安装新版本的Apache<span id="more"></span></li>
<li>禁用不需要的模块，找到httpd.conf的loadModule行，对于不需要的用#注释掉</li>
<li>设置Apache的bin、conf、logs目录属主为root，权限为755</li>
<li>将Apache以专用的用户身份运行，配置httpd.conf<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">User www-data</span><br><span class="line">Group www-data</span><br></pre></td></tr></table></figure></li>
<li>禁止目录索引，关闭服务端SSI包含<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;Directory/var/www/html&gt;</span><br><span class="line">    Options -Indexes -Includes</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></li>
<li>禁止对目录配置文件进行重载<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;Directory/&gt;</span><br><span class="line">    AllowOverride None</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></li>
<li>仅允许访问指定目录。对根目录设置禁止访问，然后对需要让用户访问的目录开放访问权限<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;Directory/&gt;</span><br><span class="line">    Order deny,allow</span><br><span class="line">    Deny from all</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line">&lt;Directory&quot;/var/www/www.example.com&quot;&gt;</span><br><span class="line">    Order allow,deny</span><br><span class="line">    Allow from all</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></li>
<li>隐藏特征，不展示Web服务器类型和版本<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ServerSignatureOff</span><br><span class="line">ServerTokensProd</span><br></pre></td></tr></table></figure></li>
<li>目录访问限制，可以设置重要目录只允许特定的IP访问<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;Directory&quot;/var/www/www.example.com/admin&quot;&gt;</span><br><span class="line">    order deny,allow</span><br><span class="line">    denyfrom all</span><br><span class="line">    allowfrom 10.1.0.0/16</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <tags>
        <tag>httpd</tag>
        <tag>conf</tag>
        <tag>apache</tag>
        <tag>note</tag>
      </tags>
  </entry>
  <entry>
    <title>架构</title>
    <url>/2017/02/16/architecture_design/</url>
    <content><![CDATA[<ol>
<li>DNS服务器<ul>
<li>如果资金充足的话，建议使用<code>BGP</code>机房，2-3台DNS服务器均衡，通常使用bind软件。<ul>
<li><code>BGP</code>（边界网关协议）主要用于互联网AS（自治系统）之间的互联，<code>BGP</code>的最主要功能在于控制路由的传播和选择最好的路由。<ul>
<li>中国网通 、中国电信、中国铁通和一些大的民营IDC运营商都具有AS号，全国各大网络运营商多数都是通过<code>BGP</code>协议与自身的AS号来实现多线互联的。</li>
<li>使用此方案来实现多线路互联，IDC需要在<code>CNNIC</code>（中国互联网信息中心）或APNIC（亚太网络信息中心）申请自己的IP地址段和AS号，然后通过<code>BGP</code>协议将此段IP地址广播到其它的网络运营商的网络中。</li>
<li>使用<code>BGP</code>协议互联后，网络运营商的所有骨干路由设备将会判断到IDC机房IP段的最佳路由，以保证不同网络运营商用户的高速访问。</li>
</ul>
</li>
<li><code>BGP</code> 机房的优点：<ol>
<li>服务器只需要设置一个IP地址，最佳访问路由是由网络上的骨干路由器根据路由跳数与其它技术指标来确定的，不会占用服务器的任何系统资源。</li>
<li>服务器的上行路由与下行路由都能选择最优的路径，所以能真正实现高速的单IP高速访问。</li>
<li>由于<code>BGP</code>协议本身具有冗余备份、消除环路的特点，所以当IDC服务商有多条<code>BGP</code>互联线路时可以实现路由的相互备份，在一条线路出现故障时路由会自动切换到其它线路。</li>
<li>使用<code>BGP</code>协议还可以使网络具有很强的扩展性可以将IDC网络与其他运营商互联，轻松实现单IP多线路，做到所有互联运营商的用户访问都很快。这个是双IP双线无法比拟的。</li>
</ol>
</li>
</ul>
</li>
<li>如果资金紧的话，可以购买专业的dns服务，比如国内的<code>dnspod</code><span id="more"></span></li>
</ul>
</li>
<li>CDN服务器<ul>
<li>一开始如果想省事，可以买专业公司的服务，但随着发展成本会越来越高。<ul>
<li>思必达(<code>chinaspeeds</code>)、蓝汛(<code>chinacache</code>)</li>
</ul>
</li>
<li>自建的话，可能分别搭建，放电信、联通、移动等不同机房的服务器，通过<code>dns</code>做动态解析。<ul>
<li>超大网站的话，可以用<code>squid</code></li>
<li>普通中至大型用<code>nginx</code></li>
<li>内部玩玩用<code>varnish</code></li>
</ul>
</li>
</ul>
</li>
<li>前端均衡<ul>
<li>资金充足的话，可以使用硬件设备，几十万一台。<ul>
<li><code>F5</code></li>
<li><code>Radware</code>、<code>Array</code>、<code>A10</code>、<code>Cisco</code>、深信服和华夏创新等</li>
</ul>
</li>
<li>自已有技术队伍的<ul>
<li>就用<code>nginx</code>&#x2F;<code>haproxy</code>+<code>keepalived</code>等自已组建前端。<ul>
<li>均衡的方式都比较灵活，随机、权重、ip、url都有。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>同步的问题</li>
</ol>
<ul>
<li>普通的可以实时文件同步。</li>
<li>数据库同步。<ul>
<li>逻辑备份： 备份的是建表、建库、插入等操作所执行SQL语句，适用于中小型数据库，效率相对较低。<ul>
<li><code>mysqldump</code></li>
<li><code>mydumper</code></li>
</ul>
</li>
<li>物理备份： 直接复制数据库文件，适用于大型数据库环境，不受存储引擎的限制，但不能恢复到异构系统中如Windows。</li>
<li><code>xtrabackup</code></li>
<li><code>inbackup</code></li>
<li><code>lvm snapshot</code></li>
</ul>
</li>
</ul>
<ol start="5">
<li>后端的应用服务器和数据库集群</li>
</ol>
]]></content>
      <tags>
        <tag>note</tag>
      </tags>
  </entry>
  <entry>
    <title>ssh_tunnel</title>
    <url>/2017/06/03/autossh_instructions/</url>
    <content><![CDATA[<ol>
<li><a href="http://www.ruanyifeng.com/blog/2011/12/ssh_port_forwarding.html">ssh转发</a></li>
</ol>
<ul>
<li><code>ssh -N -f -L 5000:localhost:3306 root@23.226.78.113</code><blockquote>
<p>-N 不启动shell</p>
</blockquote>
<blockquote>
<p>-f 后台执行</p>
</blockquote>
<blockquote>
<p>-T不分配TTY</p>
</blockquote>
<blockquote>
<p>-D动态转发、 -L本地转发 、 -R 远程转发</p>
</blockquote>
<blockquote>
<blockquote>
<p>SSH 端口转发自然需要 SSH 连接，而 SSH 连接是有方向的，从 SSH Client 到 SSH Server 。而我们的应用也是有方向的，比如需要连接 Server 时 ，Server 自然就是 Server 端，我们应用连接的方向也是从应用的 Client 端连接到应用的 Server 端。如果这两个连接的方向一致，那我们就说它是本地转发。而如果两个方向不一致，我们就说它是远程转发。<a href="https://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/">本地转发与远程转发</a></p>
</blockquote>
</blockquote>
</li>
</ul>
<ol start="2">
<li><a href="http://www.harding.motd.ca/autossh/">autossh官方</a></li>
</ol>
<ul>
<li><a href="../text/README">README</a><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">autossh -M 0 -o &quot;ServerAliveInterval 30&quot; -o &quot;ServerAliveCountMax 3&quot; -L 5000:localhost:3306 root@23.226.78.113</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://www.everythingcli.org/ssh-tunnelling-for-fun-and-profit-autossh/">参考文档</a></p>
</blockquote>
<span id="more"></span></li>
</ul>
<ol start="3">
<li>systemctl<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">workspace:~$ cat autossh-mysql-tunnel.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=AutoSSH tunnel service everythingcli MySQL on local port 5000</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Environment=&quot;AUTOSSH_GATETIME=0&quot;</span><br><span class="line">ExecStart=/usr/bin/autossh -M 0 -o &quot;ServerAliveInterval 30&quot; -o &quot;ServerAliveCountMax 3&quot; -NL 5000:localhost:3306 root@23.226.78.113 -p 22</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li>
<li>测试ssh_tunnel稳定性<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">workspace:~$ cat ssh_tunnel.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">#kebyn</span><br><span class="line">#kebyn@sina.com</span><br><span class="line"></span><br><span class="line">export PATH=$PATH:/bin:/sbin:/usr/bin:/usr/sbin</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">start | run)</span><br><span class="line">    #autossh</span><br><span class="line">    /usr/bin/autossh -i /home/qzs/.ssh/id_rsa -M 0 -o &quot;ServerAliveInterval 60&quot; -o &quot;ServerAliveCountMax 10&quot; -N -L 4096:localhost:80 root@23.226.78.113 &amp;</span><br><span class="line">    sleep 3</span><br><span class="line"></span><br><span class="line">    test_connect()&#123;</span><br><span class="line">        while true; do</span><br><span class="line">        #test_connect</span><br><span class="line">        web_code=$(curl --connect-timeout 1 127.0.0.1:4096 -i 2&gt;/dev/null |head -1 |perl -lane &#x27;print $F[1]&#x27;)</span><br><span class="line">        if [ &quot;$web_code&quot; != &quot;200&quot; ] ;then</span><br><span class="line">            echo &quot;$(date +%Y/%m/%d_%H:%M:%S)&quot; &gt;&gt; ssh_tunnel_erro.log</span><br><span class="line">            sleep 1</span><br><span class="line">        else</span><br><span class="line">            echo &quot;$(date +%Y/%m/%d_%H:%M:%S)&quot; &gt; ssh_tunnel_success.log</span><br><span class="line">            sleep 1</span><br><span class="line">        fi</span><br><span class="line">        done</span><br><span class="line">    &#125;</span><br><span class="line">    test_connect &amp;</span><br><span class="line">    ;;</span><br><span class="line">stop)</span><br><span class="line">    if [ &quot;$(/usr/bin/pgrep autossh)&quot; ] ;then</span><br><span class="line">        kill $(/usr/bin/pgrep autossh)</span><br><span class="line">    fi</span><br><span class="line">    if [ &quot;$(/usr/bin/pgrep ssh_tunnel)&quot; ] ;then</span><br><span class="line">        kill $(/usr/bin/pgrep ssh_tunnel)</span><br><span class="line">    fi</span><br><span class="line">    ;;</span><br><span class="line">*)</span><br><span class="line">    echo &#x27;Usage: ./ssh_tunnel.sh  [ OPTIONS ] &#123; start | stop | run &#125;&#x27;</span><br><span class="line">    ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <tags>
        <tag>note</tag>
        <tag>ssh</tag>
        <tag>ssh_tunnel</tag>
        <tag>autossh</tag>
      </tags>
  </entry>
  <entry>
    <title>CDN中记录真实IP</title>
    <url>/2016/12/25/cdn_ip/</url>
    <content><![CDATA[<h4 id="使用CDN后在网页服务器日志中显示真实的用户IP地址"><a href="#使用CDN后在网页服务器日志中显示真实的用户IP地址" class="headerlink" title="使用CDN后在网页服务器日志中显示真实的用户IP地址"></a>使用CDN后在网页服务器日志中显示真实的用户IP地址</h4><h5 id="真实IP：为解决这个问题，可以通过在云加速转发的HTTP头信息中增加-X-Forwarded-For-信息，用于记录客户端的真实IP，这时web服务器的日志就可以使用-http-x-forwarded-for变量记录远程客户端的真实IP。格式如下："><a href="#真实IP：为解决这个问题，可以通过在云加速转发的HTTP头信息中增加-X-Forwarded-For-信息，用于记录客户端的真实IP，这时web服务器的日志就可以使用-http-x-forwarded-for变量记录远程客户端的真实IP。格式如下：" class="headerlink" title="真实IP：为解决这个问题，可以通过在云加速转发的HTTP头信息中增加 X-Forwarded-For 信息，用于记录客户端的真实IP，这时web服务器的日志就可以使用 $http_x_forwarded_for变量记录远程客户端的真实IP。格式如下："></a>真实IP：为解决这个问题，可以通过在云加速转发的HTTP头信息中增加 X-Forwarded-For 信息，用于记录客户端的真实IP，这时web服务器的日志就可以使用 $http_x_forwarded_for变量记录远程客户端的真实IP。格式如下：</h5><ol>
<li>Nginx<br><code>&#39;$http_x_forwarded_for - $remote_user [$time_local] &quot;$request&quot; &#39; &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39; &#39;&quot;$http_user_agent&quot; &#39;;</code></li>
<li>Apache<br><code>LogFormat &quot;%&#123;X-Forwarded-For&#125;i %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot;</code></li>
</ol>
]]></content>
      <tags>
        <tag>note</tag>
        <tag>X-FORWARDED-FOR</tag>
      </tags>
  </entry>
  <entry>
    <title>串口调试</title>
    <url>/2017/08/09/com/</url>
    <content><![CDATA[<h3 id="Linux下调试串口服务器的命令"><a href="#Linux下调试串口服务器的命令" class="headerlink" title="Linux下调试串口服务器的命令"></a>Linux下调试串口服务器的命令</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">minicom -D /dev/ttyUSB0 -H -w -o</span><br><span class="line"></span><br><span class="line">  - -D 指定串口设备</span><br><span class="line"></span><br><span class="line">  - -H 使用16进制输出</span><br><span class="line"></span><br><span class="line">  - -w 滚屏输出</span><br><span class="line"></span><br><span class="line">  - -o 不对设备进行初始化</span><br><span class="line"></span><br><span class="line">  - -c on/off 输出开启颜色</span><br></pre></td></tr></table></figure>
<h3 id="Windows-下调试串口服务器的软件"><a href="#Windows-下调试串口服务器的软件" class="headerlink" title="Windows 下调试串口服务器的软件"></a>Windows 下调试串口服务器的软件</h3><ul>
<li><a href="https://github.com/movsb/common">common</a></li>
</ul>
]]></content>
      <tags>
        <tag>com</tag>
        <tag>minicom</tag>
        <tag>common</tag>
      </tags>
  </entry>
  <entry>
    <title>DB2常用命令</title>
    <url>/2016/09/06/db2_instructions/</url>
    <content><![CDATA[<h5 id="启动实例-db2inst1-：实例相当于informix中的服务"><a href="#启动实例-db2inst1-：实例相当于informix中的服务" class="headerlink" title="启动实例(db2inst1)：实例相当于informix中的服务"></a>启动实例(db2inst1)：实例相当于informix中的服务</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2start</span><br></pre></td></tr></table></figure>
<h5 id="停止实例-db2inst1-："><a href="#停止实例-db2inst1-：" class="headerlink" title="停止实例(db2inst1)："></a>停止实例(db2inst1)：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2stop</span><br></pre></td></tr></table></figure>
<h5 id="列出所有实例-db2inst1"><a href="#列出所有实例-db2inst1" class="headerlink" title="列出所有实例(db2inst1)"></a>列出所有实例(db2inst1)</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2ilist</span><br></pre></td></tr></table></figure>
<h5 id="列出当前实例："><a href="#列出当前实例：" class="headerlink" title="列出当前实例："></a>列出当前实例：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 get instance</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h5 id="察看示例配置文件："><a href="#察看示例配置文件：" class="headerlink" title="察看示例配置文件："></a>察看示例配置文件：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 get dbm cfg|more</span><br></pre></td></tr></table></figure>
<h5 id="更新数据库管理器参数信息："><a href="#更新数据库管理器参数信息：" class="headerlink" title="更新数据库管理器参数信息："></a>更新数据库管理器参数信息：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 update dbm cfg using para_name para_value</span><br></pre></td></tr></table></figure>
<h5 id="创建数据库："><a href="#创建数据库：" class="headerlink" title="创建数据库："></a>创建数据库：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 create db test</span><br></pre></td></tr></table></figure>
<h5 id="察看数据库配置参数信息"><a href="#察看数据库配置参数信息" class="headerlink" title="察看数据库配置参数信息"></a>察看数据库配置参数信息</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 get db cfg for test|more</span><br></pre></td></tr></table></figure>
<h5 id="更新数据库参数配置信息"><a href="#更新数据库参数配置信息" class="headerlink" title="更新数据库参数配置信息"></a>更新数据库参数配置信息</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 update db cfg for test using para_name para_value</span><br></pre></td></tr></table></figure>
<h5 id="删除数据库："><a href="#删除数据库：" class="headerlink" title="删除数据库："></a>删除数据库：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 drop db test</span><br></pre></td></tr></table></figure>
<h5 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 connect to test</span><br></pre></td></tr></table></figure>
<h5 id="列出所有表空间的详细信息。"><a href="#列出所有表空间的详细信息。" class="headerlink" title="列出所有表空间的详细信息。"></a>列出所有表空间的详细信息。</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 list tablespaces show detail</span><br></pre></td></tr></table></figure>
<h5 id="列出容器的信息"><a href="#列出容器的信息" class="headerlink" title="列出容器的信息"></a>列出容器的信息</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 list tablespace containers for tbs_id show detail</span><br></pre></td></tr></table></figure>
<h5 id="创建表："><a href="#创建表：" class="headerlink" title="创建表："></a>创建表：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 ceate table tb1(id integer not null,name char(10))</span><br></pre></td></tr></table></figure>
<h5 id="列出所有表"><a href="#列出所有表" class="headerlink" title="列出所有表"></a>列出所有表</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 list tables</span><br></pre></td></tr></table></figure>
<h5 id="插入数据："><a href="#插入数据：" class="headerlink" title="插入数据："></a>插入数据：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 insert into tb1 values(1,’sam’);</span><br><span class="line">db2 insert into tb2 values(2,’smitty’);</span><br></pre></td></tr></table></figure>
<h5 id="查询数据："><a href="#查询数据：" class="headerlink" title="查询数据："></a>查询数据：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 “select * from tb1”</span><br></pre></td></tr></table></figure>
<h5 id="删除数据："><a href="#删除数据：" class="headerlink" title="删除数据："></a>删除数据：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 delete from tb1 where id=1</span><br></pre></td></tr></table></figure>
<h5 id="创建索引："><a href="#创建索引：" class="headerlink" title="创建索引："></a>创建索引：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 create index idx1 on tb1(id);</span><br></pre></td></tr></table></figure>
<h5 id="创建视图："><a href="#创建视图：" class="headerlink" title="创建视图："></a>创建视图：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 create view view1 as select id from tb1</span><br></pre></td></tr></table></figure>
<h5 id="查询视图："><a href="#查询视图：" class="headerlink" title="查询视图："></a>查询视图：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 select * from view1</span><br></pre></td></tr></table></figure>
<h5 id="节点编目"><a href="#节点编目" class="headerlink" title="节点编目"></a>节点编目</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 catalog tcp node node_name remote server_ip server         server_port</span><br></pre></td></tr></table></figure>
<h5 id="察看端口号"><a href="#察看端口号" class="headerlink" title="察看端口号"></a>察看端口号</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 get dbm cfg|grep SVCENAME</span><br></pre></td></tr></table></figure>
<h5 id="节点的附接"><a href="#节点的附接" class="headerlink" title="节点的附接"></a>节点的附接</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 attach to node_name</span><br></pre></td></tr></table></figure>
<h5 id="察看本地节点"><a href="#察看本地节点" class="headerlink" title="察看本地节点"></a>察看本地节点</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 list node direcotry</span><br></pre></td></tr></table></figure>
<h5 id="节点反编目"><a href="#节点反编目" class="headerlink" title="节点反编目"></a>节点反编目</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 uncatalog node node_name</span><br></pre></td></tr></table></figure>
<h5 id="数据库编目"><a href="#数据库编目" class="headerlink" title="数据库编目"></a>数据库编目</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 catalog db db_name as db_alias at node node_name</span><br></pre></td></tr></table></figure>
<h5 id="察看数据库的编目"><a href="#察看数据库的编目" class="headerlink" title="察看数据库的编目"></a>察看数据库的编目</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 list db directory</span><br></pre></td></tr></table></figure>
<h5 id="连接数据库-1"><a href="#连接数据库-1" class="headerlink" title="连接数据库"></a>连接数据库</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 connect to db_alias user user_name using user_password</span><br></pre></td></tr></table></figure>
<h5 id="数据库反编目"><a href="#数据库反编目" class="headerlink" title="数据库反编目"></a>数据库反编目</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 uncatalog db db_alias</span><br></pre></td></tr></table></figure>
<h5 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 export to myfile of ixf messages msg select * from tb1</span><br></pre></td></tr></table></figure>
<h5 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 import from myfile of ixf messages msg replace into tb1</span><br></pre></td></tr></table></figure>
<h5 id="导出数据库的所有表数据"><a href="#导出数据库的所有表数据" class="headerlink" title="导出数据库的所有表数据"></a>导出数据库的所有表数据</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2move test export</span><br></pre></td></tr></table></figure>
<h5 id="生成数据库的定义"><a href="#生成数据库的定义" class="headerlink" title="生成数据库的定义"></a>生成数据库的定义</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2look -d db_alias -a -e -m -l -x -f -o db2look.sql</span><br></pre></td></tr></table></figure>
<h5 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 create db test1</span><br></pre></td></tr></table></figure>
<h5 id="生成定义"><a href="#生成定义" class="headerlink" title="生成定义"></a>生成定义</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 -tvf db2look.sql</span><br></pre></td></tr></table></figure>
<h5 id="导入数据库所有的数据"><a href="#导入数据库所有的数据" class="headerlink" title="导入数据库所有的数据"></a>导入数据库所有的数据</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2move db_alias import</span><br></pre></td></tr></table></figure>
<h5 id="重组检查"><a href="#重组检查" class="headerlink" title="重组检查"></a>重组检查</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 reorgchk</span><br></pre></td></tr></table></figure>
<h5 id="重组表tb1"><a href="#重组表tb1" class="headerlink" title="重组表tb1"></a>重组表tb1</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 reorg table tb1</span><br></pre></td></tr></table></figure>
<h5 id="更新统计信息"><a href="#更新统计信息" class="headerlink" title="更新统计信息"></a>更新统计信息</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 runstats on table tb1</span><br></pre></td></tr></table></figure>
<h5 id="备份数据库test"><a href="#备份数据库test" class="headerlink" title="备份数据库test"></a>备份数据库test</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 backup db test</span><br></pre></td></tr></table></figure>
<h5 id="恢复数据库test"><a href="#恢复数据库test" class="headerlink" title="恢复数据库test"></a>恢复数据库test</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 restore db test</span><br></pre></td></tr></table></figure>
<h5 id="拥有实例的所有程序列表"><a href="#拥有实例的所有程序列表" class="headerlink" title="拥有实例的所有程序列表"></a>拥有实例的所有程序列表</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 list application</span><br></pre></td></tr></table></figure>
<h5 id="断开数据库连接-同时退出"><a href="#断开数据库连接-同时退出" class="headerlink" title="断开数据库连接,同时退出"></a>断开数据库连接,同时退出</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 terminate</span><br></pre></td></tr></table></figure>
<h5 id="查看数据表结构"><a href="#查看数据表结构" class="headerlink" title="查看数据表结构"></a>查看数据表结构</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 “describe select * from ggwdxtcs”</span><br></pre></td></tr></table></figure>
<h5 id="启动命令界面"><a href="#启动命令界面" class="headerlink" title="启动命令界面"></a>启动命令界面</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2cmd</span><br></pre></td></tr></table></figure>
<h5 id="查看帮助"><a href="#查看帮助" class="headerlink" title="查看帮助"></a>查看帮助</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 ? *</span><br></pre></td></tr></table></figure>
<h5 id="连接数据库-2"><a href="#连接数据库-2" class="headerlink" title="连接数据库"></a>连接数据库</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 connect to user using</span><br></pre></td></tr></table></figure>
<h5 id="查看数据库实例"><a href="#查看数据库实例" class="headerlink" title="查看数据库实例"></a>查看数据库实例</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2ilist</span><br></pre></td></tr></table></figure>
<h5 id="停止数据库应用"><a href="#停止数据库应用" class="headerlink" title="停止数据库应用"></a>停止数据库应用</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 force applications all</span><br></pre></td></tr></table></figure>
<h5 id="查看表空间"><a href="#查看表空间" class="headerlink" title="查看表空间"></a>查看表空间</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 list tablespaces show detail</span><br></pre></td></tr></table></figure>
<h5 id="查看表是否有记录"><a href="#查看表是否有记录" class="headerlink" title="查看表是否有记录"></a>查看表是否有记录</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 select count(*) from</span><br></pre></td></tr></table></figure>
<h5 id="从文本导入到数据库表中"><a href="#从文本导入到数据库表中" class="headerlink" title="从文本导入到数据库表中"></a>从文本导入到数据库表中</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 import from #####*.ixf of ixf modified by forcein commitcount 1000 insert into</span><br></pre></td></tr></table></figure>
<h5 id="查看sql语句错误解释"><a href="#查看sql语句错误解释" class="headerlink" title="查看sql语句错误解释"></a>查看sql语句错误解释</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 ? sql########## ##########为四位出错编码，不足位前补0</span><br><span class="line">db2 ? “sqlstate”</span><br><span class="line">db2 ? sqlstate=42884</span><br><span class="line">db2 “select * from syscat.functions” |grep –i rtrim</span><br><span class="line">db2 “select * from syscat.indexes”</span><br></pre></td></tr></table></figure>
<h5 id="表增加列"><a href="#表增加列" class="headerlink" title="表增加列"></a>表增加列</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 alter table 表名 add column 字段名 varchar(4)(字段类型）</span><br></pre></td></tr></table></figure>
<h5 id="修改表里的字段"><a href="#修改表里的字段" class="headerlink" title="修改表里的字段"></a>修改表里的字段</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db2 update 表名 set 字段名=&#x27;xxx&#x27; where .....</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>command</tag>
        <tag>database</tag>
        <tag>sql</tag>
        <tag>DB2</tag>
      </tags>
  </entry>
  <entry>
    <title>docker</title>
    <url>/2017/06/08/docker_instructions/</url>
    <content><![CDATA[<ol>
<li>docker engine安装</li>
</ol>
<ul>
<li><a href="https://docs.docker.com/engine/installation/#supported-platforms">docker install</a></li>
<li><a href="https://store.docker.com/editions/community/docker-ce-server-debian">debian install</a></li>
<li><a href="https://store.docker.com/editions/community/docker-ce-server-centos">centos install</a></li>
<li><a href="https://store.docker.com/editions/community/docker-ce-desktop-windows">windows install</a></li>
</ul>
<ol start="2">
<li>docker官方文档</li>
</ol>
<ul>
<li><a href="https://docs.docker.com/engine/admin/start-containers-automatically/#restart-policy-details">docker administrator guide</a></li>
<li><a href="https://docs.docker.com/engine/userguide/">docker user guide</a></li>
<li><a href="https://stackoverflow.com/questions/23111631/cannot-download-docker-images-behind-a-proxy">docker proxy</a><br>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cat /etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="line">  Environment=&quot;HTTP_PROXY=http://proxy.example.com:80/&quot; HTTPS_PROXY=http://proxy.example.com:80/</span><br><span class="line">  Environment=&quot;NO_PROXY=localhost,127.0.0.0/8,docker-registry.somecorporation.com&quot;</span><br><span class="line">$ systemctl daemon-reload</span><br><span class="line">$ systemctl show --property Environment docker</span><br><span class="line">  Environment=HTTP_PROXY=http://proxy.example.com:80/</span><br><span class="line">$ systemctl restart docker</span><br></pre></td></tr></table></figure></li>
</ul>
<span id="more"></span>
<ul>
<li><a href="https://docs.docker.com/engine/reference/run/">docker command</a><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker version/info/login</span><br><span class="line">docker run</span><br><span class="line">docker run -i -t</span><br><span class="line">docker pull/search/commit/push</span><br><span class="line">docker start/stop/kill/restart</span><br><span class="line">docker ps       正在运行的docker</span><br><span class="line">docker ps -a    所有的docker</span><br><span class="line">docker ps -l    最近运行的docker</span><br><span class="line">docker rm       删除docker</span><br><span class="line">docker images   列出image</span><br><span class="line">docker rmi     删除image</span><br><span class="line">docker rmi `docker images -f dangling=true -q`</span><br><span class="line">docker save/load</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://stackoverflow.com/questions/17157721/how-to-get-a-docker-containers-ip-address-from-the-host">查看docker内ip地址</a><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker network inspect bridge</span><br><span class="line">docker inspect ID/Name</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><a href="http://www.widuu.com/docker/">中文docker</a></li>
</ul>
<ol start="3">
<li>docker-compose</li>
</ol>
<ul>
<li><a href="https://docs.docker.com/compose/reference/overview/">docker-compose command</a></li>
<li><a href="https://github.com/docker/compose/releases">docker-compose install</a><br>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -L https://github.com/docker/compose/releases/download/1.14.0-rc2/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>docker</tag>
        <tag>docker engine</tag>
        <tag>docker proxy</tag>
        <tag>docker command</tag>
        <tag>docker-compose</tag>
      </tags>
  </entry>
  <entry>
    <title>emacs</title>
    <url>/2016/03/09/emacs/</url>
    <content><![CDATA[<p>emacs里所有操作都是LISP指令，包括上下左右移动光标，这意味着什么？ “emacs是一个伪装成编辑器的操作系统”这句话应该就是这么理解吧，所有的操作都是指令，emacs就像操作系统一样，平时不用关注，实际上打交道的都是操作系统上运行的各种程序。emacs也是这样，执行LISP函数就行了，增加各种插件就是增加LISP的函数让你调用而已，各人的配置就是把各种指令绑定快捷键，方便自己使用。emacs的插件功能有执行shell命令，telnet，ftp，文件管理器，收邮件，浏览网页，煮咖啡，擦皮鞋，等等。前段时间又受到黑客与画家书的鼓吹，买了本CLISP的书看，对emacs用的LISP也是越看越顺眼了。</p>
<span id="more"></span>

<p>忘掉网上其它的那些教程、手册吧，也忘掉emacs有几百种几千种命令吧。</p>
<p>emacs最简单入门：只要记住一个按键就行了： M-x . 按住Alt键再按x，在窗口最底下出现M-x的提示，在这里输入left-几个字符，按Tab键，出现两行提示 left-char, left-word，再输入一个c，再按Tab键，这时自动补全为left-char，按回车，如果有内容的话，当前的光标点向左移动，就像按了一个向左的方向键一样。  就这样？就这样！</p>
<p>就这样，发挥你的想象力，想象你现在需要做什么，把它翻译成英文单词，按 M-x，先输入几个字母，按Tab，看是否存在你想象中的指令。要取消当前操作的指令，多按几次ESC键或Ctrl-g键就取消了。</p>
<p>现在假设下emacs有100条指令吧，你如果想做什么事都去执行指令的话，虽然也可以，但是总比不上为常用的指令设置一个快捷键方便。现在看下默认的各种快捷键：</p>
<p>先来看几个简单的 forward-char  backward-char  previous-line  next-line , 很直白的命令，向前后移一个字符或向上下移一行，对应4个方向键。默认绑定的快捷键就是Ctrl加指令首字母 C-f&#x2F;b&#x2F;p&#x2F;n。简洁直白合理极致吧。 复制一些内容到窗口上去，多按几次按键，多按几次手指上的肌肉就不会忘记了。就像用了十多年的五笔输入法一样，看着键盘时一个字也打不也来了，字根键码早忘光了。只有两只手都放在键盘上时，看着汉字，手指自然就打出来了。</p>
<p>再看下 forward-word  backward-word ，向前后一个单词，默认绑定快捷键为Alt加指令首字母 M-f&#x2F;b。也很合理吧。</p>
<p>如果要快速移动到当前行首行尾，或者是一句话的首尾部呢？ move-beginning-of-line move-end-of-line  backward-sentence  forward-sentence ，默认绑定的快捷键是 C-a&#x2F;e  M-a&#x2F;e，好像也还算合理吧。</p>
<p>好了，只要理解了emacs里做任何操作都是执行LISP函数，就算是入门了。emacs被称为复杂难学是因为默认设置了很多快捷键，不容易一下记住。现在只要记住用M-x来执行命令，快捷键一律忽视，等熟悉了LISP指令及对应的功能，想为它设置一个快捷键时，再看看默认设置的快捷键是否合你的胃口，改或不改你决定。<br>对emacs感兴趣或者不感兴趣现在就可以决定了。什么学emacs需要很强的耐心那些都是胡扯，我敢打赌只要有好奇心的人就会继续往下看。<br>现在可以打开帮助菜单下的教程，跟着操作一遍，学习一些最常用的快捷键了。多动手，肌肉记忆比大脑记忆好用。</p>
<p>想象一下你使用其它编辑器时使用到的各种功能快捷键，把它和emacs默认设置的快捷键比较一下，哪种设置比较合理。<br>emacs里的各种快捷键设置都是无害的，意思就是你改掉一个快捷键对应的功能，命令却还在，永远可以用M-x来直接执行。如果是其它编辑器就比较麻烦，可能这个操作的功能就找不回来了。</p>
<h3 id="一些默认快捷键"><a href="#一些默认快捷键" class="headerlink" title="一些默认快捷键"></a>一些默认快捷键</h3><pre><code>C-代表按住Ctrl键
M-代表按住Alt键，也可以用按一下ESC放开代替
</code></pre>
<h3 id="最先要记住的"><a href="#最先要记住的" class="headerlink" title="最先要记住的"></a>最先要记住的</h3><pre><code>M-x &lt;cmd&gt;      输入指令执行，在输入时用Tab可以自动补全或列出项目
C-g            取消当前操作指令
C-h k &lt;key&gt;    查看当前按键绑定的指令及介绍
</code></pre>
<h3 id="移动插入点（光标）"><a href="#移动插入点（光标）" class="headerlink" title="移动插入点（光标）"></a>移动插入点（光标）</h3><pre><code>C-n/p/b/f      到 下一行、上一行、前一字符、后一字符
M-b/f          到 前、后一单词
C-a/e          到 行首、末
M-a/e          到 句首、末
M-         到 文件首、末
C-v/M-v        下、上翻屏
C-l        循环 将当前光标行显示在窗口下、中、上位置

C-u &lt;num&gt; &lt;xx&gt; 重复执行之后的 xx 命令 num 次，不输入num默认为4
C-u C-v        向下滚动4行
</code></pre>
<h3 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h3><pre><code>Back/C-d       删除 前、后字符
M-Back/M-d     移除 前、后单词
C-k/M-k        移除到 行末、句末

C-/            undo/redo
C-x u          undo/redo

C-w            剪切
C-y        召回（粘贴）（粘贴移除的、复制、剪切的内容）
C-c        复制（emacs一般也默认定制了与OS的剪切复制粘贴相同的快捷键）
</code></pre>
<h3 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h3><pre><code>C-s
  C-s 查找下一个
  C-r 查找上一下
  C-g 一次返回，二次结束查找
  回车    停止到当前查找到的内容
</code></pre>
<h3 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h3><pre><code>M-%
</code></pre>
<h3 id="标记"><a href="#标记" class="headerlink" title="标记"></a>标记</h3><pre><code>M-@
</code></pre>
<h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><pre><code>C-x C-c        退出emacs

C-x C-f        打开文件
C-x C-s        保存文件
C-x C-v        在当前缓冲区重新打开一个文件，可以用于清除undo历史!!

C-x 1          最大化当前缓冲，关闭其它
C-x 2/3        垂直、水平创建新缓冲区
C-x o          切换到其它缓冲区

C-x C-b        列出缓冲区
C-x b          提示输入缓冲区名称，切换当前窗口的缓冲区
C-x k          删除当前缓冲区

C-j        换行回车，有些模式下比较直接回车好用，有增加缩进之类的功能
</code></pre>
<hr>
<h2 id="理解一些概念"><a href="#理解一些概念" class="headerlink" title="理解一些概念"></a>理解一些概念</h2><pre><code>buffer
  缓冲区，内存中的数据，打开文件时读入内容到内存，修改后保存才会修改到磁盘上的文件。

window
  窗口，缓冲区的一个展示区域

frame
  OS上的一个emacs程序窗口

mode 模式
  mode有主模式，辅助模式，主模式就像vim中设置当前filetype一样，当前编辑的是ruby或者python源代码，根据不同文件类型，设置按Tab缩进时缩进不同的字符数，把不同的词当作关键字时行语法高亮等等，同一时间只能选一个主模式。试着多开几个窗口，执行text-mode ruby-mode python-mode试下。emacs打开文件时会自动根据文件扩展名或内容检查并设置主模式。
  辅助模式就是窗口是否要自动换行，是否显示行号等，辅助模式可以多个同时启用。

undo
  在 EMACS 中想要将已经做过的动作放弃，以恢复原状。
</code></pre>
<h2 id="EMACS-所提供的-undo，可以连续恢复最近使用过的指令。"><a href="#EMACS-所提供的-undo，可以连续恢复最近使用过的指令。" class="headerlink" title="EMACS 所提供的 undo，可以连续恢复最近使用过的指令。"></a>EMACS 所提供的 undo，可以连续恢复最近使用过的指令。</h2><p>  undo 的顺序是最新使用过的指令最先被 undo ，第二次使用 undo 则恢复第二新的指令，任何指令的输入（除了 undo 本身之外） 都会使指令输入的顺序重整， 这也同时影响 undo 的顺序。<br>  使用 undo 有一个限制，就是 undo 只能 undo 对缓冲区内容造成改变的指令。对于只是改变游标动作的指令，是无法以 undo 来恢复旧观。若所有修改过内容的指令，都以 undo 恢复原状后， 再一次使用 undo 的指令，echo area 会出现如下的讯息：No further undo information.</p>
<h3 id="当使用了-undo-之后，还想要在-redo-这个已被-undo-的动作时，-有一个技巧可以达成如此的效果。"><a href="#当使用了-undo-之后，还想要在-redo-这个已被-undo-的动作时，-有一个技巧可以达成如此的效果。" class="headerlink" title="当使用了 undo 之后，还想要在 redo 这个已被 undo 的动作时， 有一个技巧可以达成如此的效果。"></a>当使用了 undo 之后，还想要在 redo 这个已被 undo 的动作时， 有一个技巧可以达成如此的效果。</h3><p> 1.首先键入一个不会改变缓冲区内容的指令（如光标移动的指令），使原来<br> 2.存放指令的顺序因新指令的加入而改变。<br> 3.再使用一次 undo 的指令，就可以达到 redo 的效果了。</p>
<h3 id="undo的行为很难描述，示例："><a href="#undo的行为很难描述，示例：" class="headerlink" title="undo的行为很难描述，示例："></a>undo的行为很难描述，示例：</h3><p> 新建一个文件<br> 执行几个修改内容的指令 &lt;1回车2回车3回车&gt;， 这时undo历史里有6条记录<br> undo顺序为654321, 继续undo则提示No further undo information<br> 按下左右方向键（虽然移不动光标），这时undo历史里有12条记录了，前6条undo就变成redo了，顺序123456654321<br> 再按下方向键，undo历史记录数量再翻倍</p>
<h3 id="emacs的undo不会丢失任何操作，你先做一些操作，undo，再做另一些操作，如果是其它编辑器，第一次undo的动作就失踪了，emacs里却一直存在着，原因同上。多试几次就明白了。"><a href="#emacs的undo不会丢失任何操作，你先做一些操作，undo，再做另一些操作，如果是其它编辑器，第一次undo的动作就失踪了，emacs里却一直存在着，原因同上。多试几次就明白了。" class="headerlink" title="emacs的undo不会丢失任何操作，你先做一些操作，undo，再做另一些操作，如果是其它编辑器，第一次undo的动作就失踪了，emacs里却一直存在着，原因同上。多试几次就明白了。"></a>emacs的undo不会丢失任何操作，你先做一些操作，undo，再做另一些操作，如果是其它编辑器，第一次undo的动作就失踪了，emacs里却一直存在着，原因同上。多试几次就明白了。</h3>]]></content>
      <tags>
        <tag>emacs</tag>
      </tags>
  </entry>
  <entry>
    <title>git 添加 key</title>
    <url>/2017/07/13/git_error/</url>
    <content><![CDATA[<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ ssh-add ~/.ssh/id_rsa.pub</span><br><span class="line">Could not open a connection to your authentication agent.</span><br></pre></td></tr></table></figure>
<p>You might need to start ssh-agent before you run the ssh-add command:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">eval `ssh-agent -s`</span><br><span class="line">ssh-add ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh -T git@github.com</span><br><span class="line">ssh -Tv git@github.com</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://help.github.com/articles/testing-your-ssh-connection/">github-testing-your-ssh-connection</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>git</tag>
        <tag>git key</tag>
      </tags>
  </entry>
  <entry>
    <title>自动发现JAVA路径的BASH脚本</title>
    <url>/2016/06/23/java_bash/</url>
    <content><![CDATA[<h4 id="自动识别JAVA路径"><a href="#自动识别JAVA路径" class="headerlink" title="自动识别JAVA路径"></a>自动识别JAVA路径</h4><span id="more"></span>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">#2016/06/23</span><br><span class="line">#author:kebyn</span><br><span class="line">#email:kebyn@sina.com</span><br><span class="line"></span><br><span class="line">unset choose</span><br><span class="line">unset new_java_home</span><br><span class="line"></span><br><span class="line">function java_home()&#123;</span><br><span class="line">#配置JAVA变量</span><br><span class="line">if [ ! -z &quot;$JAVA_HOME&quot; ];then</span><br><span class="line">	echo JAVA_HOME exist!</span><br><span class="line">    echo $JAVA_HOME</span><br><span class="line">    read -p &quot;Do you use JAVA_HOME?y/n&quot; -t 3 choose</span><br><span class="line">    echo &quot;&quot;</span><br><span class="line">    choose=$&#123;choose:=&quot;y&quot;&#125;</span><br><span class="line">    if [ &quot;$choose&quot; == &quot;n&quot; -o &quot;$choose&quot; == &quot;N&quot; -o &quot;$choose&quot; == &quot;NO&quot; -o &quot;$choose&quot; == &quot;No&quot; ]</span><br><span class="line">        read -p &quot;Please input your JAVA_HOME?y/n&quot; -t 3 new_java_home</span><br><span class="line">        echo &quot;&quot;</span><br><span class="line">        JAVA_HOME=$&#123;JAVA_HOME+$&#123;new_java_home&#125;&#125;</span><br><span class="line">    else</span><br><span class="line">        continue</span><br><span class="line">    fi</span><br><span class="line">else</span><br><span class="line">	which java &amp;&gt; /dev/null</span><br><span class="line"></span><br><span class="line">	if [ $? -eq 0 ];then</span><br><span class="line">	JAVA_HOME=readlink -f $(which java)</span><br><span class="line">	echo Find the JAVA !</span><br><span class="line">	echo $JAVA_HOME</span><br><span class="line"></span><br><span class="line">	else</span><br><span class="line">	read -p ”请输入JAVA_HOME路径“ JAVA_HOME</span><br><span class="line"></span><br><span class="line">	echo $JAVA_HOME</span><br><span class="line">	fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">JAVA_BIN=$JAVA_HOME/bin</span><br><span class="line">CLASSPAHT=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">echo JAVA_HOME=$JAVA_HOME |tee &gt;&gt; /etc/profile</span><br><span class="line">echo JAVA_BIN=$JAVA_BIN |tee &gt;&gt; /etc/profile</span><br><span class="line">echo CLASSPAHT=$CLASSPAHT |tee &gt;&gt; /etc/profile</span><br><span class="line">echo export JAVA_HOME JAVA_BIN CLASSPAHT &gt;&gt; /etc/profile</span><br><span class="line">source /etc/profile</span><br><span class="line">&#125;</span><br><span class="line">java_home</span><br><span class="line">if [ ! -z &quot;$JAVA_HOME&quot; ];then</span><br><span class="line">	echo JAVA_HOME set success!</span><br><span class="line">    echo $JAVA_HOME</span><br><span class="line">else</span><br><span class="line">    echo JAVA_HOME set Failed!</span><br><span class="line">    exit 1</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
        <tag>bash</tag>
        <tag>脚本</tag>
      </tags>
  </entry>
  <entry>
    <title>minecraft</title>
    <url>/2016/11/11/minecraft/</url>
    <content><![CDATA[<p><img src="https://minecraft.net/static/theme/img/gif/menu-buy.gif" alt="MineCraft"></p>
<hr>
<h4 id="MineCraft官网购买链接"><a href="#MineCraft官网购买链接" class="headerlink" title="MineCraft官网购买链接"></a>MineCraft官网购买链接</h4><p><a href="https://minecraft.net/zh-hans/store/minecraft">store</a></p>
<h4 id="客户端下载"><a href="#客户端下载" class="headerlink" title="客户端下载"></a>客户端下载</h4><p><a href="https://minecraft.net/zh-hans/download">client</a></p>
<h4 id="服务器版本下载地址"><a href="#服务器版本下载地址" class="headerlink" title="服务器版本下载地址"></a>服务器版本下载地址</h4><p><a href="https://minecraft.net/zh-hans/download/server">server</a></p>
<h4 id="2016-10-04日解析地址："><a href="#2016-10-04日解析地址：" class="headerlink" title="2016&#x2F;10&#x2F;04日解析地址："></a>2016&#x2F;10&#x2F;04日解析地址：</h4><p><a href="https://s3.amazonaws.com/Minecraft.Download/versions/1.10.2/minecraft_server.1.10.2.jar">minecraft_server.1.10.2.jar</a></p>
<h4 id="2017-03-10日解析地址："><a href="#2017-03-10日解析地址：" class="headerlink" title="2017&#x2F;03&#x2F;10日解析地址："></a>2017&#x2F;03&#x2F;10日解析地址：</h4><p><a href="https://s3.amazonaws.com/Minecraft.Download/versions/1.11.2/minecraft_server.1.11.2.jar">minecraft_server.1.11.2.jar</a></p>
<h4 id="启动-startup"><a href="#启动-startup" class="headerlink" title="启动&#x2F;startup"></a>启动&#x2F;startup</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -Xmx1024M -Xms512M -jar minecraft_server.1.11.2.jar nogui</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h4 id="服务器设置-Setting-up-a-server"><a href="#服务器设置-Setting-up-a-server" class="headerlink" title="服务器设置&#x2F;Setting up a server"></a>服务器设置&#x2F;Setting up a server</h4><p><a href="http://minecraft.gamepedia.com/Tutorials/Setting_up_a_server">one</a></p>
<p><a href="http://minecraft.gamepedia.com/Tutorials/Server_startup_script">two</a></p>
<h4 id="自启文件-Server-startup-script"><a href="#自启文件-Server-startup-script" class="headerlink" title="自启文件&#x2F;Server startup script"></a>自启文件&#x2F;Server startup script</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget -O minecraft &quot;http://minecraft.gamepedia.com/Tutorials/Server_startup_script/Script?action=raw&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># /etc/init.d/minecraft</span><br><span class="line"># version 0.4.2 2016-02-09 (YYYY-MM-DD)</span><br><span class="line">#</span><br><span class="line">### BEGIN INIT INFO</span><br><span class="line"># Provides:   minecraft</span><br><span class="line"># Required-Start: $local_fs $remote_fs screen-cleanup</span><br><span class="line"># Required-Stop:  $local_fs $remote_fs</span><br><span class="line"># Should-Start:   $network</span><br><span class="line"># Should-Stop:    $network</span><br><span class="line"># Default-Start:  2 3 4 5</span><br><span class="line"># Default-Stop:   0 1 6</span><br><span class="line"># Short-Description:    Minecraft server</span><br><span class="line"># Description:    Starts the minecraft server</span><br><span class="line">### END INIT INFO</span><br><span class="line"></span><br><span class="line">#Settings</span><br><span class="line">SERVICE=&#x27;minecraft_server.jar&#x27;</span><br><span class="line">SCREENNAME=&#x27;minecraft_server&#x27;</span><br><span class="line">OPTIONS=&#x27;nogui&#x27;</span><br><span class="line">USERNAME=&#x27;minecraft&#x27;</span><br><span class="line">WORLD=&#x27;world&#x27;</span><br><span class="line">MCPATH=&#x27;/home/minecraft&#x27;</span><br><span class="line">BACKUPPATH=&#x27;/media/remote.share/minecraft.backup&#x27;</span><br><span class="line">MAXHEAP=2048</span><br><span class="line">MINHEAP=1024</span><br><span class="line">HISTORY=1024</span><br><span class="line">CPU_COUNT=1</span><br><span class="line">INVOCATION=&quot;java -Xmx$&#123;MAXHEAP&#125;M -Xms$&#123;MINHEAP&#125;M -XX:+UseConcMarkSweepGC \</span><br><span class="line">-XX:+CMSIncrementalPacing -XX:ParallelGCThreads=$CPU_COUNT -XX:+AggressiveOpts \</span><br><span class="line">-jar $SERVICE $OPTIONS&quot;</span><br><span class="line"></span><br><span class="line">ME=`whoami`</span><br><span class="line">as_user() &#123;</span><br><span class="line">  if [ &quot;$ME&quot; = &quot;$USERNAME&quot; ] ; then</span><br><span class="line">    bash -c &quot;$1&quot;</span><br><span class="line">  else</span><br><span class="line">    su - &quot;$USERNAME&quot; -c &quot;$1&quot;</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mc_start() &#123;</span><br><span class="line">  if  pgrep -u $USERNAME -f $SERVICE &gt; /dev/null ; then</span><br><span class="line">    echo &quot;$SERVICE is already running!&quot;</span><br><span class="line">  else</span><br><span class="line">    echo &quot;Starting $SERVICE...&quot;</span><br><span class="line">    cd $MCPATH</span><br><span class="line">    as_user &quot;cd $MCPATH &amp;&amp; screen -h $HISTORY -dmS $&#123;SCREENNAME&#125; $INVOCATION&quot;</span><br><span class="line">    sleep 7</span><br><span class="line">    if pgrep -u $USERNAME -f $SERVICE &gt; /dev/null ; then</span><br><span class="line">      echo &quot;$SERVICE is now running.&quot;</span><br><span class="line">    else</span><br><span class="line">      echo &quot;Error! Could not start $SERVICE!&quot;</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mc_saveoff() &#123;</span><br><span class="line">  if pgrep -u $USERNAME -f $SERVICE &gt; /dev/null ; then</span><br><span class="line">    echo &quot;$SERVICE is running... suspending saves&quot;</span><br><span class="line">   as_user &quot;screen -p 0 -S $&#123;SCREENNAME&#125; -X eval &#x27;stuff \&quot;say SERVER BACKUP STARTING. Server going readonly...\&quot;\015&#x27;&quot;</span><br><span class="line">    as_user &quot;screen -p 0 -S $&#123;SCREENNAME&#125; -X eval &#x27;stuff \&quot;save-off\&quot;\015&#x27;&quot;</span><br><span class="line">    as_user &quot;screen -p 0 -S $&#123;SCREENNAME&#125; -X eval &#x27;stuff \&quot;save-all\&quot;\015&#x27;&quot;</span><br><span class="line">    sync</span><br><span class="line">    sleep 10</span><br><span class="line">  else</span><br><span class="line">    echo &quot;$SERVICE is not running. Not suspending saves.&quot;</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mc_saveon() &#123;</span><br><span class="line">  if pgrep -u $USERNAME -f $SERVICE &gt; /dev/null ; then</span><br><span class="line">    echo &quot;$SERVICE is running... re-enabling saves&quot;</span><br><span class="line">    as_user &quot;screen -p 0 -S $&#123;SCREENNAME&#125; -X eval &#x27;stuff \&quot;save-on\&quot;\015&#x27;&quot;</span><br><span class="line">    as_user &quot;screen -p 0 -S $&#123;SCREENNAME&#125; -X eval &#x27;stuff \&quot;say SERVER BACKUP ENDED. Server going read-write...\&quot;\015&#x27;&quot;</span><br><span class="line">  else</span><br><span class="line">    echo &quot;$SERVICE is not running. Not resuming saves.&quot;</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mc_stop() &#123;</span><br><span class="line">  if pgrep -u $USERNAME -f $SERVICE &gt; /dev/null ; then</span><br><span class="line">    echo &quot;Stopping $SERVICE&quot;</span><br><span class="line">    as_user &quot;screen -p 0 -S $&#123;SCREENNAME&#125; -X eval &#x27;stuff \&quot;say SERVER SHUTTING DOWN IN 10 SECONDS. Saving map...\&quot;\015&#x27;&quot;</span><br><span class="line">    as_user &quot;screen -p 0 -S $&#123;SCREENNAME&#125; -X eval &#x27;stuff \&quot;save-all\&quot;\015&#x27;&quot;</span><br><span class="line">    sleep 10</span><br><span class="line">    as_user &quot;screen -p 0 -S $&#123;SCREENNAME&#125; -X eval &#x27;stuff \&quot;stop\&quot;\015&#x27;&quot;</span><br><span class="line">    sleep 7</span><br><span class="line">  else</span><br><span class="line">    echo &quot;$SERVICE was not running.&quot;</span><br><span class="line">  fi</span><br><span class="line">  if pgrep -u $USERNAME -f $SERVICE &gt; /dev/null ; then</span><br><span class="line">    echo &quot;Error! $SERVICE could not be stopped.&quot;</span><br><span class="line">  else</span><br><span class="line">    echo &quot;$SERVICE is stopped.&quot;</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mc_update() &#123;</span><br><span class="line">  if pgrep -u $USERNAME -f $SERVICE &gt; /dev/null ; then</span><br><span class="line">    echo &quot;$SERVICE is running! Will not start update.&quot;</span><br><span class="line">  else</span><br><span class="line">    as_user &quot;cd $MCPATH &amp;&amp; wget -q -O $MCPATH/versions --no-check-certificate https://launchermeta.mojang.com/mc/game/version_manifest.json&quot;</span><br><span class="line">    if [ &quot;$1&quot; == &quot;snapshot&quot; ] ; then</span><br><span class="line">      JSONVERSION=`cd $MCPATH &amp;&amp; cat versions | python -c &quot;exec(\&quot;import json,sys\nobj=json.load(sys.stdin)\nversion=obj[&#x27;latest&#x27;][&#x27;snapshot&#x27;]\nfor v in obj[&#x27;versions&#x27;]:\n   if v[&#x27;id&#x27;]==version:\n    print(v[&#x27;url&#x27;])\&quot;)&quot;`</span><br><span class="line">    else</span><br><span class="line">      JSONVERSION=`cd $MCPATH &amp;&amp; cat versions | python -c &quot;exec(\&quot;import json,sys\nobj=json.load(sys.stdin)\nversion=obj[&#x27;latest&#x27;][&#x27;release&#x27;]\nfor v in obj[&#x27;versions&#x27;]:\n   if v[&#x27;id&#x27;]==version:\n    print(v[&#x27;url&#x27;])\&quot;)&quot;`</span><br><span class="line">    fi</span><br><span class="line">    as_user &quot;cd $MCPATH &amp;&amp; wget -q -O $MCPATH/versions --no-check-certificate $JSONVERSION&quot;</span><br><span class="line">    MC_SERVER_URL=`cd $MCPATH &amp;&amp; cat versions | python -c &#x27;import json,sys;obj=json.load(sys.stdin);print(obj[&quot;downloads&quot;][&quot;server&quot;][&quot;url&quot;])&#x27;`</span><br><span class="line">    as_user &quot;rm $MCPATH/versions&quot;</span><br><span class="line">    as_user &quot;cd $MCPATH &amp;&amp; wget -q -O $MCPATH/minecraft_server.jar.update --no-check-certificate $MC_SERVER_URL&quot;</span><br><span class="line">    if [ -f $MCPATH/minecraft_server.jar.update ] ; then</span><br><span class="line">      if `diff $MCPATH/$SERVICE $MCPATH/minecraft_server.jar.update &gt;/dev/null` ; then</span><br><span class="line">        echo &quot;You are already running the latest version of $SERVICE.&quot;</span><br><span class="line">      else</span><br><span class="line">        as_user &quot;mv $MCPATH/minecraft_server.jar.update $MCPATH/$SERVICE&quot;</span><br><span class="line">        echo &quot;Minecraft successfully updated.&quot;</span><br><span class="line">      fi</span><br><span class="line">    else</span><br><span class="line">      echo &quot;Minecraft update could not be downloaded.&quot;</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mc_backup() &#123;</span><br><span class="line">   mc_saveoff</span><br><span class="line"></span><br><span class="line">   NOW=`date &quot;+%Y-%m-%d_%Hh%M&quot;`</span><br><span class="line">   BACKUP_FILE=&quot;$BACKUPPATH/$&#123;WORLD&#125;_$&#123;NOW&#125;.tar&quot;</span><br><span class="line">   echo &quot;Backing up minecraft world...&quot;</span><br><span class="line">   #as_user &quot;cd $MCPATH &amp;&amp; cp -r $WORLD $BACKUPPATH/$&#123;WORLD&#125;_`date &quot;+%Y.%m.%d_%H.%M&quot;`&quot;</span><br><span class="line">   as_user &quot;tar -C \&quot;$MCPATH\&quot; -cf \&quot;$BACKUP_FILE\&quot; $WORLD&quot;</span><br><span class="line"></span><br><span class="line">   echo &quot;Backing up $SERVICE&quot;</span><br><span class="line">   as_user &quot;tar -C \&quot;$MCPATH\&quot; -rf \&quot;$BACKUP_FILE\&quot; $SERVICE&quot;</span><br><span class="line">   #as_user &quot;cp \&quot;$MCPATH/$SERVICE\&quot; \&quot;$BACKUPPATH/minecraft_server_$&#123;NOW&#125;.jar\&quot;&quot;</span><br><span class="line"></span><br><span class="line">   mc_saveon</span><br><span class="line"></span><br><span class="line">   echo &quot;Compressing backup...&quot;</span><br><span class="line">   as_user &quot;gzip -f \&quot;$BACKUP_FILE\&quot;&quot;</span><br><span class="line">   echo &quot;Done.&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mc_command() &#123;</span><br><span class="line">  command=&quot;$1&quot;;</span><br><span class="line">  if pgrep -u $USERNAME -f $SERVICE &gt; /dev/null ; then</span><br><span class="line">    pre_log_len=`wc -l &quot;$MCPATH/logs/latest.log&quot; | awk &#x27;&#123;print $1&#125;&#x27;`</span><br><span class="line">    echo &quot;$SERVICE is running... executing command&quot;</span><br><span class="line">    as_user &quot;screen -p 0 -S $&#123;SCREENNAME&#125; -X eval &#x27;stuff \&quot;$command\&quot;\015&#x27;&quot;</span><br><span class="line">    sleep .1 # assumes that the command will run and print to the log file in less than .1 seconds</span><br><span class="line">    # print output</span><br><span class="line">    tail -n $[`wc -l &quot;$MCPATH/logs/latest.log&quot; | awk &#x27;&#123;print $1&#125;&#x27;`-$pre_log_len] &quot;$MCPATH/logs/latest.log&quot;</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#Start-Stop here</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">  start)</span><br><span class="line">    mc_start</span><br><span class="line">    ;;</span><br><span class="line">  stop)</span><br><span class="line">    mc_stop</span><br><span class="line">    ;;</span><br><span class="line">  restart)</span><br><span class="line">    mc_stop</span><br><span class="line">    mc_start</span><br><span class="line">    ;;</span><br><span class="line">  update)</span><br><span class="line">    mc_stop</span><br><span class="line">    mc_backup</span><br><span class="line">    mc_update $2</span><br><span class="line">    mc_start</span><br><span class="line">    ;;</span><br><span class="line">  backup)</span><br><span class="line">    mc_backup</span><br><span class="line">    ;;</span><br><span class="line">  status)</span><br><span class="line">    if pgrep -u $USERNAME -f $SERVICE &gt; /dev/null ; then</span><br><span class="line">      echo &quot;$SERVICE is running.&quot;</span><br><span class="line">    else</span><br><span class="line">      echo &quot;$SERVICE is not running.&quot;</span><br><span class="line">    fi</span><br><span class="line">    ;;</span><br><span class="line">  command)</span><br><span class="line">    if [ $# -gt 1 ] ; then</span><br><span class="line">      shift</span><br><span class="line">      mc_command &quot;$*&quot;</span><br><span class="line">    else</span><br><span class="line">      echo &quot;Must specify server command (try &#x27;help&#x27;?)&quot;</span><br><span class="line">    fi</span><br><span class="line">    ;;</span><br><span class="line"></span><br><span class="line">  *)</span><br><span class="line">  echo &quot;Usage: $0 &#123;start|stop|update|backup|status|restart|command \&quot;server command\&quot;&#125;&quot;</span><br><span class="line">  exit 1</span><br><span class="line">  ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>conf</tag>
        <tag>minecraft</tag>
        <tag>game</tag>
        <tag>games</tag>
      </tags>
  </entry>
  <entry>
    <title>mongod配置</title>
    <url>/2016/06/23/mongodb_configuration_explanation/</url>
    <content><![CDATA[<p>MongoDB提供了一系列组件来提升数据的安全性。数据安全在MongoDB中是最重要的——因此它利用这些组件来减少曝光面。下面是10个可以用来改善你个人或云中MongoDB服务器安全的小提示。</p>
<ol>
<li><p>启用auth-即使在可信赖网络中部署MongoDB服务器时启用auth也是项好的安全实践。当你的网络受攻击时它能够提供“深层防御”。编辑配置文件来启用auth。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">auth = true</span><br></pre></td></tr></table></figure>
<span id="more"></span></li>
<li><p>不要把生产环境的数据库暴露在Internet上-限制对数据库的物理访问是安全性的非常重要的一个措施。如果没有必要，就不要把生产环境的数据库暴露在Internet上。如果攻击者不能物理地连接到MongoDB服务器这种情形大打折扣，那么数据就不会比现在更安全。如果你把服务部署在亚马逊web服务(AWS)上，那么你应当把数据库部署在虚拟私有云(VPC)的私有子网里。</p>
</li>
<li><p>使用防火墙-防火墙的使用可以限制允许哪些实体连接MongoDB服务器。最佳的措施就是仅仅允许你自己的应用服务器访问数据库。如果你把无法部署在亚马逊web服务(AWS)上，你可以使用”安全组“功能限制访问权限。如果你把服务部署在不支持防火墙功能的提供商的主机上，那么你可以亲自使用”iptables”对服务器进行简单的配置。</p>
</li>
<li><p>使用key文件建立复制服务器集群-指定共享的key文件，启用复制集群的MongoDB实例之间的通信。如下给配置文件中增加keyfile参数。复制集群里的所有机器上的这个文件的内容必须相同。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">keyFile = /srv/mongodb/keyfile</span><br></pre></td></tr></table></figure></li>
<li><p>禁止HTTP状态接口- 默认情况下Mongodb在端口28017上运行http接口，以提供“主”状态页面。在生产环境下推荐不要使用此接口，最好禁止这个接口。使用”nohttpinterface”配置设置可以禁止这个http接口。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nohttpinterface = true</span><br></pre></td></tr></table></figure></li>
<li><p>禁止REST接口-在生产环境下建议不要启用MongoDB的REST接口。这个接口不支持任何认证。默认情况下这个接口是关闭的。如果你使用的”rest”配置选项打开了这个接口，那么你应该在生产系统中关闭它。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rest = false</span><br></pre></td></tr></table></figure></li>
<li><p>配置bind_ip- 如果你的系统使用的多个网络接口，那么你可以使用”bind_ip”选项限制mongodb服务器只在与该配置项关联的接口上侦听。默认情况下mongoDB绑定所有的接口。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bind_ip = 10.10.0.25,10.10.0.26</span><br></pre></td></tr></table></figure></li>
<li><p>启用SSL- 如果你没有使用SSL，那么你在MongoDB客户端和MongoDB服务器之间的传输的数据就是明文的，容易受到窃听、篡改和“中间人”攻击。如果你是通过像internet这样的非安全网络连接到MongoDB服务器，那么启用SSL就显得非常重要。</p>
</li>
<li><p>基于角色进行认证- MongoDB支持基于角色的认证，这样你就可以对每个用户可以执行的动作进行细粒度的控制。使用基于角色的认证组建可以限制对数据库的访问，而不是所有的用户都是管理员。更多的信息请参考有关角色的文档。</p>
</li>
<li><p>企业级MongoDB与kerberos- 企业级mongodb继承了kerberos认证。有关这方面的更多信息请参考mongodb文档。基于用户名&#x2F;密码的系统本身就是不安全的，因此如果可能的话，请使用基于kerberos的认证。</p>
</li>
</ol>
]]></content>
      <tags>
        <tag>conf</tag>
        <tag>database</tag>
        <tag>mongodb</tag>
      </tags>
  </entry>
  <entry>
    <title>my.cnf</title>
    <url>/2016/02/16/my.cnf/</url>
    <content><![CDATA[<p>MySQL配置文件示例</p>
<span id="more"></span>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#BEGIN CONFIG INFO</span><br><span class="line"></span><br><span class="line">#TYPE: SYSTEM</span><br><span class="line">#END CONFIG INFO</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># This is a MySQL example config file for systems with 4GB of memory</span><br><span class="line"># running mostly MySQL using InnoDB only tables and performing complex</span><br><span class="line"># queries with few connections.</span><br><span class="line">#</span><br><span class="line"># MySQL programs look for option files in a set of</span><br><span class="line"># locations which depend on the deployment platform.</span><br><span class="line"># You can copy this option file to one of those</span><br><span class="line"># locations. For information about these locations, see:</span><br><span class="line"># http://dev.mysql.com/doc/mysql_5.6/en/option-files.html</span><br><span class="line">#</span><br><span class="line"># In this file, you can use all long options that a program supports.</span><br><span class="line"># If you want to know which options a program supports, run the program</span><br><span class="line"># with the &quot;--help&quot; option.</span><br><span class="line">#</span><br><span class="line"># More detailed information about the individual options can also be</span><br><span class="line"># found in the manual.</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># The following options will be read by MySQL client applications.</span><br><span class="line"># Note that only client applications shipped by MySQL are guaranteed</span><br><span class="line"># to read this section. If you want your own MySQL client program to</span><br><span class="line"># honor these values, you need to specify it as an option during the</span><br><span class="line"># MySQL client library initialization.</span><br><span class="line">#</span><br><span class="line">[client]</span><br><span class="line">#password    = your_password</span><br><span class="line">port		= 3306</span><br><span class="line">socket		= /var/run/mysqld/mysqld.sock</span><br><span class="line"></span><br><span class="line"># Here follows entries for some specific programs</span><br><span class="line"></span><br><span class="line"># The MySQL server</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">user		= mysql</span><br><span class="line">port		= 3306</span><br><span class="line">pid-file	= /var/run/mysqld/mysqld.pid</span><br><span class="line">socket		= /var/run/mysqld/mysqld.sock</span><br><span class="line"></span><br><span class="line">basedir		= /db/mysql_5.6</span><br><span class="line">datadir		= /db/mysql_5.6/data</span><br><span class="line"></span><br><span class="line">explicit_defaults_for_timestamp=true</span><br><span class="line"></span><br><span class="line">#bind-address		= 127.0.0.1</span><br><span class="line"></span><br><span class="line"># back_log is the number of connections the operating system can keep in</span><br><span class="line"># the listen queue, before the MySQL connection manager thread has</span><br><span class="line"># processed them. If you have a very high connection rate and experience</span><br><span class="line"># &quot;connection refused&quot; errors, you might need to increase this value.</span><br><span class="line"># Check your OS documentation for the maximum value of this parameter.</span><br><span class="line"># Attempting to set back_log higher than your operating system limit</span><br><span class="line"># will have no effect.</span><br><span class="line">back_log = 500</span><br><span class="line"></span><br><span class="line"># Don&#x27;t listen on a TCP/IP port at all. This can be a security</span><br><span class="line"># enhancement, if all processes that need to connect to mysqld run</span><br><span class="line"># on the same host.  All interaction with mysqld must be made via Unix</span><br><span class="line"># sockets or named pipes.</span><br><span class="line"># Note that using this option without enabling named pipes on Windows</span><br><span class="line"># (via the &quot;enable-named-pipe&quot; option) will render mysqld useless!</span><br><span class="line">#skip-networking</span><br><span class="line">skip-name-resolve</span><br><span class="line"></span><br><span class="line"># The maximum amount of concurrent sessions the MySQL server will</span><br><span class="line"># allow. One of these connections will be reserved for a user with</span><br><span class="line"># SUPER privileges to allow the administrator to login even if the</span><br><span class="line"># connection limit has been reached.</span><br><span class="line">max_connections = 1000</span><br><span class="line"></span><br><span class="line"># Maximum amount of errors allowed per host. If this limit is reached,</span><br><span class="line"># the host will be blocked from connecting to the MySQL server until</span><br><span class="line"># &quot;FLUSH HOSTS&quot; has been run or the server was restarted. Invalid</span><br><span class="line"># passwords and other errors during the connect phase result in</span><br><span class="line"># increasing this value. See the &quot;Aborted_connects&quot; status variable for</span><br><span class="line"># global counter.</span><br><span class="line">max_connect_errors = 100</span><br><span class="line"></span><br><span class="line"># The number of open tables for all threads. Increasing this value</span><br><span class="line"># increases the number of file descriptors that mysqld requires.</span><br><span class="line"># Therefore you have to make sure to set the amount of open files</span><br><span class="line"># allowed to at least 4096 in the variable &quot;open-files-limit&quot; in</span><br><span class="line"># section [mysqld_safe]</span><br><span class="line">table_open_cache = 2048</span><br><span class="line"></span><br><span class="line"># Enable external file level locking. Enabled file locking will have a</span><br><span class="line"># negative impact on performance, so only use it in case you have</span><br><span class="line"># multiple database instances running on the same files (note some</span><br><span class="line"># restrictions still apply!) or if you use other software relying on</span><br><span class="line"># locking MyISAM tables on file level.</span><br><span class="line">#external-locking</span><br><span class="line">skip-external-locking</span><br><span class="line"></span><br><span class="line"># The maximum size of a query packet the server can handle as well as</span><br><span class="line"># maximum query size server can process (Important when working with</span><br><span class="line"># large BLOBs).  enlarged dynamically, for each connection.</span><br><span class="line">max_allowed_packet = 512M</span><br><span class="line"></span><br><span class="line"># The size of the cache to hold the SQL statements for the binary log</span><br><span class="line"># during a transaction. If you often use big, multi-statement</span><br><span class="line"># transactions you can increase this value to get more performance. All</span><br><span class="line"># statements from transactions are buffered in the binary log cache and</span><br><span class="line"># are being written to the binary log at once after the COMMIT.  If the</span><br><span class="line"># transaction is larger than this value, temporary file on disk is used</span><br><span class="line"># instead.  This buffer is allocated per connection on first update</span><br><span class="line"># statement in transaction</span><br><span class="line">binlog_cache_size = 10M</span><br><span class="line"></span><br><span class="line"># Maximum allowed size for a single HEAP (in memory) table. This option</span><br><span class="line"># is a protection against the accidential creation of a very large HEAP</span><br><span class="line"># table which could otherwise use up all memory resources.</span><br><span class="line">max_heap_table_size = 64M</span><br><span class="line"></span><br><span class="line"># Size of the buffer used for doing full table scans.</span><br><span class="line"># Allocated per thread, if a full scan is needed.</span><br><span class="line">read_buffer_size = 2M</span><br><span class="line"></span><br><span class="line"># When reading rows in sorted order after a sort, the rows are read</span><br><span class="line"># through this buffer to avoid disk seeks. You can improve ORDER BY</span><br><span class="line"># performance a lot, if set this to a high value.</span><br><span class="line"># Allocated per thread, when needed.</span><br><span class="line">read_rnd_buffer_size = 16M</span><br><span class="line"></span><br><span class="line"># Sort buffer is used to perform sorts for some ORDER BY and GROUP BY</span><br><span class="line"># queries. If sorted data does not fit into the sort buffer, a disk</span><br><span class="line"># based merge sort is used instead - See the &quot;Sort_merge_passes&quot;</span><br><span class="line"># status variable. Allocated per thread if sort is needed.</span><br><span class="line">sort_buffer_size = 8M</span><br><span class="line"></span><br><span class="line"># This buffer is used for the optimization of full JOINs (JOINs without</span><br><span class="line"># indexes). Such JOINs are very bad for performance in most cases</span><br><span class="line"># anyway, but setting this variable to a large value reduces the</span><br><span class="line"># performance impact. See the &quot;Select_full_join&quot; status variable for a</span><br><span class="line"># count of full JOINs. Allocated per thread if full join is found</span><br><span class="line">join_buffer_size = 8M</span><br><span class="line"></span><br><span class="line"># How many threads we should keep in a cache for reuse. When a client</span><br><span class="line"># disconnects, the client&#x27;s threads are put in the cache if there aren&#x27;t</span><br><span class="line"># more than thread_cache_size threads from before.  This greatly reduces</span><br><span class="line"># the amount of thread creations needed if you have a lot of new</span><br><span class="line"># connections. (Normally this doesn&#x27;t give a notable performance</span><br><span class="line"># improvement if you have a good thread implementation.)</span><br><span class="line">#thread_cache_size = 8</span><br><span class="line"></span><br><span class="line"># This permits the application to give the threads system a hint for the</span><br><span class="line"># desired number of threads that should be run at the same time.  This</span><br><span class="line"># value only makes sense on systems that support the thread_concurrency()</span><br><span class="line"># function call (Sun Solaris, for example).</span><br><span class="line"># You should try [number of CPUs]*(2..4) for thread_concurrency</span><br><span class="line">#thread_concurrency = 8</span><br><span class="line"></span><br><span class="line"># Query cache is used to cache SELECT results and later return them</span><br><span class="line"># without actual executing the same query once again. Having the query</span><br><span class="line"># cache enabled may result in significant speed improvements, if your</span><br><span class="line"># have a lot of identical queries and rarely changing tables. See the</span><br><span class="line"># &quot;Qcache_lowmem_prunes&quot; status variable to check if the current value</span><br><span class="line"># is high enough for your load.</span><br><span class="line"># Note: In case your tables change very often or if your queries are</span><br><span class="line"># textually different every time, the query cache may result in a</span><br><span class="line"># slowdown instead of a performance improvement.</span><br><span class="line">query_cache_type= 0</span><br><span class="line">query_cache_size = 0</span><br><span class="line"></span><br><span class="line"># Only cache result sets that are smaller than this limit. This is to</span><br><span class="line"># protect the query cache of a very large result set overwriting all</span><br><span class="line"># other query results.</span><br><span class="line">#query_cache_limit = 2M</span><br><span class="line"></span><br><span class="line"># Minimum word length to be indexed by the full text search index.</span><br><span class="line"># You might wish to decrease it if you need to search for shorter words.</span><br><span class="line"># Note that you need to rebuild your FULLTEXT index, after you have</span><br><span class="line"># modified this value.</span><br><span class="line">ft_min_word_len = 4</span><br><span class="line"></span><br><span class="line"># If your system supports the memlock() function call, you might want to</span><br><span class="line"># enable this option while running MySQL to keep it locked in memory and</span><br><span class="line"># to avoid potential swapping out in case of high memory pressure. Good</span><br><span class="line"># for performance.</span><br><span class="line">#memlock</span><br><span class="line"></span><br><span class="line"># Table type which is used by default when creating new tables, if not</span><br><span class="line"># specified differently during the CREATE TABLE statement.</span><br><span class="line">default-storage-engine = INNODB</span><br><span class="line"></span><br><span class="line"># Thread stack size to use. This amount of memory is always reserved at</span><br><span class="line"># connection time. MySQL itself usually needs no more than 64K of</span><br><span class="line"># memory, while if you use your own stack hungry UDF functions or your</span><br><span class="line"># OS requires more stack for some operations, you might need to set this</span><br><span class="line"># to a higher value.</span><br><span class="line">thread_stack = 192K</span><br><span class="line"></span><br><span class="line"># Set the default transaction isolation level. Levels available are:</span><br><span class="line"># READ-UNCOMMITTED, READ-COMMITTED, REPEATABLE-READ, SERIALIZABLE</span><br><span class="line">transaction_isolation = REPEATABLE-READ</span><br><span class="line"></span><br><span class="line"># Maximum size for internal (in-memory) temporary tables. If a table</span><br><span class="line"># grows larger than this value, it is automatically converted to disk</span><br><span class="line"># based table This limitation is for a single table. There can be many</span><br><span class="line"># of them.</span><br><span class="line">tmp_table_size = 64M</span><br><span class="line"></span><br><span class="line"># Enable binary logging. This is required for acting as a MASTER in a</span><br><span class="line"># replication configuration. You also need the binary log if you need</span><br><span class="line"># the ability to do point in time recovery from your latest backup.</span><br><span class="line">log-bin                 = /db/mysql_5.6/logs/mysql-bin</span><br><span class="line"></span><br><span class="line"># binary logging format - mixed recommended</span><br><span class="line">binlog_format=mixed</span><br><span class="line"></span><br><span class="line">general_log             = 0</span><br><span class="line">general_log_file        = /db/mysql_5.6/logs/mysql_general.log</span><br><span class="line"></span><br><span class="line"># If you&#x27;re using replication with chained slaves (A-&gt;B-&gt;C), you need to</span><br><span class="line"># enable this option on server B. It enables logging of updates done by</span><br><span class="line"># the slave thread into the slave&#x27;s binary log.</span><br><span class="line">#log_slave_updates</span><br><span class="line"></span><br><span class="line"># Enable the full query log. Every query (even ones with incorrect</span><br><span class="line"># syntax) that the server receives will be logged. This is useful for</span><br><span class="line"># debugging, it is usually disabled in production use.</span><br><span class="line">#log</span><br><span class="line"></span><br><span class="line"># Print warnings to the error log file.  If you have any problem with</span><br><span class="line"># MySQL you should enable logging of warnings and examine the error log</span><br><span class="line"># for possible explanations.</span><br><span class="line">#log_warnings</span><br><span class="line"></span><br><span class="line"># Log slow queries. Slow queries are queries which take more than the</span><br><span class="line"># amount of time defined in &quot;long_query_time&quot; or which do not use</span><br><span class="line"># indexes well, if log_short_format is not enabled. It is normally good idea</span><br><span class="line"># to have this turned on if you frequently add new queries to the</span><br><span class="line"># system.</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">#error log</span><br><span class="line">log-error=/db/mysql_5.6/logs/error.log</span><br><span class="line"></span><br><span class="line">slow_query_log = 1</span><br><span class="line">slow_query_log_file = /db/mysql_5.6/logs/slow-query.log</span><br><span class="line"></span><br><span class="line"># All queries taking more than this amount of time (in seconds) will be</span><br><span class="line"># trated as slow. Do not use &quot;1&quot; as a value here, as this will result in</span><br><span class="line"># even very fast queries being logged from time to time (as MySQL</span><br><span class="line"># currently measures time with second accuracy only).</span><br><span class="line">long_query_time = 5</span><br><span class="line">log-queries-not-using-indexes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ***  Replication related settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Unique server identification number between 1 and 2^32-1. This value</span><br><span class="line"># is required for both master and slave hosts. It defaults to 1 if</span><br><span class="line"># &quot;master-host&quot; is not set, but will MySQL will not function as a master</span><br><span class="line"># if it is omitted.</span><br><span class="line">server-id = 2481</span><br><span class="line"></span><br><span class="line"># Replication Slave (comment out master section to use this)</span><br><span class="line">#</span><br><span class="line"># To configure this host as a replication slave, you can choose between</span><br><span class="line"># two methods :</span><br><span class="line">#</span><br><span class="line"># 1) Use the CHANGE MASTER TO command (fully described in our manual) -</span><br><span class="line">#    the syntax is:</span><br><span class="line">#</span><br><span class="line">#    CHANGE MASTER TO MASTER_HOST=&lt;host&gt;, MASTER_PORT=&lt;port&gt;,</span><br><span class="line">#    MASTER_USER=&lt;user&gt;, MASTER_PASSWORD=&lt;password&gt; ;</span><br><span class="line">#</span><br><span class="line">#    where you replace &lt;host&gt;, &lt;user&gt;, &lt;password&gt; by quoted strings and</span><br><span class="line">#    &lt;port&gt; by the master&#x27;s port number (3306 by default).</span><br><span class="line">#</span><br><span class="line">#    Example:</span><br><span class="line">#</span><br><span class="line">#    CHANGE MASTER TO MASTER_HOST=&#x27;125.564.12.1&#x27;, MASTER_PORT=3306,</span><br><span class="line">#    MASTER_USER=&#x27;joe&#x27;, MASTER_PASSWORD=&#x27;secret&#x27;;</span><br><span class="line">#</span><br><span class="line"># OR</span><br><span class="line">#</span><br><span class="line"># 2) Set the variables below. However, in case you choose this method, then</span><br><span class="line">#    start replication for the first time (even unsuccessfully, for example</span><br><span class="line">#    if you mistyped the password in master-password and the slave fails to</span><br><span class="line">#    connect), the slave will create a master.info file, and any later</span><br><span class="line">#    changes in this file to the variable values below will be ignored and</span><br><span class="line">#    overridden by the content of the master.info file, unless you shutdown</span><br><span class="line">#    the slave server, delete master.info and restart the slaver server.</span><br><span class="line">#    For that reason, you may want to leave the lines below untouched</span><br><span class="line">#    (commented) and instead use CHANGE MASTER TO (see above)</span><br><span class="line">#</span><br><span class="line"># required unique id between 2 and 2^32 - 1</span><br><span class="line"># (and different from the master)</span><br><span class="line"># defaults to 2 if master-host is set</span><br><span class="line"># but will not function as a slave if omitted</span><br><span class="line">#server-id = 2</span><br><span class="line">#</span><br><span class="line"># The replication master for this slave - required</span><br><span class="line">#master-host = &lt;hostname&gt;</span><br><span class="line">#</span><br><span class="line"># The username the slave will use for authentication when connecting</span><br><span class="line"># to the master - required</span><br><span class="line">#master-user = &lt;username&gt;</span><br><span class="line">#</span><br><span class="line"># The password the slave will authenticate with when connecting to</span><br><span class="line"># the master - required</span><br><span class="line">#master-password = &lt;password&gt;</span><br><span class="line">#</span><br><span class="line"># The port the master is listening on.</span><br><span class="line"># optional - defaults to 3306</span><br><span class="line">#master-port = &lt;port&gt;</span><br><span class="line"></span><br><span class="line"># Make the slave read-only. Only users with the SUPER privilege and the</span><br><span class="line"># replication slave thread will be able to modify data on it. You can</span><br><span class="line"># use this to ensure that no applications will accidently modify data on</span><br><span class="line"># the slave instead of the master</span><br><span class="line">#read_only</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#*** MyISAM Specific options</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Size of the Key Buffer, used to cache index blocks for MyISAM tables.</span><br><span class="line"># Do not set it larger than 30% of your available memory, as some memory</span><br><span class="line"># is also required by the OS to cache rows. Even if you&#x27;re not using</span><br><span class="line"># MyISAM tables, you should still set it to 8-64M as it will also be</span><br><span class="line"># used for internal temporary disk tables.</span><br><span class="line">key_buffer_size = 32M</span><br><span class="line"></span><br><span class="line"># MyISAM uses special tree-like cache to make bulk inserts (that is,</span><br><span class="line"># INSERT ... SELECT, INSERT ... VALUES (...), (...), ..., and LOAD DATA</span><br><span class="line"># INFILE) faster. This variable limits the size of the cache tree in</span><br><span class="line"># bytes per thread. Setting it to 0 will disable this optimisation.  Do</span><br><span class="line"># not set it larger than &quot;key_buffer_size&quot; for optimal performance.</span><br><span class="line"># This buffer is allocated when a bulk insert is detected.</span><br><span class="line">bulk_insert_buffer_size = 64M</span><br><span class="line"></span><br><span class="line"># This buffer is allocated when MySQL needs to rebuild the index in</span><br><span class="line"># REPAIR, OPTIMIZE, ALTER table statements as well as in LOAD DATA INFILE</span><br><span class="line"># into an empty table. It is allocated per thread so be careful with</span><br><span class="line"># large settings.</span><br><span class="line">myisam_sort_buffer_size = 128M</span><br><span class="line"></span><br><span class="line"># The maximum size of the temporary file MySQL is allowed to use while</span><br><span class="line"># recreating the index (during REPAIR, ALTER TABLE or LOAD DATA INFILE.</span><br><span class="line"># If the file-size would be bigger than this, the index will be created</span><br><span class="line"># through the key cache (which is slower).</span><br><span class="line">myisam_max_sort_file_size = 10G</span><br><span class="line"></span><br><span class="line"># If a table has more than one index, MyISAM can use more than one</span><br><span class="line"># thread to repair them by sorting in parallel. This makes sense if you</span><br><span class="line"># have multiple CPUs and plenty of memory.</span><br><span class="line">myisam_repair_threads = 1</span><br><span class="line"></span><br><span class="line"># Automatically check and repair not properly closed MyISAM tables.</span><br><span class="line">myisam_recover</span><br><span class="line"></span><br><span class="line"># *** INNODB Specific options ***</span><br><span class="line"></span><br><span class="line">innodb_file_per_table=1</span><br><span class="line"></span><br><span class="line"># Use this option if you have a MySQL server with InnoDB support enabled</span><br><span class="line"># but you do not plan to use it. This will save memory and disk space</span><br><span class="line"># and speed up some things.</span><br><span class="line">#skip-innodb</span><br><span class="line"></span><br><span class="line"># Additional memory pool that is used by InnoDB to store metadata</span><br><span class="line"># information.  If InnoDB requires more memory for this purpose it will</span><br><span class="line"># start to allocate it from the OS.  As this is fast enough on most</span><br><span class="line"># recent operating systems, you normally do not need to change this</span><br><span class="line"># value. SHOW INNODB STATUS will display the current amount used.</span><br><span class="line">innodb_additional_mem_pool_size = 16M</span><br><span class="line"></span><br><span class="line"># InnoDB, unlike MyISAM, uses a buffer pool to cache both indexes and</span><br><span class="line"># row data. The bigger you set this the less disk I/O is needed to</span><br><span class="line"># access data in tables. On a dedicated database server you may set this</span><br><span class="line"># parameter up to 80% of the machine physical memory size. Do not set it</span><br><span class="line"># too large, though, because competition of the physical memory may</span><br><span class="line"># cause paging in the operating system.  Note that on 32bit systems you</span><br><span class="line"># might be limited to 2-3.5G of user level memory per process, so do not</span><br><span class="line"># set it too high.</span><br><span class="line">innodb_buffer_pool_size = 25G</span><br><span class="line"></span><br><span class="line"># InnoDB stores data in one or more data files forming the tablespace.</span><br><span class="line"># If you have a single logical drive for your data, a single</span><br><span class="line"># autoextending file would be good enough. In other cases, a single file</span><br><span class="line"># per device is often a good choice. You can configure InnoDB to use raw</span><br><span class="line"># disk partitions as well - please refer to the manual for more info</span><br><span class="line"># about this.</span><br><span class="line">innodb_data_file_path = ibdata1:2048M:autoextend</span><br><span class="line"></span><br><span class="line"># Set this option if you would like the InnoDB tablespace files to be</span><br><span class="line"># stored in another location. By default this is the MySQL datadir.</span><br><span class="line">innodb_data_home_dir = /db/mysql_5.6/data</span><br><span class="line"></span><br><span class="line"># Number of IO threads to use for async IO operations. This value is</span><br><span class="line"># hardcoded to 4 on Unix, but on Windows disk I/O may benefit from a</span><br><span class="line"># larger number.</span><br><span class="line">innodb_file_io_threads = 4</span><br><span class="line"></span><br><span class="line"># If you run into InnoDB tablespace corruption, setting this to a nonzero</span><br><span class="line"># value will likely help you to dump your tables. Start from value 1 and</span><br><span class="line"># increase it until you&#x27;re able to dump the table successfully.</span><br><span class="line">#innodb_force_recovery=1</span><br><span class="line"></span><br><span class="line"># Number of threads allowed inside the InnoDB kernel. The optimal value</span><br><span class="line"># depends highly on the application, hardware as well as the OS</span><br><span class="line"># scheduler properties. A too high value may lead to thread thrashing.</span><br><span class="line">innodb_thread_concurrency = 16</span><br><span class="line"></span><br><span class="line"># If set to 1, InnoDB will flush (fsync) the transaction logs to the</span><br><span class="line"># disk at each commit, which offers full ACID behavior. If you are</span><br><span class="line"># willing to compromise this safety, and you are running small</span><br><span class="line"># transactions, you may set this to 0 or 2 to reduce disk I/O to the</span><br><span class="line"># logs. Value 0 means that the log is only written to the log file and</span><br><span class="line"># the log file flushed to disk approximately once per second. Value 2</span><br><span class="line"># means the log is written to the log file at each commit, but the log</span><br><span class="line"># file is only flushed to disk approximately once per second.</span><br><span class="line">innodb_flush_log_at_trx_commit = 2</span><br><span class="line"></span><br><span class="line"># Speed up InnoDB shutdown. This will disable InnoDB to do a full purge</span><br><span class="line"># and insert buffer merge on shutdown. It may increase shutdown time a</span><br><span class="line"># lot, but InnoDB will have to do it on the next startup instead.</span><br><span class="line">#innodb_fast_shutdown</span><br><span class="line"></span><br><span class="line"># The size of the buffer InnoDB uses for buffering log data. As soon as</span><br><span class="line"># it is full, InnoDB will have to flush it to disk. As it is flushed</span><br><span class="line"># once per second anyway, it does not make sense to have it very large</span><br><span class="line"># (even with long transactions).</span><br><span class="line">innodb_log_buffer_size = 10M</span><br><span class="line"></span><br><span class="line"># Size of each log file in a log group. You should set the combined size</span><br><span class="line"># of log files to about 25%-100% of your buffer pool size to avoid</span><br><span class="line"># unneeded buffer pool flush activity on log file overwrite. However,</span><br><span class="line"># note that a larger logfile size will increase the time needed for the</span><br><span class="line"># recovery process.</span><br><span class="line">innodb_log_file_size = 256M</span><br><span class="line"></span><br><span class="line"># Total number of files in the log group. A value of 2-3 is usually good</span><br><span class="line"># enough.</span><br><span class="line">innodb_log_files_in_group = 2</span><br><span class="line"></span><br><span class="line"># Location of the InnoDB log files. Default is the MySQL datadir. You</span><br><span class="line"># may wish to point it to a dedicated hard drive or a RAID1 volume for</span><br><span class="line"># improved performance</span><br><span class="line">#innodb_log_group_home_dir</span><br><span class="line"></span><br><span class="line"># Maximum allowed percentage of dirty pages in the InnoDB buffer pool.</span><br><span class="line"># If it is reached, InnoDB will start flushing them out agressively to</span><br><span class="line"># not run out of clean pages at all. This is a soft limit, not</span><br><span class="line"># guaranteed to be held.</span><br><span class="line">innodb_max_dirty_pages_pct = 90</span><br><span class="line"></span><br><span class="line"># The flush method InnoDB will use for Log. The tablespace always uses</span><br><span class="line"># doublewrite flush logic. The default value is &quot;fdatasync&quot;, another</span><br><span class="line"># option is &quot;O_DSYNC&quot;.</span><br><span class="line">#innodb_flush_method=O_DSYNC</span><br><span class="line"></span><br><span class="line"># How long an InnoDB transaction should wait for a lock to be granted</span><br><span class="line"># before being rolled back. InnoDB automatically detects transaction</span><br><span class="line"># deadlocks in its own lock table and rolls back the transaction. If you</span><br><span class="line"># use the LOCK TABLES command, or other transaction-safe storage engines</span><br><span class="line"># than InnoDB in the same transaction, then a deadlock may arise which</span><br><span class="line"># InnoDB cannot notice. In cases like this the timeout is useful to</span><br><span class="line"># resolve the situation.</span><br><span class="line">innodb_lock_wait_timeout = 120</span><br><span class="line"></span><br><span class="line"># * Security Features</span><br><span class="line">#</span><br><span class="line"># Read the manual, too, if you want chroot!</span><br><span class="line"># chroot = /var/lib/mysql/</span><br><span class="line">#</span><br><span class="line"># For generating SSL certificates I recommend the OpenSSL GUI &quot;tinyca&quot;.</span><br><span class="line">#</span><br><span class="line"># ssl-ca=/etc/mysql/cacert.pem</span><br><span class="line"># ssl-cert=/etc/mysql/server-cert.pem</span><br><span class="line"># ssl-key=/etc/mysql/server-key.pem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">net_read_timeout	=	600</span><br><span class="line">net_write_timeout	=	600</span><br><span class="line">lower_case_table_names=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line"># Do not buffer the whole result set in memory before writing it to</span><br><span class="line"># file. Required for dumping very large tables</span><br><span class="line">quick</span><br><span class="line"></span><br><span class="line">max_allowed_packet = 16M</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br><span class="line"></span><br><span class="line"># Only allow UPDATEs and DELETEs that use keys.</span><br><span class="line">#safe-updates</span><br><span class="line"></span><br><span class="line">[myisamchk]</span><br><span class="line">key_buffer_size = 512M</span><br><span class="line">sort_buffer_size = 512M</span><br><span class="line">read_buffer = 8M</span><br><span class="line">write_buffer = 8M</span><br><span class="line"></span><br><span class="line">[mysqlhotcopy]</span><br><span class="line">interactive-timeout</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line"># Increase the amount of open files allowed per process. Warning: Make</span><br><span class="line"># sure you have set the global system limit high enough! The high value</span><br><span class="line"># is required for a large number of opened tables</span><br><span class="line">#open-files-limit = 20480</span><br><span class="line"></span><br><span class="line">socket		= /var/run/mysqld/mysqld.sock</span><br><span class="line">#nice		= 0</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>database</tag>
        <tag>mysql</tag>
        <tag>cnf</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL无密码登陆（MySQL_config_editor用法）</title>
    <url>/2017/03/16/mysql_nopassword/</url>
    <content><![CDATA[<h4 id="mysql-config-editor是MySQL5-6-6以后版本的工具。这个工具可以认证信息加密存储在-mylogin-cnf中，通常这个文件在Linux用户的家目录和Windows的-APPDATA-MySQL目录中。"><a href="#mysql-config-editor是MySQL5-6-6以后版本的工具。这个工具可以认证信息加密存储在-mylogin-cnf中，通常这个文件在Linux用户的家目录和Windows的-APPDATA-MySQL目录中。" class="headerlink" title="mysql_config_editor是MySQL5.6.6以后版本的工具。这个工具可以认证信息加密存储在.mylogin.cnf中，通常这个文件在Linux用户的家目录和Windows的%APPDATA%\MySQL目录中。"></a>mysql_config_editor是MySQL5.6.6以后版本的工具。这个工具可以认证信息加密存储在<code>.mylogin.cnf</code>中，通常这个文件在Linux用户的<code>家目录</code>和Windows的<code>%APPDATA%\MySQL</code>目录中。</h4><h5 id="mylogin-cnf文件未加密的示例如下："><a href="#mylogin-cnf文件未加密的示例如下：" class="headerlink" title=".mylogin.cnf文件未加密的示例如下："></a><code>.mylogin.cnf</code>文件未加密的示例如下：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[client]</span><br><span class="line">user = mydefaultname</span><br><span class="line">password = mydefaultpass</span><br><span class="line">host = 127.0.0.1</span><br><span class="line">[mypath]</span><br><span class="line">user = myothername</span><br><span class="line">password = myotherpass</span><br><span class="line">host = localhost</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实际使用时密码会被加密。</p>
<blockquote>
<p>大坑！！！ 含有特殊字符的密码不能加密成功，没有报错，但是登陆会提示密码错误，让人迷惑。    —-于2017&#x2F;04&#x2F;01更新</p>
</blockquote>
</blockquote>
<span id="more"></span>
<h5 id="mysql-config-editor的用法"><a href="#mysql-config-editor的用法" class="headerlink" title="mysql_config_editor的用法"></a>mysql_config_editor的用法</h5><p><code>shell&gt; mysql_config_editor [program_options] command [command_options]</code></p>
<h4 id="添加认证信息"><a href="#添加认证信息" class="headerlink" title="添加认证信息"></a>添加认证信息</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#添加认证时查看帮助信息</span><br><span class="line">shell&gt; mysql_config_editor --help set</span><br><span class="line">shell&gt; mysql_config_editor set --help</span><br><span class="line"></span><br><span class="line">#添加认证信息</span><br><span class="line">shell&gt; mysql_config_editor set --login-path=client</span><br><span class="line">         --host=localhost --user=localuser --password</span><br><span class="line">Enter password: enter password &quot;localpass&quot; here</span><br><span class="line">shell&gt; mysql_config_editor set --login-path=remote</span><br><span class="line">         --host=remote.example.com --user=remoteuser --password</span><br><span class="line">Enter password: enter password &quot;remotepass&quot; here</span><br><span class="line"></span><br><span class="line">#查看已经添加的认证信息</span><br><span class="line">shell&gt; mysql_config_editor print --all</span><br><span class="line">[client]</span><br><span class="line">user = localuser</span><br><span class="line">password = *****</span><br><span class="line">host = localhost</span><br><span class="line">[remote]</span><br><span class="line">user = remoteuser</span><br><span class="line">password = *****</span><br><span class="line">host = remote.example.com</span><br></pre></td></tr></table></figure>

<h4 id="无密码登陆"><a href="#无密码登陆" class="headerlink" title="无密码登陆"></a>无密码登陆</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shell&gt; mysql --login-path=remote</span><br><span class="line"></span><br><span class="line">shell&gt; mysql --login-path=client</span><br><span class="line">#因为mysql默认读取login-path=client的认证信息，所以上条命令可以简化如下</span><br><span class="line">shell&gt; mysql</span><br><span class="line"></span><br><span class="line">shell&gt; mysql --login-path=remote --host=remote2.example.com</span><br></pre></td></tr></table></figure>
<h4 id="移除认证信息"><a href="#移除认证信息" class="headerlink" title="移除认证信息"></a>移除认证信息</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shell&gt; mysql_config_editor remove --login-path=mypath --user</span><br><span class="line">shell&gt; mysql_config_editor remove --login-path=mypath</span><br></pre></td></tr></table></figure>

<h4 id="查看帮助"><a href="#查看帮助" class="headerlink" title="查看帮助"></a>查看帮助</h4><p><code>shell&gt; mysql_config_editor command --help</code></p>
<h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><p><a href="https://dev.mysql.com/doc/refman/5.6/en/mysql-config-editor.html">https://dev.mysql.com/doc/refman/5.6/en/mysql-config-editor.html</a><br><a href="https://dev.mysql.com/doc/refman/5.7/en/mysql-config-editor.html">https://dev.mysql.com/doc/refman/5.7/en/mysql-config-editor.html</a></p>
]]></content>
      <tags>
        <tag>conf</tag>
        <tag>database</tag>
        <tag>mysql</tag>
        <tag>脚本</tag>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>ngrok server 简单部署</title>
    <url>/2017/12/10/ngrok_generate/</url>
    <content><![CDATA[<ul>
<li><a href="https://github.com/inconshreveable/ngrok/releases">ngrok下载</a></li>
<li>生成网站证书<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">openssl genrsa -out rootCA.key 4096</span><br><span class="line">openssl req -x509 -new -nodes -key rootCA.key -subj &quot;/CN=kebyn.cc&quot; -days 36500 -out rootCA.pem</span><br><span class="line">openssl genrsa -out device.key 4096</span><br><span class="line">openssl req -new -key device.key -subj &quot;/CN=kebyn.cc&quot; -out device.csr</span><br><span class="line">openssl x509 -req -in device.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out device.crt -days 36500</span><br></pre></td></tr></table></figure></li>
<li>替换 ngrok 默认证书<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cp rootCA.pem ../assets/client/tls/ngrokroot.crt</span><br><span class="line">cp device.crt ../assets/server/tls/snakeoil.crt</span><br><span class="line">cp device.key ../assets/server/tls/snakeoil.key</span><br></pre></td></tr></table></figure></li>
<li>非 root 用户<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo GOOS=darwin GOARCH=386 make release-all &amp;&amp; sudo GOOS=darwin GOARCH=amd64 make release-all &amp;&amp;sudo GOOS=linux GOARCH=386 make release-all &amp;&amp; sudo GOOS=linux GOARCH=amd64 make release-all &amp;&amp;sudo GOOS=linux GOARCH=arm make release-all &amp;&amp; sudo GOOS=linux GOARCH=arm64 make release-all &amp;&amp;sudo GOOS=windows GOARCH=386 make release-all &amp;&amp; sudo GOOS=windows GOARCH=amd64 make release-all</span><br></pre></td></tr></table></figure></li>
<li>root 用户<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GOOS=darwin GOARCH=386 make release-all &amp;&amp; GOOS=darwin GOARCH=amd64 make release-all &amp;&amp; GOOS=linux GOARCH=386 make release-all &amp;&amp; GOOS=linux GOARCH=amd64 make release-all &amp;&amp; GOOS=linux GOARCH=arm make release-all &amp;&amp; GOOS=linux GOARCH=arm64 make release-all &amp;&amp; GOOS=windows GOARCH=386 make release-all &amp;&amp; GOOS=windows GOARCH=amd64 make release-all</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>ngrok</tag>
        <tag>内网穿透</tag>
      </tags>
  </entry>
  <entry>
    <title>ocs_ng 安装</title>
    <url>/2017/07/20/ocsinventory-ng_install/</url>
    <content><![CDATA[<ol>
<li>Unpack it.<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar –xvzf Ocsinventory-Agent-2.0.x.tar.gz</span><br><span class="line">cd Ocsinventory-Agent-2.0.x</span><br></pre></td></tr></table></figure></li>
<li>Check perl configuration with the script Makefile.PL. Its looks at the configuration of Perl, machine, libraries … and it generates the Makefile. During this step, we will create a temporary environment variable to install agent non-interactively.<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">env PERL_AUTOINSTALL=1 perl Makefile.PL</span><br></pre></td></tr></table></figure>
Exemple :<br> Please install Crypt::SSLeay if you want to use SSL.<br> Please install nmap or ipdiscover if you want to use the network discover feature.<br> Please install Proc::Daemon and Proc::PID::File if you want to use the daemon monde.</li>
<li>Compilation<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure></li>
</ol>
<p><a href="http://wiki.ocsinventory-ng.org/index.php?title=Documentation:UnixAgent">引用</a></p>
]]></content>
      <tags>
        <tag>git</tag>
        <tag>git key</tag>
      </tags>
  </entry>
  <entry>
    <title>openssh</title>
    <url>/2015/07/17/openssh/</url>
    <content><![CDATA[<h3 id="etc-ssh-ssh-config-文件"><a href="#etc-ssh-ssh-config-文件" class="headerlink" title="&#x2F;etc&#x2F;ssh&#x2F;ssh_config 文件"></a>&#x2F;etc&#x2F;ssh&#x2F;ssh_config 文件</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Site-wide defaults for various options</span><br><span class="line">Host *</span><br><span class="line">&quot;Host&quot;只对匹配后面字串的计算机有效，“*”表示所有的计算机。从该项格式前置一些可以看出，这是一个类似于全局的选项，表示下面缩进的选项都适用于该设置，可以指定某计算机替换*号使下面选项只针对该算机器生效。</span><br><span class="line">ForwardAgent no</span><br><span class="line">&quot;ForwardAgent&quot;设置连接是否经过验证代理（如果存在）转发给远程计算机。</span><br><span class="line">ForwardX11 no</span><br><span class="line">&quot;ForwardX11&quot;设置X11连接是否被自动重定向到安全的通道和显示集（DISPLAY set）。</span><br><span class="line">RhostsAuthentication no</span><br><span class="line">&quot;RhostsAuthentication&quot;设置是否使用基于rhosts的安全验证。</span><br><span class="line">RhostsRSAAuthentication no</span><br><span class="line">&quot;RhostsRSAAuthentication&quot;设置是否使用用RSA算法的基于rhosts的安全验证。</span><br><span class="line">RSAAuthentication yes</span><br><span class="line">&quot;RSAAuthentication&quot;设置是否使用RSA算法进行安全验证。</span><br><span class="line">PasswordAuthentication yes</span><br><span class="line">&quot;PasswordAuthentication&quot;设置是否使用口令验证。</span><br><span class="line">FallBackToRsh no</span><br><span class="line">&quot;FallBackToRsh&quot;设置如果用ssh连接出现错误是否自动使用rsh，由于rsh并不安全，所以此选项应当设置为&quot;no&quot;。</span><br><span class="line">UseRsh no</span><br><span class="line">&quot;UseRsh&quot;设置是否在这台计算机上使用&quot;rlogin/rsh&quot;，原因同上，设为&quot;no&quot;。</span><br><span class="line">BatchMode no</span><br><span class="line">&quot;BatchMode&quot;：批处理模式，一般设为&quot;no&quot;；如果设为&quot;yes&quot;，交互式输入口令的提示将被禁止，这个选项对脚本文件和批处理任务十分有用。</span><br><span class="line">CheckHostIP yes</span><br><span class="line">&quot;CheckHostIP&quot;设置ssh是否查看连接到服务器的主机的IP地址以防止DNS欺骗。建议设置为&quot;yes&quot;。</span><br><span class="line">StrictHostKeyChecking no</span><br><span class="line">&quot;StrictHostKeyChecking&quot;如果设为&quot;yes&quot;，ssh将不会自动把计算机的密匙加入&quot;$HOME/.ssh/known_hosts&quot;文件，且一旦计算机的密匙发生了变化，就拒绝连接。</span><br><span class="line">IdentityFile ~/.ssh/identity</span><br><span class="line">&quot;IdentityFile&quot;设置读取用户的RSA安全验证标识。</span><br><span class="line">Port 22</span><br><span class="line">&quot;Port&quot;设置连接到远程主机的端口，ssh默认端口为22。</span><br><span class="line">Cipher blowfish</span><br><span class="line">“Cipher”设置加密用的密钥，blowfish可以自己随意设置。</span><br><span class="line">EscapeChar ~</span><br><span class="line">“EscapeChar”设置escape字符。</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<hr>
<h3 id="etc-ssh-sshd-config-文件"><a href="#etc-ssh-sshd-config-文件" class="headerlink" title="&#x2F;etc&#x2F;ssh&#x2F;sshd_config 文件"></a>&#x2F;etc&#x2F;ssh&#x2F;sshd_config 文件</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 关于 SSH Server 的整体设定，包含使用的 port 啦，以及使用的密码演算方式</span><br><span class="line">Port 22　　　　　　　　　# SSH 预设使用 22 这个 port，您也可以使用多的 port ！</span><br><span class="line">  　　　　　　  　　　　　 # 亦即重复使用 port 这个设定项目即可！</span><br><span class="line">Protocol 2,1　 　　　　 # 选择的 SSH 协议版本，可以是 1 也可以是 2 ，</span><br><span class="line">　　　　　　　　　　　　　 # 如果要同时支持两者，就必须要使用 2,1 这个分隔了！</span><br><span class="line">#ListenAddress 0.0.0.0　　 # 监听的主机适配卡！举个例子来说，如果您有两个 IP，</span><br><span class="line"> 　　　　　　　　　　　　　 # 分别是 192.168.0.100 及 192.168.2.20 ，那么只想要</span><br><span class="line"> 　　　　　　　　　　　　　 # 开放 192.168.0.100 时，就可以写如同下面的样式：</span><br><span class="line">ListenAddress 192.168.0.100          # 只监听来自 192.168.0.100 这个 IP 的SSH联机。</span><br><span class="line"> 　　　　　　　　　　　　　　　　　　 # 如果不使用设定的话，则预设所有接口均接受 SSH</span><br><span class="line">PidFile /var/run/sshd.pid　　　　　　# 可以放置 SSHD 这个 PID 的档案！左列为默认值</span><br><span class="line">LoginGraceTime 600　　　　 # 当使用者连上 SSH server 之后，会出现输入密码的画面，</span><br><span class="line">　　　　　　　　　　　　 # 在该画面中，在多久时间内没有成功连上 SSH server ，</span><br><span class="line"> 　　　　　　　　　　　　　 # 就断线！时间为秒！</span><br><span class="line">Compression yes　　　　　　# 是否可以使用压缩指令？当然可以啰！</span><br><span class="line"></span><br><span class="line"># 主机的 Private Key 放置的档案，预设使用下面的档案即可！</span><br><span class="line">HostKey /etc/ssh/ssh_host_key　　　　# SSH version 1 使用的私钥</span><br><span class="line">HostKey /etc/ssh/ssh_host_rsa_key　　# SSH version 2 使用的 RSA 私钥</span><br><span class="line">HostKey /etc/ssh/ssh_host_dsa_key　　# SSH version 2 使用的 DSA 私钥</span><br><span class="line">#  关于 version 1 的一些设定！</span><br><span class="line">KeyRegenerationInterval 3600　 　　# 由前面联机的说明可以知道， version 1 会使用</span><br><span class="line"> 　　　　　　　　　　　　　　　　　　 # server 的 Public Key ，那么如果这个 Public</span><br><span class="line"> 　　　　　　　　　　　　　　　　　　 # Key 被偷的话，岂不完蛋？所以需要每隔一段时间</span><br><span class="line"> 　　　　　　　　　　　　　　　　　　 # 来重新建立一次！这里的时间为秒！</span><br><span class="line">ServerKeyBits 768 　　　　　　　　　 # 没错！这个就是 Server key 的长度！</span><br><span class="line">#  关于登录文件的讯息数据放置与 daemon 的名称！</span><br><span class="line">SyslogFacility AUTH　　　　　　　　　# 当有人使用 SSH 登入系统的时候，SSH会记录资</span><br><span class="line"> 　　　　　　　　　　　　　　　　　　 # 讯，这个信息要记录在什么 daemon name 底下？</span><br><span class="line"> 　　　　　　　　　　　　　　　　　　 # 预设是以 AUTH 来设定的，即是 /var/log/secure</span><br><span class="line"> 　　　　　　　　　　　　　　　　　　 # 里面！什么？忘记了！回到 Linux 基础去翻一下</span><br><span class="line"> 　　　　　　　　　　　　　　　　　　 # 其它可用的 daemon name 为：DAEMON,USER,AUTH,</span><br><span class="line"> 　　　　　　　　　　　　　　　　　　 # LOCAL0,LOCAL1,LOCAL2,LOCAL3,LOCAL4,LOCAL5,</span><br><span class="line">LogLevel INFO　　　　　　　　　　　　# 登录记录的等级！嘿嘿！任何讯息！</span><br><span class="line"> 　　　　　　　　　　　　　　　　　　 # 同样的，忘记了就回去参考！</span><br><span class="line">#  安全设定项目！极重要！</span><br><span class="line">#  登入设定部分</span><br><span class="line">PermitRootLogin no　　 　　# 是否允许 root 登入！预设是允许的，但是建议设定成 no！</span><br><span class="line">UserLogin no　　　　　　　 # 在 SSH 底下本来就不接受 login 这个程序的登入！</span><br><span class="line">StrictModes yes　　　　　　# 当使用者的 host key 改变之后，Server 就不接受联机，</span><br><span class="line"> 　　　　　　　　　　　　　 # 可以抵挡部分的木马程序！</span><br><span class="line">#RSAAuthentication yes　　 # 是否使用纯的 RSA 认证！？仅针对 version 1 ！</span><br><span class="line">PubkeyAuthentication yes　 # 是否允许 Public Key ？当然允许啦！只有 version 2</span><br><span class="line">AuthorizedKeysFile      .ssh/authorized_keys</span><br><span class="line"> 　　　　　　　　　　　　　 # 上面这个在设定若要使用不需要密码登入的账号时，那么那个</span><br><span class="line"> 　　　　　　　　　　　　　 # 账号的存放档案所在档名！</span><br><span class="line">#  认证部分</span><br><span class="line">RhostsAuthentication no　　# 本机系统不止使用 .rhosts ，因为仅使用 .rhosts 太</span><br><span class="line">　　　　　　　　　　　　　 # 不安全了，所以这里一定要设定为 no ！</span><br><span class="line">IgnoreRhosts yes　　　　　 # 是否取消使用 ~/.ssh/.rhosts 来做为认证！当然是！</span><br><span class="line">RhostsRSAAuthentication no # 这个选项是专门给 version 1 用的，使用 rhosts 档案在</span><br><span class="line">　　　　　　　　　　　　　 # /etc/hosts.equiv配合 RSA 演算方式来进行认证！不要使用</span><br><span class="line">HostbasedAuthentication no # 这个项目与上面的项目类似，不过是给 version 2 使用的！</span><br><span class="line">IgnoreUserKnownHosts no　　# 是否忽略家目录内的 ~/.ssh/known_hosts 这个档案所记录</span><br><span class="line">　　　　　　　　　　　　　 # 的主机内容？当然不要忽略，所以这里就是 no 啦！</span><br><span class="line">PasswordAuthentication yes # 密码验证当然是需要的！所以这里写 yes 啰！</span><br><span class="line">PermitEmptyPasswords no　　# 若上面那一项如果设定为 yes 的话，这一项就最好设定</span><br><span class="line">　　　　　　　　　　　　　 # 为 no ，这个项目在是否允许以空的密码登入！当然不许！</span><br><span class="line">ChallengeResponseAuthentication yes  # 挑战任何的密码认证！所以，任何 login.conf</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 规定的认证方式，均可适用！</span><br><span class="line">#PAMAuthenticationViaKbdInt yes      # 是否启用其它的 PAM 模块！启用这个模块将会</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 导致 PasswordAuthentication 设定失效！</span><br><span class="line"></span><br><span class="line">#  与 Kerberos 有关的参数设定！因为我们没有 Kerberos 主机，所以底下不用设定！</span><br><span class="line">#KerberosAuthentication no</span><br><span class="line">#KerberosOrLocalPasswd yes</span><br><span class="line">#KerberosTicketCleanup yes</span><br><span class="line">#KerberosTgtPassing no</span><br><span class="line"></span><br><span class="line">#  底下是有关在 X-Window 底下使用的相关设定！</span><br><span class="line">X11Forwarding yes</span><br><span class="line">#X11DisplayOffset 10</span><br><span class="line">#X11UseLocalhost yes</span><br><span class="line">#  登入后的项目：</span><br><span class="line">PrintMotd no              # 登入后是否显示出一些信息呢？例如上次登入的时间、地点等</span><br><span class="line">　　　　　　　　　　　　　# 等，预设是 yes ，但是，如果为了安全，可以考虑改为 no ！</span><br><span class="line">PrintLastLog yes　　　　　# 显示上次登入的信息！可以啊！预设也是 yes ！</span><br><span class="line">KeepAlive yes　　　　　　 # 一般而言，如果设定这项目的话，那么 SSH Server 会传送</span><br><span class="line">　　　　　　　　　　　　　# KeepAlive 的讯息给 Client 端，以确保两者的联机正常！</span><br><span class="line">　　　　　　　　　　　　　# 在这个情况下，任何一端死掉后， SSH 可以立刻知道！而不会</span><br><span class="line">　　　　　　　　　　　　　# 有僵尸程序的发生！</span><br><span class="line">UsePrivilegeSeparation yes # 使用者的权限设定项目！就设定为 yes 吧！</span><br><span class="line">MaxStartups 10　　　　　　# 同时允许几个尚未登入的联机画面？当我们连上 SSH ，</span><br><span class="line">　　　　　　　　　　　　　# 但是尚未输入密码时，这个时候就是我们所谓的联机画面啦！</span><br><span class="line">　　　　　　　　　　　　　# 在这个联机画面中，为了保护主机，所以需要设定最大值，</span><br><span class="line">　　　　　　　　　　　　　# 预设最多十个联机画面，而已经建立联机的不计算在这十个当中</span><br><span class="line">#  关于使用者抵挡的设定项目：</span><br><span class="line">DenyUsers *　　　　　　　 # 设定受抵挡的使用者名称，如果是全部的使用者，那就是全部</span><br><span class="line"> 　　　　　　　　　　　　　# 挡吧！若是部分使用者，可以将该账号填入！例如下列！</span><br><span class="line">DenyUsers test</span><br><span class="line">DenyGroups test　　　　　 # 与 DenyUsers 相同！仅抵挡几个群组而已！</span><br><span class="line"># 5. 关于 SFTP 服务的设定项目！</span><br><span class="line">Subsystem       sftp    /usr/lib/ssh/sftp-server</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>conf</tag>
        <tag>openssh</tag>
      </tags>
  </entry>
  <entry>
    <title>OpenSSH拒绝服务漏洞_CVE-2016-8858</title>
    <url>/2016/11/02/openssl_CVE-2016-8858/</url>
    <content><![CDATA[<ol>
<li>相关依赖<br> You will need working installations of Zlib and libcrypto (LibreSSL &#x2F; OpenSSL)</li>
<li>下载相应源码<ol>
<li>Dropbear临时替代SSH<ul>
<li>Dropbear <a href="https://matt.ucc.asn.au/dropbear/releases/">https://matt.ucc.asn.au/dropbear/releases/</a></li>
</ul>
</li>
<li>Zlib 1.1.4 or 1.2.1.2 or greater (earlier 1.2.x versions have problems)<ul>
<li>Zlib <a href="http://www.zlib.net/">http://www.zlib.net/</a></li>
</ul>
</li>
<li>libcrypto (LibreSSL or OpenSSL &gt;&#x3D; 0.9.8f &lt; 1.1.0)<ul>
<li>OpenSSL <a href="https://www.openssl.org/source/">https://www.openssl.org/source/</a><blockquote>
<p>Note that because of API changes, OpenSSL 1.1.x is not currently supported.(2017&#x2F;03&#x2F;16更新)</p>
</blockquote>
</li>
<li>LibreSSL <a href="https://ftp.openbsd.org/pub/OpenBSD/LibreSSL/">https://ftp.openbsd.org/pub/OpenBSD/LibreSSL/</a></li>
</ul>
</li>
<li>OpenSSH<ul>
<li><a href="https://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/">https://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/</a></li>
</ul>
</li>
</ol>
</li>
</ol>
<span id="more"></span>
<ol start="3">
<li>编译安装<ol>
<li>Dropbear<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar xvf dropbear-2016.74.tar.bz2</span><br><span class="line">cd dropbear-2016.74/</span><br><span class="line">./configure --prefix=/opt/dropbear --enable-pam</span><br><span class="line">make &amp;&amp; make scp &amp;&amp; sudo make install</span><br><span class="line">sudo /opt/dropbear/bin/dropbearkey -t rsa -f /opt/dropbear/dropbear_rsa_host_key -s 4096</span><br><span class="line">sudo /opt/dropbear/sbin/dropbear -p 12598 -r /opt/dropbear/dropbear_rsa_host_key</span><br></pre></td></tr></table></figure></li>
<li>Zlib<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar -zxvf zlib-1.2.11.tar.gz</span><br><span class="line">cd zlib-1.2.11</span><br><span class="line">./configure --shared</span><br><span class="line">make &amp;&amp; make test &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure></li>
<li>OpenSSl<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar xvf openssl-1.0.2k.tar.gz</span><br><span class="line">cd openssl-1.0.2k</span><br><span class="line">#./Configure --prefix=/usr shared</span><br><span class="line">./config --prefix=/usr shared</span><br><span class="line">make &amp;&amp; make test &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure></li>
<li>OpenSSH<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar xvf openssh-7.4p1.tar.gz</span><br><span class="line">cd openssh-7.4p1</span><br><span class="line">./configure --prefix=/usr --sysconfdir=/etc/ssh --with-openssl-includes=/usr -with-ssl-dir=/usr/ssl --with-privsep-path=/var/myempty --with-privsep-user=sshd --with-zlib --with-ssl-engine --with-md5-passwords --with-pam --disable-etc-default-login &amp;&amp; \</span><br><span class="line">make &amp;&amp; \</span><br><span class="line">sudo mv /etc/ssh* /tmp/ &amp;&amp; \</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
]]></content>
      <tags>
        <tag>CVE</tag>
        <tag>openssh</tag>
        <tag>openssl</tag>
        <tag>zlib</tag>
        <tag>dropbear</tag>
      </tags>
  </entry>
  <entry>
    <title>openssl生成cert</title>
    <url>/2017/07/13/openssl_generate_certificate/</url>
    <content><![CDATA[<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">openssl genrsa -des3 -out server.key 2048</span><br><span class="line">openssl rsa -in server.key -out server.key</span><br><span class="line">openssl req -sha256 -new -key server.key -out server.csr -subj &#x27;/CN=localhost&#x27;</span><br><span class="line">openssl x509 -req -sha256 -days 36500 -in server.csr -signkey server.key -out server.crt</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://stackoverflow.com/questions/10175812/how-to-create-a-self-signed-certificate-with-openssl">https://stackoverflow.com/questions/10175812/how-to-create-a-self-signed-certificate-with-openssl</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cat cert.pem</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIIDJDCCAgwCCQDIHbBXyn2dyDANBgkqhkiG9w0BAQsFADBTMQswCQYDVQQGEwJD</span><br><span class="line">TjERMA8GA1UEBwwIc2hhbmdoYWkxEDAOBgNVBAoMB3F6c3RlY2gxHzAdBgNVBAMM</span><br><span class="line">FmdpdGxhYi5pbmMucXpzdGVjaC5uZXQwIBcNMTcwODAxMDk1OTA0WhgPMjExNzA3</span><br><span class="line">MDgwOTU5MDRaMFMxCzAJBgNVBAYTAkNOMREwDwYDVQQHDAhzaGFuZ2hhaTEQMA4G</span><br><span class="line">A1UECgwHcXpzdGVjaDEfMB0GA1UEAwwWZ2l0bGFiLmluYy5xenN0ZWNoLm5ldDCC</span><br><span class="line">ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKaAZnlgevlhWR3djmFxZgcX</span><br><span class="line">Pwy2PiWpgr4kXQGAbCMTS2ouiTYvSW6rr9ofRv39G7yxSc7Rah6N1f9y6y9/itR7</span><br><span class="line">C2vMSM/GHMX8zvLt49PFNjhIYv1Nd38VBoXSxz72yp+iagCKooYC9Zn+mEQlmAbJ</span><br><span class="line">/zv9T8UiYTeV9FMHYO3HoTlet/tYeBmWr5ukEncBt5fxfM3yGuipR721qUCD0Hub</span><br><span class="line">mXx3r/YJ5LerSjS6SBug2i8lusSkF6mRJUNyF58ouNAqnj4RFGgmwdwuRZn0TVF7</span><br><span class="line">SWL9kDIB9dxi/pu1AFPBpxq/T7fgxuR6EdCO5Gu/QTZdGDpWoKqN5UgfWQwvzcEC</span><br><span class="line">AwEAATANBgkqhkiG9w0BAQsFAAOCAQEAKivEQXuW3KfxeucuCE2ovCuHgzd5RP6k</span><br><span class="line">RRUTDpufPmD8JH3b1vn0r4lq+u2WppwkFhlx99O89zygzuT19UtefUQ5Fgll0dbQ</span><br><span class="line">vfgICiRvQFoYw427QWUS29Z4wNZM384TkCkWPoh7zzsIz8EBzAbv8a/OcTIcsYYu</span><br><span class="line">QCrozqhqMnetHqhz7D9ShWAxP7rKGgf3lTC0ehpax8b6P24Q1Yuk3BsB6ErrAMCD</span><br><span class="line">FXoIW/a9jy9lgm1oIeBvGSWZCaoVE+4x3JYhtozpx1WlapdRxEYvNxzpcF7o35MS</span><br><span class="line">Ff9AHyLdYUqN4Q4IdwYOmpQnfN/dZhx5aAGjvcs/iQms/Ed92CKs4g==</span><br><span class="line">-----END CERTIFICATE-----</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git config --local http.sslCAInfo /path/cert.pem</span><br><span class="line">$ git config --local --unset http.sslCAInfo</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git config --local http.sslVerify false #NO NEED TO USE THIS</span><br><span class="line">$ git config --local --unset http.sslverify</span><br></pre></td></tr></table></figure>
<ul>
<li>Copy CA cert to &#x2F;usr&#x2F;local&#x2F;share&#x2F;ca-certificates.<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo update-ca-certificates</span><br><span class="line">sudo service docker restart</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>openssl</tag>
        <tag>cert</tag>
      </tags>
  </entry>
  <entry>
    <title>openvpn  设置备忘</title>
    <url>/2017/07/09/openvpn/</url>
    <content><![CDATA[<ol>
<li>opevpn 服务器开启<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">port 1194</span><br><span class="line">proto udp</span><br><span class="line">dev tun</span><br><span class="line">ca ca.crt</span><br><span class="line">cert xxx.crt</span><br><span class="line">dh dh2048.pem</span><br><span class="line">server 10.8.0.0 255.255.255.0  //openvpnIP段</span><br><span class="line">ifconfig-pool-persist ipp.txt  //分配的地址记录在ipp.txt</span><br><span class="line">client-config-dir ccd  //个人单独配置文件</span><br><span class="line"></span><br><span class="line">client-to-client  //客户端可以互相连接</span><br><span class="line">keepalive 10 120</span><br><span class="line">comp-lzo</span><br><span class="line"></span><br><span class="line">user nobody</span><br><span class="line">group nogroup</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">status /tmp/openvpn-status.log</span><br><span class="line">log         /tmp/openvpn.log</span><br><span class="line">verb 4</span><br><span class="line"></span><br><span class="line">mode server  //运行模式</span><br><span class="line">tls-server  //tls加密</span><br><span class="line">topology subnet  //使用服务端子网</span><br><span class="line">push &quot;topology subnet&quot;  //通知客户端使用子网</span><br><span class="line"></span><br><span class="line">auth-user-pass-verify /etc/openvpn/checkpsw.js via-env  //密码认证</span><br><span class="line">client-cert-not-required  //不认证证书</span><br><span class="line">username-as-common-name  //使用用户名区别不同用户</span><br><span class="line">script-security 3</span><br><span class="line"></span><br><span class="line">route 192.168.2.0 255.255.255.0 10.8.0.2  //使用这个子网</span><br><span class="line">push &quot;route 192.168.2.0 255.255.255.0 10.8.0.2&quot;  //通知客户端使用子网</span><br><span class="line">route 10.8.0.0 255.255.255.0 10.8.0.1  //使用这个子网</span><br><span class="line">push &quot;route 10.8.0.0 255.255.255.0&quot;  //通知客户端使用子网</span><br><span class="line">route 192.168.3.0 255.255.255.0 10.8.0.2  //使用这个子网</span><br><span class="line">push &quot;route 192.168.3.0 255.255.255.0 10.8.0.2&quot;  //通知客户端使用子网</span><br></pre></td></tr></table></figure></li>
<li>连接到openvpn服务器</li>
</ol>
<ul>
<li>开启路由转发<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class="line">sudo iptables -A FORWARD -i eth0 -j ACCEPT</span><br><span class="line">sudo iptables -A FORWARD -i eth1 -j ACCEPT</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li>配置路由<ul>
<li>可以在路由器上配置全局路由</li>
<li>下面是需要连接 openvpn 的单独配置<ul>
<li>Windows 需要cmd 管理员窗口执行:<br>  <code>route add  10.8.0.0 mask 255.255.255.0 10.0.0.1</code></li>
<li>Linux 需要sudo 权限执行:<br>  <code>ip route add 10.8.0.0/24 via 10.0.0.1</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>可以在各个网络出入口使用 tcpdump 抓包判断网络情况</p>
</blockquote>
]]></content>
      <tags>
        <tag>openvpn</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle</title>
    <url>/2016/07/20/oracle/</url>
    <content><![CDATA[<ol>
<li>环境设置<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export ORACLE_SID=orcl</span><br><span class="line">export ORACLE_BASE=oracle_install_dir</span><br><span class="line">export ORACLE_HOME=oracle_install_dir/oracle12c</span><br></pre></td></tr></table></figure></li>
<li>启动<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">oracle&gt; startup open</span><br><span class="line">bash# lsnrctl start</span><br></pre></td></tr></table></figure>
<ol>
<li>startup nomount<br> 非安装启动，这种方式启动下可执行：重建控制文件、重建数据库,启动instance，即启动SGA和后台进程，这种启动只需要init.ora文件。</li>
<li>startup mount dbname<br> 安装启动，这种方式启动下可执行：数据库日志归档、数据库恢复、重新命名一些数据库文件<br> 如：系统表空间或日志文件。<br> 执行“nomount”，然后打开控制文件</li>
<li>startup open dbname<br> 先执行“nomount”，然后执行“mount”，再打开包括Redo log文件在内的所有数据库文件， 这种方式下可访问数据库中的数据。</li>
<li>startup，等于以下三个命令<br> startup nomount<br> alter database mount<br> alter database open</li>
<li>startup restrict<br> 约束方式启动<br> 这种方式能够启动数据库，但只允许具有一定特权的用户访问<br> 非特权用户访问时，会出现以下提示：<br> ERROR：<br> ORA-01035: ORACLE 只允许具有 RESTRICTED SESSION 权限的用户使用</li>
<li>startup force<br> 强制启动方式<br> 当不能关闭数据库时，可以用startup force来完成数据库的关闭<br> 先关闭数据库，再执行正常启动数据库命令</li>
<li>startup pfile&#x3D;参数文件名<br> 带初始化参数文件的启动方式<br> 先读取参数文件，再按参数文件中的设置启动数据库<br> 例：startup pfile&#x3D;E:\Oracle\admin\oradb\pfile\init.ora</li>
<li>startup EXCLUSIVE</li>
</ol>
</li>
<li>关闭<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bash# lsnrctl stop</span><br><span class="line">oracle&gt; shutdown immediate</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<ol>
<li>Normal 需要等待所有的用户断开连接<br> normal需要在所有连接用户断开后才执行关闭数据库任务，所以有的时候看起来好象命令没有运行一样！在执行这个命令后不允许新的连接</li>
<li>Immediate 等待用户完成当前的语句<br> immediate在用户执行完正在执行的语句后就断开用户连接，并不允许新用户连接。数据库并不立即关闭，而是在Oracle执行某些清除工作后才关闭（终止会话、释放会话资源)。</li>
<li>Transactional 等待用户完成当前的事务<br> transactional 在用户执行完当前事物后断开连接，并不允许新的用户连接数据库。</li>
<li>Abort 不做任何等待，直接关闭数据库<br> abort 执行强行断开连接并直接关闭数据库。直接关闭数据库，正在访问数据库的会话会被突然终止，如果数据库中有大量操作正在执行，这时执行shutdown abort后，重新启动数据库需要很长时间。</li>
</ol>
</li>
</ol>
<h4 id="sqlplus中使用其他帐户连接"><a href="#sqlplus中使用其他帐户连接" class="headerlink" title="sqlplus中使用其他帐户连接"></a>sqlplus中使用其他帐户连接</h4><ol>
<li>conn system&#x2F;manager;</li>
<li>conn sys&#x2F;change_on_install as sysdba;</li>
<li>show user 显示此时连接的是哪个帐户</li>
</ol>
<h4 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h4><ul>
<li><p>grant dba to USER;</p>
</li>
<li><p>grant connect,resource to USER;</p>
<blockquote>
<p>用户成功创建，但是还不能正常的登录Oracle数据库系统，因为该用户还没有任何权限。如果用户能够正常登录，至少需要CREATE SESSION系统权限。<br>介绍几个常用角色：<br>  CONNECT角色，主要应用在临时用户，特别是那些不需要建表的用户，通常只赋予他们CONNECT role。CONNECT是使用Oracle的简单权限，拥有CONNECT角色的用户，可以与服务器建立连接会话（session，客户端对服务器连接，称为会话）。<br>  RESOURCE角色，更可靠和正式的数据库用户可以授予RESOURCE role。RESOURCE提供给用户另外的权限以创建他们自己的表、序列、过程（procedure）、触发器（trigger）、索引（index）等。<br>  DBA角色，DBA role拥有所有的系统权限—-包括无限制的空间限额和给其他用户授予各种权限的能力。用户SYSTEM拥有DBA角色。<br>一般情况下，一个普通的用户（如SCOTT），拥有CONNECT和RESOURCE两个角色即可进行常规的数据库开发工作。</p>
</blockquote>
</li>
<li><p>drop user user_name USER;</p>
</li>
<li><blockquote>
<p>在以超级管理员sys登陆时必须加 as sysdba 否则连接不上<br>如果以system 或 sys登陆时 输入 select * from emp;会出错 因为system和 sys没有emp这张表<br>如果此时想在不同用户下访问emp表 则需加上该表所在的用户名 例如 select * from scott.emp;</p>
</blockquote>
</li>
</ul>
<h4 id="sqlplus中对于表的信息的查看"><a href="#sqlplus中对于表的信息的查看" class="headerlink" title="sqlplus中对于表的信息的查看"></a>sqlplus中对于表的信息的查看</h4><ol>
<li>查看所有表名,会列出该帐户权限下的所有的表名<br><code> select   table_name    from   cat;  select  table_name   from  tab;  select  table_name   from  user_tables;  select owner,table_name from dba_tables;</code></li>
<li>查看表的结构<br><code> describe 表名;</code><br>3．&#x2F; 要想继续使用上一次的正确的指令 可以直接 &#x2F; 即可重复执行上一条指令</li>
<li>查看当前用户的缺省表空间<br> <code>select username,default_tablespace from user_users;</code></li>
<li>查看当前用户的角色<br><code>select * from user_role_privs;</code></li>
<li>查看当前用户的系统权限和表级权限<br><code> select * from user_sys_privs;  select * from user_tab_privs;</code></li>
<li>查看用户下所有的表的列属性<br><code>select * from USER_TAB_COLUMNS where table_name=:table_Name;</code></li>
<li>显示用户信息(所属表空间)<br><code> select default_tablespace,temporary_tablespace  from dba_users where username=&#39;GAME&#39;;</code></li>
<li>查看当前用户的系统权限和表级权限<br><code> select * from user_sys_privs;  select * from user_tab_privs;</code></li>
<li>显示当前会话所具有的权限<br><code>select * from session_privs;</code></li>
<li>显示指定用户所具有的系统权限<br><code>select * from dba_sys_privs where grantee=&#39;GAME&#39;;</code></li>
<li>显示特权用户<br><code>select * from v$pwfile_users;</code></li>
<li>显示用户信息(所属表空间)<br><code>select default_tablespace,temporary_tablespace  from dba_users where username=&#39;GAME&#39;;</code></li>
<li>显示用户的PROFILE<br>select profile from dba_users where username&#x3D;’GAME’;</li>
</ol>
<h4 id="表"><a href="#表" class="headerlink" title="表"></a>表</h4><ol>
<li>查看用户下所有的表<br><code> select   *   from   cat;  select   *   from   tab;  select   table_name   from   user_tables;</code></li>
<li>查看名称包含log字符的表<br><code> select object_name,object_id from user_objects  where instr(object_name,&#39;LOG&#39;)&gt;0;</code></li>
<li>查看某表的创建时间<br><code> select object_name,created from user_objects where   object_name=upper(&#39;&amp;table_name&#39;);</code></li>
<li>查看某表的大小<br><code> select sum(bytes)/(1024*1024) as &quot;size(M)&quot; from user_segments   where segment_name=upper(&#39;&amp;table_name&#39;);</code></li>
<li>查看放在Oracle的内存区里的表<br><code> select table_name,cache from user_tables where instr(cache,&#39;Y&#39;)&gt;0;</code></li>
</ol>
<h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><ol>
<li>查看索引<br><code> select   index_name,table_owner,table_name,tablespace_name,status   from   user_indexes   order   by   table_name;</code></li>
<li>查看索引个数和类别<br><code> select index_name,index_type,table_name from user_indexes order by table_name;</code></li>
<li>查看索引被索引的字段<br><code> select * from user_ind_columns where index_name=upper(&#39;&amp;index_name&#39;);</code></li>
<li>查看索引的大小<br><code> select sum(bytes)/(1024*1024) as &quot;size(M)&quot; from user_segmentswhere segment_name=upper(&#39;&amp;index_name&#39;);</code></li>
</ol>
<h4 id="序列号"><a href="#序列号" class="headerlink" title="序列号"></a>序列号</h4><ol>
<li>查看序列号，last_number是当前值<br><code> select * from user_sequences;</code></li>
</ol>
<h4 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h4><ol>
<li>查看视图的名称<br><code> select   text   from   user_views   where   view_name=upper(&#39;&amp;view_name&#39;);  select view_name from user_views;</code></li>
<li>查看创建视图的select语句<br><code> set view_name,text_length from user_views;  set long 2000; 说明：可以根据视图的text_length值设定set long 的大小  select text from user_views where view_name=upper(&#39;&amp;view_name&#39;);</code></li>
</ol>
<h4 id="同义词"><a href="#同义词" class="headerlink" title="同义词"></a>同义词</h4><ol>
<li>查看同义词的名称<br><code> select * from user_synonyms;</code></li>
</ol>
<h4 id="约束条件"><a href="#约束条件" class="headerlink" title="约束条件"></a>约束条件</h4><ol>
<li><p>查看某表的约束条件<br>&#96;<br> select constraint_name, constraint_type,search_condition, r_constraint_name<br> from user_constraints where table_name &#x3D; upper(‘&amp;table_name’);</p>
<p> select c.constraint_name,c.constraint_type,cc.column_name<br> from user_constraints c,user_cons_columns cc<br> where c.owner &#x3D; upper(‘&amp;table_owner’) and c.table_name &#x3D; upper(‘&amp;table_name’)<br> and c.owner &#x3D; cc.owner and c.constraint_name &#x3D; cc.constraint_name<br> order by cc.position;</p>
</li>
</ol>
<p>&#96;</p>
<h4 id="存储函数和过程"><a href="#存储函数和过程" class="headerlink" title="存储函数和过程"></a>存储函数和过程</h4><ol>
<li>查看函数和过程的状态<br><code> select object_name,status from user_objects where object_type=&#39;FUNCTION&#39;;  select object_name,status from user_objects where object_type=&#39;PROCEDURE&#39;;</code></li>
<li>查看函数和过程的源代码<br><code> select text from all_source where owner=user and name=upper(&#39;&amp;plsql_name&#39;);</code></li>
</ol>
<h3 id="系统表"><a href="#系统表" class="headerlink" title="系统表"></a>系统表</h3><p>ORACLE数据库的系统参数都存储在数据库中，可以通过SQLPLUS，以用户SYSYTEM进行查询。几个重要的表或者视图如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">v$controlfile：控制文件的信息；</span><br><span class="line">v$datafile：数据文件的信息；</span><br><span class="line">v$log：日志文件的信息；</span><br><span class="line">v$process：处理器的信息；</span><br><span class="line">v$session：会话信息；</span><br><span class="line">v$transaction：事务信息；</span><br><span class="line">v$resource：资源信息；</span><br><span class="line">v$sga：系统全局区的信息。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面的视图名中的‘v$’,只是视图名字中的字符。类似于上面的视图或表还有很多，位于： $ORACLE_HOME&#x2F;RDBMS&#x2F;ADMIN&#x2F;CATALOG.SQL文件中。<br>这些视图或表可以在SQLPLUS中用SELECT语句进行查询。</p>
</blockquote>
<h3 id="数据字典视图"><a href="#数据字典视图" class="headerlink" title="数据字典视图"></a>数据字典视图</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">动态字典</span><br><span class="line">select  distinct    object_name from    dba_objects where   object_name like    &#x27;V$_%&#x27;  ;</span><br><span class="line">系统用户字典:</span><br><span class="line">select  distinct    object_name from    dba_objects where   object_name like    &#x27;DBA_%&#x27; ;</span><br><span class="line">本用户的字典:</span><br><span class="line">select  distinct    object_name from    dba_objects where   object_name like    &#x27;USER_%&#x27;    ;</span><br><span class="line">表和列</span><br><span class="line">DBA_TABLES、ALL_TABLES和USER_TABLES显示了有关数据库表的一般信息。</span><br><span class="line"></span><br><span class="line">DBA_TAB_COLUMNS、ALL_TAB_COLUMNS和USER_TAB_COLUMNS显示了每个数据库表的列的信息。</span><br><span class="line"></span><br><span class="line">注意：DBA_OBJECTS、ALL_OBJECTS和USER_OBJECTS显示了模式对象的信息，包括表。</span><br><span class="line"></span><br><span class="line">完整性约束</span><br><span class="line">DBA_CONSTRAINTS、ALL_CONSTRAINTS和USER_CONSTRAINST显示有关约束的一般信息。</span><br><span class="line"></span><br><span class="line">DBA_CONS_COLUMNS、ALL_CONS_COLUMNS和USER_CONS_COLUMNS显示有关列的相关约束的一般信息。</span><br><span class="line"></span><br><span class="line">视图</span><br><span class="line">DBA_VIEWS、ALL_VIEWS和USER_VIEWS。</span><br><span class="line"></span><br><span class="line">注意：DBA_OBJECTS、ALL_OBJECTS和USER_OBJECTS显示了模式对象的信息，包括视图。</span><br><span class="line"></span><br><span class="line">序列</span><br><span class="line">DBA_SEQUENCES、ALL_SEQUENCES和USER_SEQUENCES。</span><br><span class="line"></span><br><span class="line">注意：DBA_OBJECTS、ALL_OBJECTS和USER_OBJECTS显示了模式对象的信息，包括序列。</span><br><span class="line"></span><br><span class="line">同义词</span><br><span class="line">DBA_SYNONYMS、ALL_SYNONYMS和USER_SYNONYMS。</span><br><span class="line"></span><br><span class="line">注意：DBA_OBJECTS、ALL_OBJECTS和USER_OBJECTS显示了模式对象的信息，包括同义词。</span><br><span class="line"></span><br><span class="line">索引</span><br><span class="line">DBA_INDEXS、ALL_INDEXS、USER_INDEXS、DBA_IND_COLUMNS、ALL_IND_COLUMNS和USER_IND_COLUMNS。</span><br><span class="line"></span><br><span class="line">用户</span><br><span class="line">DBA_USERS。</span><br><span class="line"></span><br><span class="line">角色</span><br><span class="line">DBA_ROLES。</span><br><span class="line"></span><br><span class="line">表空间定额</span><br><span class="line">DBA_TS_QUOTAS。</span><br><span class="line"></span><br><span class="line">配置表</span><br><span class="line">DBA_PROFILES。</span><br><span class="line"></span><br><span class="line">表空间</span><br><span class="line">DBA_TABLESPACES。</span><br><span class="line"></span><br><span class="line">数据文件</span><br><span class="line">DBA_DATA_FILES。</span><br><span class="line"></span><br><span class="line">段</span><br><span class="line">DBA_SEGMENTS、USER_SEGMENT。</span><br><span class="line"></span><br><span class="line">回滚段</span><br><span class="line">DBA_ROLLBACK_SEGS、V$ROLLNAME、V$ROLLSTAT。</span><br><span class="line"></span><br><span class="line">触发器：　　select   trigger_name,trigger_type,table_owner,table_name,status   from   user_triggers;</span><br><span class="line">快照：　　select   owner,name,master,table_name,last_refresh,next   from   user_snapshots   order   by   owner,next;</span><br><span class="line">同义词：　　select   *   from   syn;序列：　　select   *   from   seq;</span><br><span class="line">数据库链路：　　select   *   from   user_db_links;</span><br><span class="line">约束限制：　　select   TABLE_NAME,CONSTRAINT_NAME,SEARCH_CONDITION,STATUS   from   user_constraints;</span><br><span class="line">本用户读取其它用户对象的权限：　　select   *   from   user_tab_privs;</span><br><span class="line">本用户所拥有的系统权限：　　select   *   from   user_sys_privs;</span><br><span class="line">用户：　　select   *   from   all_users   order   by   user_id;</span><br><span class="line">表空间剩余自由空间情况：　　select   tablespace_name,sum(bytes),max(bytes),count(*)   from   dba_free_space   group   by   tablespace_name;</span><br><span class="line">数据字典：　　select   table_name   from   dict   order   by   table_name;</span><br><span class="line">锁及资源信息：　　select   *   from   v$lock;</span><br><span class="line">不包括DDL锁数据库字符集：　　select   name,value$   from   props$   where   name=&#x27;NLS_CHARACTERSET&#x27;;</span><br><span class="line">inin.ora参数：　　select   name,value   from   v$parameter   order   by   name;</span><br><span class="line">SQL共享池：　　select   sql_text   from   v$sqlarea;</span><br><span class="line">数据库：　　select   *   from   v$database</span><br><span class="line">控制文件：　　select   *   from   V$controlfile;</span><br><span class="line">重做日志文件信息：　　select   *   from   V$logfile;</span><br><span class="line">来自控制文件中的日志文件信息：　　select   *   from   V$log;</span><br><span class="line">来自控制文件中的数据文件信息：　　select   *   from   V$datafile;</span><br><span class="line">NLS参数当前值：　　select   *   from   V$nls_parameters;</span><br><span class="line">ORACLE版本信息：　　select   *   from   v$version;</span><br><span class="line">描述后台进程：　　select   *   from   v$bgprocess;</span><br><span class="line">查看版本信息：　　select   *   from   product_component_version;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SET AUTOTRACE OFF 此为默认值，即关闭Autotrace</span><br><span class="line">SET AUTOTRACE ON EXPLAIN 只显示执行计划</span><br><span class="line">SET AUTOTRACE ON STATISTICS 只显示执行的统计信息</span><br><span class="line">SET AUTOTRACE ON 包含2,3两项内容</span><br><span class="line">SET AUTOTRACE TRACEONLY STAT</span><br><span class="line">SET AUTOTRACE TRACEONLY 与ON相似，但不显示语句的执行结果</span><br><span class="line"></span><br><span class="line">1. set linesize 设置每行显示的长度</span><br><span class="line"></span><br><span class="line">2. set pagesize 设置每页显示的长度 oracle中的数据是采用一页页显示的方式输出的</span><br><span class="line"></span><br><span class="line">--定义缓冲编辑器为vi</span><br><span class="line">define_editor=vi</span><br><span class="line">--使DBMS_OUTPUT有效,并设置成最大buffer,并防止&quot;吃掉&quot;最前面的空格</span><br><span class="line">set serveroutput on size 1000000 format wrapped</span><br><span class="line">--设置一行可以容纳的字符数</span><br><span class="line">set linesize 256</span><br><span class="line">--设置一页有多少行数</span><br><span class="line">set pagesize 50</span><br><span class="line">--设置来回数据显示量,这个值会影响autotrace时一致性读等数据</span><br><span class="line">set arraysize 5000</span><br><span class="line">--页和页之间不设任何间隔</span><br><span class="line">set newpage none</span><br><span class="line">--LONG或CLOB显示的长度</span><br><span class="line">set long 5000</span><br><span class="line">--将SPOOL输出中每行后面多余的空格去掉</span><br><span class="line">set trimspool on</span><br><span class="line">--设置查询耗时</span><br><span class="line">set timing on</span><br><span class="line">--autotrace后explain plan output的格式</span><br><span class="line">col plan_plus_exp format a120</span><br><span class="line">--在屏幕上暂不显示输出的内容,为下面的设置sql做准备</span><br><span class="line">set termout off</span><br><span class="line">--设置时间格式</span><br><span class="line">alter session set nls_date_format=&#x27;yyyy-mm-dd hh24:mi:ss&#x27;;</span><br><span class="line">--获得用户名和global_name</span><br><span class="line">col login_info_temp new_value login_info</span><br><span class="line">select user||&#x27;@&#x27;||global_name login_info_temp from global_name;</span><br><span class="line">--设置sql提示为&quot;user@global_name&quot;</span><br><span class="line">set sqlprompt &#x27;&amp;login_info SQL&gt; &#x27;</span><br><span class="line">--在屏幕上显示输出的内容</span><br><span class="line">set termout on</span><br><span class="line">--列格式控制</span><br><span class="line">主要格式化列的显示形式。</span><br><span class="line">col c1 format a1</span><br><span class="line">col cc1 format a1</span><br><span class="line">col c2 format a2</span><br><span class="line">col cc2 format a2</span><br><span class="line">col c3 format a3</span><br><span class="line">col cc3 format a3</span><br><span class="line">col c4 format a4</span><br><span class="line">col cc4 format a4</span><br><span class="line">col c5 format a5</span><br><span class="line">col cc5 format a5</span><br><span class="line">col c6 format a6</span><br><span class="line">col cc6 format a6</span><br><span class="line">col c7 format a7</span><br><span class="line">col cc7 format a7</span><br><span class="line">col c8 format a8</span><br><span class="line">col cc8 format a8</span><br><span class="line">col c9 format a9</span><br><span class="line">col cc9 format a9</span><br><span class="line">col c10 format a10</span><br><span class="line">col cc10 format a10</span><br><span class="line">col c15 format a15</span><br><span class="line">col cc15 format a15</span><br><span class="line">col c20 format a20</span><br><span class="line">col cc20 format a20</span><br><span class="line">col c30 format a30</span><br><span class="line">col cc30 format a30</span><br><span class="line">col c40 format a40</span><br><span class="line">col cc40 format a40</span><br><span class="line">col c50 format a50</span><br><span class="line">col cc50 format a50</span><br><span class="line">col c60 format a60</span><br><span class="line">col cc60 format a60</span><br><span class="line">col c70 format a70</span><br><span class="line">col cc70 format a70</span><br><span class="line">col c80 format a80</span><br><span class="line">col cc80 format a80</span><br><span class="line">col c90 format a90</span><br><span class="line">col cc90 format a90</span><br><span class="line">col c100 format a100</span><br><span class="line">col cc100 format a100</span><br><span class="line">col c150 format a150</span><br><span class="line">col cc150 format a150</span><br><span class="line">col c200 format a200</span><br><span class="line">col cc200 format a200</span><br><span class="line">col c255 format a255</span><br><span class="line">col cc255 format a255</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>command</tag>
        <tag>database</tag>
        <tag>oracle</tag>
        <tag>sqlplus</tag>
      </tags>
  </entry>
  <entry>
    <title>ORACLE 11G R2静默安装，配置</title>
    <url>/2016/10/06/oracle_11gr2_silent_install/</url>
    <content><![CDATA[<h1 id="ORACLE-11G-R2静默安装，配置"><a href="#ORACLE-11G-R2静默安装，配置" class="headerlink" title="ORACLE 11G R2静默安装，配置"></a>ORACLE 11G R2静默安装，配置</h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>1.依赖性准备</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># yum install make gcc binutils gcc-c++ compat-libstdc++ elfutils-libelf-devel elfutils-libelf-devel-static ksh libaio libaio-devel numactl-devel sysstat unixODBC unixODBC-devel pcre-devel glibc.i686</span><br></pre></td></tr></table></figure>

<p>2.用户和组准备</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"># groupadd oinstall</span><br><span class="line"># groupadd dba</span><br><span class="line"># useradd -g oinstall -G dba -d /home/oracle oracle</span><br><span class="line"># passwd oracle          //设置oracle密码</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>3.目录准备及权限调整</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># mkdir -p /export/servers/oracle/11.2.0  //数据库系统安装目录</span><br><span class="line"># mkdir /export/data/oradata    //数据库数据安装目录</span><br><span class="line"># mkdir /export/data/oradata_back  //数据备份目录</span><br><span class="line"># mkdir /home/oracle/inventory //清单目录</span><br><span class="line"># chown -R oracle:oinstall /export/servers/oracle</span><br><span class="line"># chown -R oracle:oinstall /home/oracle/inventory</span><br><span class="line"># chown -R oracle:oinstall /export/data</span><br><span class="line"># chomod -R 775 /export/servers/oracle</span><br><span class="line"># chomod -R 775 /export/data</span><br></pre></td></tr></table></figure>

<p>  以上工作可通过招待 <code>pre-install.sh</code> 脚本完成.</p>
<p>4.内核参数调整</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># cat /etc/sysctl.conf</span><br><span class="line">fs.aio-max-nr = 1048576</span><br><span class="line">fs.file-max = 6553600</span><br><span class="line">kernel.shmall = 2097152</span><br><span class="line">kernel.shmmax = 2147483648</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">kernel.sem = 250 32000 100 128</span><br><span class="line">net.ipv4.ip_local_port_range = 1024 65000</span><br><span class="line">net.core.rmem_default = 262144</span><br><span class="line">net.core.rmem_max = 4194304</span><br><span class="line">net.core.wmem_default = 262144</span><br><span class="line">net.core.wmem_max = 1048586</span><br><span class="line"></span><br><span class="line"># /sbin/sysctl -p          //让参数生效</span><br></pre></td></tr></table></figure>

<p>5.用户的限制文件修改</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># cat /etc/security/limits.conf`</span><br><span class="line">oracle           soft    nproc           2047</span><br><span class="line">oracle           hard    nproc           16384</span><br><span class="line">oracle           soft    nofile          1024</span><br><span class="line">oracle           hard    nofile          65536</span><br><span class="line">oracle           soft    stack           10240</span><br></pre></td></tr></table></figure>

<p>修改<code>/etc/pam.d/login</code>文件，增加如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">session  required   /lib64/security/pam_limits.so  //64为系统，千万别写成/lib/security/pam_limits.so，否则导致无法登录</span><br><span class="line">session     required      pam_limits.so</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># cat /etc/profile</span><br><span class="line">if [ $USER = &quot;oracle&quot; ]; then</span><br><span class="line">    if [ $SHELL = &quot;/bin/ksh&quot; ]; then</span><br><span class="line">    ulimit -p 16384</span><br><span class="line">    ulimit -n 65536</span><br><span class="line">    else</span><br><span class="line">    ulimit -u 16384 -n 65536</span><br><span class="line">    fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>6.oracle安装包准备</p>
<p>下载并解压安装包到 <code>/home/oracle/database</code></p>
<h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><p>1.打开另外一个终端，用<code>oracle</code>用户登录</p>
<p>2.复制并修改应答文件<br>复制一份应答文件模板，以便改错后回滚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cp -R /home/oracle/database/response/db_install.rsp  /home/oracle/database/response/my_db_install.rsp</span><br></pre></td></tr></table></figure>

<p>修改应答文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cat /home/oracle/database/response/my_db_install.rsp</span><br><span class="line">oracle.install.option=INSTALL_DB_SWONLY</span><br><span class="line">ORACLE_HOSTNAME=oracle11g.jd.com</span><br><span class="line">UNIX_GROUP_NAME=oinstall</span><br><span class="line">INVENTORY_LOCATION=/home/oracle/inventory/</span><br><span class="line">ORACLE_HOME=/export/servers/oracle/11.2.0</span><br><span class="line">ORACLE_BASE=/export/servers/oracle</span><br><span class="line">oracle.install.db.InstallEdition=EE</span><br><span class="line">oracle.install.db.isCustomInstall=false</span><br><span class="line">oracle.install.db.DBA_GROUP=dba</span><br><span class="line">oracle.install.db.OPER_GROUP=dba</span><br><span class="line">DECLINE_SECURITY_UPDATES=true</span><br></pre></td></tr></table></figure>

<p>3.根据应答文件，开始安装</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ sudo su - oracle</span><br><span class="line">$ cd /home/oracle/database/</span><br><span class="line">$ ./runInstaller -silent -responseFile /home/oracle/database/response/my_db_install.rsp</span><br></pre></td></tr></table></figure>

<p>4.按提示切换到root用户的终端，依次执行脚本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># /home/oracle/inventory/orainstRoot.sh</span><br><span class="line"># /opt/oracle/11.2.0/root.sh</span><br></pre></td></tr></table></figure>

<p>5.切换到oracle用户的终端</p>
<p>6.修改oracle用户环境变量</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cat  ~/.bash_profile</span><br><span class="line"></span><br><span class="line"># User specific environment and startup programs</span><br><span class="line">export ORACLE_SID=orcl</span><br><span class="line">export ORACLE_BASE=/app/server/oracle</span><br><span class="line">export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1</span><br><span class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</span><br><span class="line">PATH=$PATH:$ORACLE_HOME/bin</span><br><span class="line"></span><br><span class="line">$ source ~/.bash_profile</span><br></pre></td></tr></table></figure>

<h2 id="安装后工作"><a href="#安装后工作" class="headerlink" title="安装后工作"></a>安装后工作</h2><h4 id="建库"><a href="#建库" class="headerlink" title="建库"></a>建库</h4><p>1.复制并修改建库应答文件</p>
<p>复制应答文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cp -R /home/oracle/database/response/dbca.rsp  /home/oracle/database/response/my_dbca.rsp</span><br><span class="line">$ cat /home/oracle/database/response/my_dbca.rsp</span><br><span class="line"></span><br><span class="line">OPERATION_TYPE = &quot;createDatabase&quot;</span><br><span class="line">GDBNAME = &quot;orcl11g&quot;</span><br><span class="line">SID = &quot;orcl&quot;</span><br><span class="line">SYSPASSWORD = &quot;OraPwd11&quot;</span><br><span class="line">SYSTEMPASSWORD = &quot;OraPwd11&quot;</span><br><span class="line">DATAFILEDESTINATION = /app/data/oradata</span><br><span class="line">RECOVERYAREADESTINATION = /app/data/oradata_back</span><br><span class="line">SYSDBAUSERNAME = &quot;system&quot;</span><br><span class="line">SYSDBAPASSWORD = &quot;OraPwd11&quot;</span><br><span class="line">#以上2项可选</span><br><span class="line">INSTANCENAME = &quot;orcl11g&quot;</span><br><span class="line">CHARACTERSET = &quot;ZHS16GBK&quot; #按需求设置，建议使用UTF-8</span><br><span class="line">NATIONALCHARACTERSET= &quot;&quot; #可选 &quot;UTF8&quot; or &quot;AL16UTF16&quot; 建议UTF-8</span><br><span class="line">TOTALMEMORY = &quot;5120&quot; #Oracle使用的最大内存，单位M建库</span><br></pre></td></tr></table></figure>

<p>2.使用dbca静默建库</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ dbca -silent -responseFile /home/oracle/database/response/my_dbca.rsp</span><br></pre></td></tr></table></figure>

<h4 id="配置监听"><a href="#配置监听" class="headerlink" title="配置监听"></a>配置监听</h4><p>1.使用netca静默方式创建监听</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ netca /silent /responsefile /vagrant/zhs16gbk/netca.rsp</span><br></pre></td></tr></table></figure>
<p>执行完成会在 <code>$ORACLE_HOME/network/admin</code>目录下生成<code>sqlnet.ora</code>和<code>listener.ora</code>两个文件。</p>
<p>2.注册sid</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cat $ORACLE_HOME/network/admin/listener.ora</span><br><span class="line">LISTENER =</span><br><span class="line">(</span><br><span class="line">    DESCRIPTION_LIST =</span><br><span class="line">    (</span><br><span class="line">        DESCRIPTION =</span><br><span class="line">        (</span><br><span class="line">            ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521)</span><br><span class="line">            )</span><br><span class="line">        (</span><br><span class="line">            ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521)</span><br><span class="line">            )</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>之前添加以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SID_LIST_LISTENER =</span><br><span class="line">(</span><br><span class="line">    SID_LIST =</span><br><span class="line">    (</span><br><span class="line">        SID_DESC =</span><br><span class="line">        (SID_NAME = orcl)</span><br><span class="line">    (</span><br><span class="line">        ORACLE_HOME = /app/server/oracle/product/11.2.0/db_1)</span><br><span class="line">        (PROGRAM = extproc)</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>3.执行<code>$ lsnrctl reload</code>重启监听</p>
<p>4.编辑 <code>/etc/oratab</code> 把 <code>orcl11g:/export/servers/oracle/11.2.0:N</code>的<code>N</code>，改为<code>Y</code>，这样就可以通过<code>dbstart</code>启动此实例，也可以通过<code>dbshut</code>关闭此实例了。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>1.查看监听状态</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ lsnrctl status</span><br></pre></td></tr></table></figure>
<p>类似以下返回，说明监听状态正常</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Service &quot;ORCL&quot; has 1 instance(s).</span><br><span class="line">Instance &quot;orcl11g&quot;, status UNKNOWN, has 1 handler(s) for this service...</span><br><span class="line">Service &quot;db1&quot; has 1 instance(s).</span><br><span class="line">Instance &quot;orcl11g&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">Service &quot;orcl11gXDB&quot; has 1 instance(s).</span><br><span class="line">Instance &quot;orcl11g&quot;, status READY, has 1 handler(s) for this service...</span><br></pre></td></tr></table></figure>

<p>2.sqlplus连接测试</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ export $ORACLE_SID=orcl11g</span><br><span class="line">$ sqlplus /as sysdba</span><br></pre></td></tr></table></figure>
<p>正常登陆说明实例正常启动。</p>
<h2 id="自启动脚本"><a href="#自启动脚本" class="headerlink" title="自启动脚本"></a>自启动脚本</h2><p>加入 <code>/etc/init.d/oracledb</code> 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">#!/bin/sh -e</span><br><span class="line"></span><br><span class="line"># chkconfig: 3 56 10</span><br><span class="line"># description: Oracle 11g custom start/stop script</span><br><span class="line"></span><br><span class="line">DAEMON=oracle</span><br><span class="line">ORACLE_HOME=/app/server/oracle/product/11.2.0/db_1</span><br><span class="line">ORACLE_OWNER=oracle</span><br><span class="line"></span><br><span class="line">restart() &#123;</span><br><span class="line">    stop</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">    &#x27;start&#x27;)</span><br><span class="line">        su - $&#123;ORACLE_OWNER&#125; -c &quot;$&#123;ORACLE_HOME&#125;/bin/lsnrctl start&quot;</span><br><span class="line">        su - $&#123;ORACLE_OWNER&#125; -c &quot;$&#123;ORACLE_HOME&#125;/bin/dbstart $&#123;ORACLE_HOME&#125;&quot;</span><br><span class="line">        #su - $&#123;ORACLE_OWNER&#125; -c &quot;$&#123;ORACLE_HOME&#125;/bin/emctl start dbconsole&quot;</span><br><span class="line">        #su - $&#123;ORACLE_OWNER&#125; -c &quot;$&#123;ORACLE_HOME&#125;/bin/isqlplusctl start&quot;</span><br><span class="line">    ;;</span><br><span class="line">    &#x27;stop&#x27;)</span><br><span class="line">        #su - $&#123;ORACLE_OWNER&#125; -c &quot;$&#123;ORACLE_HOME&#125;/bin/isqlplusctl stop&quot;</span><br><span class="line">        #su - $&#123;ORACLE_OWNER&#125; -c &quot;$&#123;ORACLE_HOME&#125;/bin/emctl stop dbconsole&quot;</span><br><span class="line">        su - $&#123;ORACLE_OWNER&#125; -c &quot;$&#123;ORACLE_HOME&#125;/bin/dbshut $&#123;ORACLE_HOME&#125;&quot;</span><br><span class="line">        su - $&#123;ORACLE_OWNER&#125; -c &quot;$&#123;ORACLE_HOME&#125;/bin/lsnrctl stop&quot;</span><br><span class="line">    ;;</span><br><span class="line">    restart)</span><br><span class="line">        restart</span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">        echo &quot;Usage: $0 &#123;start|stop&#125;&quot;</span><br><span class="line">        exit</span><br><span class="line">    ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">exit $?</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>加入自动启动:<br><code>$ sudo chkconfig --add oracledb</code></p>
<h2 id="文档约定"><a href="#文档约定" class="headerlink" title="文档约定"></a>文档约定</h2><pre><code>#开头的命令  说明需要使用root用户执行
$开头的命令  说明需要用oracle用户执行
</code></pre>
]]></content>
      <tags>
        <tag>conf</tag>
        <tag>database</tag>
        <tag>oracle</tag>
        <tag>silent install</tag>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>oracle error</title>
    <url>/2016/09/12/oracle_error/</url>
    <content><![CDATA[<p>In this Document<br>Purpose<br>Troubleshooting Steps<br>     Section I: Steps to approach ORA-12518&#x2F;TNS-12518 Error:</p>
<h3 id="Section-II-Commonly-Known-Errors"><a href="#Section-II-Commonly-Known-Errors" class="headerlink" title="Section II: Commonly Known Errors:"></a>Section II: Commonly Known Errors:</h3><h4 id="Error-32-Broken-pipe"><a href="#Error-32-Broken-pipe" class="headerlink" title="Error: 32: Broken pipe"></a>Error: 32: Broken pipe</h4><h4 id="Error-11-Resource-temporarily-unavailable"><a href="#Error-11-Resource-temporarily-unavailable" class="headerlink" title="Error: 11: Resource temporarily unavailable"></a>Error: 11: Resource temporarily unavailable</h4><h4 id="Error-12-Not-enough-space"><a href="#Error-12-Not-enough-space" class="headerlink" title="Error: 12: Not enough space"></a>Error: 12: Not enough space</h4><span id="more"></span>

<hr>
<h3 id="Error-Connection-Pooling-limit-reached"><a href="#Error-Connection-Pooling-limit-reached" class="headerlink" title="Error: Connection Pooling limit reached"></a>Error: Connection Pooling limit reached</h3><h4 id="Error-2-No-such-file-or-directory"><a href="#Error-2-No-such-file-or-directory" class="headerlink" title="Error: 2: No such file or directory"></a>Error: 2: No such file or directory</h4><h4 id="Error-24-Too-many-open-files"><a href="#Error-24-Too-many-open-files" class="headerlink" title="Error: 24: Too many open files"></a>Error: 24: Too many open files</h4><hr>
<h3 id="Section-III-Errors-Specific-to-Windows"><a href="#Section-III-Errors-Specific-to-Windows" class="headerlink" title="Section III: Errors Specific to Windows"></a>Section III: Errors Specific to Windows</h3><h4 id="Error-233-Unknown-error"><a href="#Error-233-Unknown-error" class="headerlink" title="Error: 233: Unknown error"></a>Error: 233: Unknown error</h4><h4 id="Error-54-Unknown-error"><a href="#Error-54-Unknown-error" class="headerlink" title="Error: 54: Unknown error"></a>Error: 54: Unknown error</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">References</span><br><span class="line"></span><br><span class="line">APPLIES TO:</span><br><span class="line">Oracle Net Services - Version 10.1.0.2 to 11.2.0.3 [Release 10.1 to 11.2]</span><br><span class="line">Information in this document applies to any platform.</span><br><span class="line">PURPOSE</span><br><span class="line">This article discusses about how to approach ORA-12518/TNS-12518 and troubleshoot it for the resolution.</span><br><span class="line">TROUBLESHOOTING STEPS</span><br><span class="line">Section I: Steps to approach ORA-12518/TNS-12518 Error:</span><br><span class="line">ORA-12518/TNS-12518 indicates a problem while listener hands off the client connection to the server process or dispatcher process.TNS-12518 is logged in the listener log. The client might receive ORA-12518 or some other disconnection errors like ORA-12537. Once TNS-12518 is noted in the listener log, follow the below steps to approach and resolve this error.</span><br><span class="line"></span><br><span class="line">Let us have a small discussion about how actually database connections are made:</span><br><span class="line"></span><br><span class="line">In Dedicated mode, database client contacts listener and supplies the SERVICE NAME of the database. Then listener spawns a dedicated server process and hands off the client connection to this dedicated server process. TNS-12518 indicates a problem while handing off the client connection to the server process.</span><br><span class="line">In Shared Server mode, database client contacts listener and supplies the SERVICE NAME of the database. Then listener hands off the client connection to one of the dispatcher configured for that service. TNS-12518 indicates a problem while handing off the client connection to the dispatcher server process.</span><br><span class="line"></span><br><span class="line">Though this error is logged in the listener log, the listener is just the messenger, ORA-12518/TNS-12518 is mostly related to RDBMS and OS resources.</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Step-1-Is-listener-version-compatible-to-the-database"><a href="#Step-1-Is-listener-version-compatible-to-the-database" class="headerlink" title="Step 1. Is listener version compatible to the database"></a>Step 1. Is listener version compatible to the database</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Check if you are using compatible listener version for your database version.</span><br><span class="line"></span><br><span class="line">If the database is 8i then use 8i or 9i listeners only. 10g listeners are not compatible to work with 8i databases.</span><br><span class="line">For 9i databases, 9i or 10g listeners can be used.</span><br><span class="line">For 10g databases, only 10g listeners can be used.</span><br><span class="line"></span><br><span class="line">The general rule is that use the higher version of the listener when there is a version mismatch between database and the listener.</span><br></pre></td></tr></table></figure>

<h3 id="Step-2-Gather-more-information-from-listener-log"><a href="#Step-2-Gather-more-information-from-listener-log" class="headerlink" title="Step 2. Gather more information from listener log"></a>Step 2. Gather more information from listener log</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">The first place you would look for the TNS-12518 error is the listener log. Usually the listener log would be located under $ORACLE_HOME/network/log directory. You can use &#x27;lsnrctl status&#x27; command output to look for the location of the listener log file.</span><br><span class="line">$lsnrctl status</span><br><span class="line">- - -</span><br><span class="line">- - -</span><br><span class="line">Listener Parameter File /ora10g/home_ora10g/network/admin/listener.ora</span><br><span class="line">Listener Log File /ora10g/home_ora10g/network/log/listener.log</span><br><span class="line">- - -</span><br><span class="line">- - -</span><br><span class="line">listener log gives the complete error stack and the database service name to which the client tried to connect to.</span><br><span class="line">19-SEP-2007 13:55:34 * (CONNECT_DATA=(CID=(PROGRAM=)(HOST=__jdbc__)(USER=))(SERVICE_NAME=test.oracle.com)) * (ADDRESS=(PROTOCOL=tcp)(HOST=10.10.10.3)(PORT=36030)) * establish * test.oracle.com * 12518</span><br><span class="line">TNS-12518: TNS:listener could not hand off client connection</span><br><span class="line"> TNS-12547: TNS:lost contact</span><br><span class="line">  TNS-12560: TNS:protocol adapter error</span><br><span class="line">   TNS-00517: Lost contact</span><br><span class="line">    Linux Error: 32: Broken pipe</span><br><span class="line"></span><br><span class="line">In the above example, listener log shows the complete error stack, the bottom error being 32 is the OS error. It also shows that the jdbc client from IP 10.10.10.3 has tried to connect to the database service &#x27;test.oracle.com&#x27; and failed with the error 12518.</span><br><span class="line">Look for the lowest error in the stack. That is the error we have to concentrate on and try to resolve it. In the above example, the lower error is &#x27;Linux Error: 32: Broken pipe&#x27;.</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Step-3-Is-service-handlers-in-blocked-state"><a href="#Step-3-Is-service-handlers-in-blocked-state" class="headerlink" title="Step 3. Is service handlers in blocked state"></a>Step 3. Is service handlers in blocked state</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Check if the handlers are in blocked state. Check the output of the &#x27;lsnrctl services&#x27;. Examine the status information under the database service name. From the listener log you would know which database service was affected by the 12518 error, now with the output of the &#x27;lsnrctl services&#x27; under that service name gather more information.</span><br><span class="line">Service &quot;test.oracle.com&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;db10g&quot;, status READY, has 2 handler(s) for this service...</span><br><span class="line">    Handler(s):</span><br><span class="line">      &quot;DEDICATED&quot; established:9 refused:0 state:ready</span><br><span class="line">         LOCAL SERVER</span><br><span class="line">      &quot;D000&quot; established:10 refused:0 current:0 max:972 state:ready</span><br><span class="line">         DISPATCHER</span><br><span class="line">         (ADDRESS=(PROTOCOL=tcp)(HOST=oid.mohan.com)(PORT=33487))</span><br><span class="line"></span><br><span class="line">The highlighted state should be in &#x27;ready&#x27; state for the connection to be successful. If the state is in &#x27;blocked&#x27; then the connection are not possible. The state of a handler could be in blocked state in the following scenario:</span><br><span class="line">i. The database parameter processes reached its value.</span><br><span class="line">ii. The database is in the process of startup or shutting down.</span><br><span class="line"></span><br><span class="line">In shared server mode, the number of dispatchers should be set according to the load that you expect. &#x27;lsnrctl services&#x27; output shows the maximum number(max:997) of connections that the dispatcher would accept and the number connections refused (refused:0) by this dispatcher. If any connections refused by the dispatcher, then consider increasing the number of dispatchers.</span><br><span class="line"></span><br><span class="line">If you are using PFILE edit init.ora and increase the dispatchers parameter. If you are using SPFILE you can dynamically increase the dispatchers parameter by the &#x27;alter system set&#x27; command.</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Step-4-Is-local-BEQ-connection-successful"><a href="#Step-4-Is-local-BEQ-connection-successful" class="headerlink" title="Step 4. Is local BEQ connection successful"></a>Step 4. Is local BEQ connection successful</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Check if local BEQ connection to the database works fine. It also verifies if the database is up and in good condition to accept the connection. If the database is down or in a hung state then a connection request to the database by the listener will not be possible.</span><br><span class="line"></span><br><span class="line">Connect to the database server via telnet or ssh and check if a local bequeath SQL*Plus connection works. In other words, issue:</span><br><span class="line">sqlplus username/password [Enter]</span><br><span class="line"></span><br><span class="line">This connection bypasses the listener and directly connects to the database via the BEQ (bequeath) protocol. If this fails, then the TNS-12518 listener error is simply a result of the database issue.</span><br><span class="line"></span><br><span class="line">One such error is:</span><br><span class="line">ORA-12560: TNS:protocol adapter error</span><br><span class="line"></span><br><span class="line">A possible cause for this error on Microsoft Windows servers, is that the Windows Database Service has not yet been created (common when creating a &quot;standby&quot; instance).</span><br><span class="line">Resolution for this would be to create the Windows Service first by using the &quot;oradim&quot; command (see the Database Admin guide for details on oradim and service creation).</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Step-5-Is-number-of-processes-reached-its-limit"><a href="#Step-5-Is-number-of-processes-reached-its-limit" class="headerlink" title="Step 5. Is number of processes reached its limit"></a>Step 5. Is number of processes reached its limit</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">If local BEQ is successful, check the below query</span><br><span class="line">SQL&gt; select * from v$resource_limit;</span><br><span class="line"></span><br><span class="line">RESOURCE_NAME CURRENT_UTILIZATION MAX_UTILIZATION INITIAL_AL LIMIT_VALU</span><br><span class="line">-------------------- ------------------- --------------- ---------- ----------</span><br><span class="line">processes 249 250 250 250</span><br><span class="line">sessions 54 82 280 280</span><br><span class="line">- - - - - -</span><br><span class="line">- - - - - -</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Verify if the processes or sessions reached its limit value. If these database parameters reached its limit value, then consider increasing it accordingly.</span><br><span class="line"></span><br><span class="line">In the above example, the processes parameter has been set to 250. It&#x27;sMAX_UTILIZATION has reached the limit value of 250, so the processes parameter should be increased further to accomodate the number of incoming connections.</span><br><span class="line"></span><br><span class="line">Edit the init.ora and set the processes parameter to a higher value. By default, if you just increase the processes it is enough, the sessions value would automatically be increased.</span><br><span class="line">Check the alert.log for a corresponding error such as &quot;ksvcreate&quot; process failed, etc.  Check timestamp against listener.log timestamps for causal relationship.</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Step-6-Is-OS-kernal-parameters-configured-for-optimum"><a href="#Step-6-Is-OS-kernal-parameters-configured-for-optimum" class="headerlink" title="Step 6. Is OS kernal parameters configured for optimum"></a>Step 6. Is OS kernal parameters configured for optimum</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Database is operated by a single user, normally it would be &#x27;oracle&#x27; user. At the Operating System level, there is a limit for the number of process spawned by a user. And also there is a limit for the total number of process running on the entire OS.</span><br><span class="line"></span><br><span class="line">The Oracle Database and the newly spawned processes would be owned by the &#x27;oracle&#x27; user. And so make sure that these values are set accordingly.On Unix these values are configured through the configurable OS kernal parameters and is specific to Operating Systems. You will have check your corresponding OS documentation for your OS.</span><br><span class="line"></span><br><span class="line">For example for HP-UX the configurable kernal parameters are,</span><br><span class="line"></span><br><span class="line">maxuprc  Maximum number of processes for each non-root user</span><br><span class="line">nproc      Maximum number of processes on the system</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Step-7-Does-alert-log-have-any-errors"><a href="#Step-7-Does-alert-log-have-any-errors" class="headerlink" title="Step 7. Does alert log have any errors"></a>Step 7. Does alert log have any errors</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Look in alert log and look for any errors related to memory or process during the time the error TNS-12518 occurred in the listener log. If the alert log has any memory related errors, there there is a potential memory resource issue at the OS level.</span><br><span class="line"></span><br><span class="line">OS memory issues can be addressed by the below:</span><br><span class="line">i.   Make sure that the OS has been configured with the enough Swap memory. In case of Windows it is called as Virtual Memory.</span><br><span class="line">ii.  Reduce the size of SGA, thus the newly spawned server process will have some more system memory available.</span><br><span class="line">iii. Reduce the PGA size, so that the newly spawned server process would occupy less memory.</span><br><span class="line">iv. If you are in DEDICATED mode, try switching to MTS mode.</span><br><span class="line"></span><br><span class="line">To address memory issue for 32-bit Windows: Refer Note 371983.1</span><br><span class="line">If there are any memory or process related error in the alert log during the time the TNS-12518 is logged in the listener log, then those errors in the alert log should be focused on and should be solved at first. Because, the errors in the alert log is the base error for the TNS-12518 in the listener log.</span><br><span class="line"></span><br><span class="line">However, the errors in the alert logs are not being discussed in this article, they are out of the scope of this article.</span><br><span class="line">Step 8. If using a statically defined SID_DESC in the listener.ora file for your sid, ensure that it is configured properly.</span><br><span class="line">A common mistake is to include a (PROGRAM=EXTPROC) parameter:</span><br><span class="line">  (SID_LIST=</span><br><span class="line">    (SID_DESC =</span><br><span class="line">      (GLOBAL_DBNAME = ORCL.oracle.com)</span><br><span class="line">      (SID_NAME = ORCL)</span><br><span class="line">      (PROGRAM=extproc)</span><br><span class="line">      (ORACLE_HOME = D:\oracle\product\10.2.0\db_1)))</span><br><span class="line">This misconfiguration occurs when the PLSExtproc SID_DESC is copied, pasted and edited in the listener.ora file.  The inclusion of the PROGRAM line will cause an ORA-12518 to be returned to the client.  Here&#x27;s the corrected SID_DESC for our example SID:</span><br><span class="line">  (SID_LIST=</span><br><span class="line">     (SID_DESC =</span><br><span class="line">     (GLOBAL_DBNAME = ORCL.oracle.com)</span><br><span class="line">     (SID_NAME = ORCL)</span><br><span class="line">     (ORACLE_HOME = D:\oracle\product\10.2.0\db_1)))</span><br><span class="line">Section II: Commonly Known Errors:</span><br><span class="line"></span><br><span class="line">This section lists some of the known and reported errors. It is also recommended that you refer the Section I above for a generic troubleshooting approach to the error TNS-12518.</span><br><span class="line"></span><br><span class="line">Below shows example error stack that can be found in the listener log. The last line in the error stack shows the actual operating system name. Depending on the OS, only the operating system name would be different. For example, if you encounter error 32: Broken pipe, according to the OS, the last line in the error stack would be different only by the OS name, as shown below.</span><br><span class="line"></span><br><span class="line">Solaris Error: 32: Broken pipe</span><br><span class="line">HPUX Error: 32: Broken pipe</span><br><span class="line">Linux Error: 32: Broken pipe</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Error-32-Broken-pipe-1"><a href="#Error-32-Broken-pipe-1" class="headerlink" title="Error: 32: Broken pipe"></a>Error: 32: Broken pipe</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error stack in listener log:</span><br><span class="line"></span><br><span class="line">TNS-12518: TNS:listener could not hand off client connection</span><br><span class="line"> TNS-12547: TNS:lost contact</span><br><span class="line">   TNS-12560: TNS:protocol adapter error</span><br><span class="line">     TNS-00517: Lost contact</span><br><span class="line">       IBM/AIX RISC System/6000 Error: 32: Broken pipe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Cause:</span><br><span class="line">The error 32 indicates the communication has been broken while the listener is trying to hand off the client connection to the server process or dispatcher process.</span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line">1.  One of reason would be processes parameter being low, and can be verified by the v$resource_limit view.</span><br><span class="line">2. In Shared Server mode, check the &#x27;lsnrctl services&#x27; output and see if the dispatcher has refused any connections, if so, then consider increasing the number of dispatchers.</span><br><span class="line">3. Check the alert log for any possible errors.</span><br><span class="line">4. Memory resource is also another cause for this issue. Check the swap, memory usage of the OS.</span><br><span class="line">5. If RAC/SCAN or listener is running in separate home, check the following note:</span><br><span class="line"></span><br><span class="line">Note: 1069517.1  ORA-12537 or TNS-12518 if Listener (including SCAN Listener) and Database are Owned by Different OS User</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Error-11-Resource-temporarily-unavailable-1"><a href="#Error-11-Resource-temporarily-unavailable-1" class="headerlink" title="Error: 11: Resource temporarily unavailable"></a>Error: 11: Resource temporarily unavailable</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error stack in listener log:</span><br><span class="line">TNS-12518: TNS:listener could not hand off client connection</span><br><span class="line"> TNS-12549: TNS:operating system resource quota exceeded</span><br><span class="line">  TNS-12560: TNS:protocol adapter error</span><br><span class="line">   TNS-00519: Operating system resource quota exceeded</span><br><span class="line">    IBM/AIX RISC System/6000 Error: 11: Resource temporarily unavailable</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Cause:</span><br><span class="line">As the error indicates operating system resource has exceeded.</span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line">1. Increase the appropriate OS kernal parameters for &#x27;maximum number of processes allowed per user&#x27;.</span><br><span class="line">For example for HP-UX the parameters are maxuprc and nproc.</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Error-12-Not-enough-space-1"><a href="#Error-12-Not-enough-space-1" class="headerlink" title="Error: 12: Not enough space"></a>Error: 12: Not enough space</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error stack in listener log:</span><br><span class="line"> TNS-12518: TNS:listener could not hand off client connection</span><br><span class="line">   TNS-12549: TNS:operating system resource quota exceeded</span><br><span class="line">     TNS-12560: TNS:protocol adapter error</span><br><span class="line">       TNS-00519: Operating system resource quota exceeded</span><br><span class="line">         IBM/AIX RISC System/6000 Error: 12: Not enough space</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Cause:</span><br><span class="line">This is a memory related issue. The error indicates that there is not enough memory available to spawn and hand off the client connections.</span><br><span class="line">Typical problems are:</span><br><span class="line">- Out of system memory / swap</span><br><span class="line">- Out of process slots in the process table</span><br><span class="line">- Streams resources depleted</span><br><span class="line">- Out of File Handles</span><br><span class="line">- sga memory usage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line">1. Check in the alert log for any possible memory related error.</span><br><span class="line">2. Increase swap/Virtual memory if possible the available memory.</span><br><span class="line">3. SGA and PGA can be reduced to address the memory consumption.</span><br><span class="line">4. MTS mode can be used to reduce the amount of process and memory consumption.</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Error-Connection-Pooling-limit-reached-1"><a href="#Error-Connection-Pooling-limit-reached-1" class="headerlink" title="Error: Connection Pooling limit reached"></a>Error: Connection Pooling limit reached</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error stack in listener log:</span><br><span class="line"> TNS-12518 TNS:listener could not hand off client connection</span><br><span class="line">  TNS-12564 TNS:connection refused</span><br><span class="line">   TNS-12602 TNS: Connection Pooling limit reached</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line">1. Try increasing initial number of dispatchers.</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Error-2-No-such-file-or-directory-1"><a href="#Error-2-No-such-file-or-directory-1" class="headerlink" title="Error: 2: No such file or directory"></a>Error: 2: No such file or directory</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error stack in listener log:</span><br><span class="line"> TNS-12518: TNS:listener could not hand off client connection</span><br><span class="line">  TNS-12560: TNS:proto adapter error</span><br><span class="line">   TNS-00530: Proto adapter error</span><br><span class="line">    32-bit Windows Error: 2: No such file or directory</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Error Description:</span><br><span class="line">ERROR_FILE_NOT_FOUND</span><br><span class="line">2</span><br><span class="line">The system cannot find the file specified.</span><br><span class="line"></span><br><span class="line">Cause:</span><br><span class="line">This indicates the database service is not actually available</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line">1.Verify if the intended database really up and accepting local BEQ connections.</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Error-24-Too-many-open-files-1"><a href="#Error-24-Too-many-open-files-1" class="headerlink" title="Error: 24: Too many open files"></a>Error: 24: Too many open files</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error stack in listener log:</span><br><span class="line">    TNS-12518: TNS:listener could not hand off client connection</span><br><span class="line">      TNS-12560: TNS:protocol adapter error</span><br><span class="line">       TNS-00530: Protocol adapter error</span><br><span class="line">        Linux Error: 24: Too many open files</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">    TNS-12518: TNS:listener could not hand off client connection</span><br><span class="line">      TNS-12560: TNS:protocol adapter error</span><br><span class="line">       TNS-00530: Protocol adapter error</span><br><span class="line">        Solaris Error: 24: Too many open files</span><br><span class="line">Error Description:</span><br><span class="line"> Out of file descriptors</span><br><span class="line">Cause:</span><br><span class="line">Can be caused by the following unpublished defect:</span><br><span class="line">BUG 13078786 - LISTENER GOES DOWN SUDDENLY W/ LINUX ERROR: 32: BROKEN PIPE</span><br><span class="line">Action:</span><br><span class="line"></span><br><span class="line">See Note 1527483.1  11.2 : ORA-12518 Listener Hangs and Reports &quot;Too Many Open Files&quot;</span><br><span class="line"></span><br><span class="line">Use prescribed workaround OR apply one-off patch to your environment if available.</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Section-III-Errors-Specific-to-Windows-1"><a href="#Section-III-Errors-Specific-to-Windows-1" class="headerlink" title="Section III: Errors Specific to Windows"></a>Section III: Errors Specific to Windows</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">It is also recommended that you refer the Section I above for a generic troubleshooting approach to the error TNS-12518.</span><br><span class="line"></span><br><span class="line">This section briefly describes about the errors that are encountered on Windows Operating System. TNS-12518 most commonly occurs on 32-bit OS due to its memory constraint, however TNS-12518 can occur on 64-bit OS as well. See Note 873752.1 for more information on Windows memory addressing and the 3GB switch.</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Error-233-Unknown-error-1"><a href="#Error-233-Unknown-error-1" class="headerlink" title="Error: 233: Unknown error"></a>Error: 233: Unknown error</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error stack in listener log:</span><br><span class="line"> TNS-12518: TNS:listener could not hand off client connection</span><br><span class="line">  TNS-12560: TNS:protocol adapter error</span><br><span class="line">   TNS-00530: Protocol adapter error</span><br><span class="line">    32-bit Windows Error: 233: Unknown error</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Error Description:</span><br><span class="line">ERROR_PIPE_NOT_CONNECTED</span><br><span class="line">233</span><br><span class="line">No process is on the other end of the pipe.</span><br><span class="line"></span><br><span class="line">Cause:</span><br><span class="line">The communication has been broken while the listener is trying to hand off the client connection to the server process or dispatcher process.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line">Refer Note 371983.1</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Error-54-Unknown-error-1"><a href="#Error-54-Unknown-error-1" class="headerlink" title="Error: 54: Unknown error"></a>Error: 54: Unknown error</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error stack in listener log:</span><br><span class="line"> TNS-12518: TNS:listener could not hand off client connection</span><br><span class="line">  TNS-12571: TNS:packet writer failure</span><br><span class="line">   TNS-12560: TNS:protocol adapter error</span><br><span class="line">    TNS-00530: Protocol adapter error</span><br><span class="line">      32-bit Windows Error: 54: Unknown error</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> Error Description:</span><br><span class="line">ERROR_NETWORK_BUSY</span><br><span class="line">54</span><br><span class="line">0x36</span><br><span class="line">The network is busy.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Cause:</span><br><span class="line">This indicates a bottleneck at the network layer(TCP/IP).</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line">1.Try increasing dispatchers and shared servers.</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>转载ROUBLESHOOTING GUIDE TNS-12518 TNS listener could not hand off client connection (文档ID 550859.1)</p>
</blockquote>
]]></content>
      <tags>
        <tag>oracle</tag>
        <tag>error</tag>
      </tags>
  </entry>
  <entry>
    <title>sqlplus 安装</title>
    <url>/2016/07/25/oracle_sqlplus/</url>
    <content><![CDATA[<p>Oracle数据库软件十分庞大，数据库引擎有好几个G。通常情况下，我们的使用方式是安装一个Oracle数据库在服务器机器上，在客户端通过PL&#x2F;SQL Developer、sqlplus等工具操作服务器上的数据，当然Oracle 10g后，OEM(企业管理器)已经是WEB版了，在浏览器中也可以同样操作数据库。</p>
<h3 id="Windows-下Oracle-Instant-Client-的安装"><a href="#Windows-下Oracle-Instant-Client-的安装" class="headerlink" title="Windows 下Oracle Instant Client 的安装"></a>Windows 下Oracle Instant Client 的安装</h3><p>Windows下客户端工具 PL&#x2F;SQL Developer 使用得最多，Linux下，我喜欢直接使用sqlplus。不论使用哪种工具，都需要在客户端机器上安装Oracle客户端工具，安装以下三种软件均可连接Oracle服务器：</p>
<ul>
<li>Oracle 数据库引擎</li>
<li>Oracle Client</li>
<li>Oracle Instant Client</li>
</ul>
<p>其中前两种占硬盘空间大，并且安装也相对繁琐，我一般喜欢采用第三种方式，因此，下面介绍 Oracle Instant Client 的安装：</p>
<ol>
<li><p>Windows 下Oracle Instant Client 的安装</p>
</li>
<li><p>Oracle Instant Client 下载</p>
<ul>
<li>进入<a href="http://www.oracle.com/">Oracle官网首页</a>，单击首页中的downloads链接，在新页面中选择 Database —&gt; Instant Client，进入 Instant Client Downloads 页，选择相应版本下载。</li>
<li><a href="http://www.oracle.com/cn/index.html">Oracle 中文网站</a></li>
<li>我下载的软件包是：basic、sqlplus.</li>
<li>注意，必须下载basic或者basiclite其中之一，若需要做 OCI &#x2F; OCCI 开发，还需下载 sdk.<span id="more"></span></li>
</ul>
</li>
<li><p>Oracle Instant Client 安装</p>
<ul>
<li>安装很简单，只需直接解压两个包即可，将两个包解压到同一目录下</li>
<li>例如解压到目录 <code>D:\instantclient-10.2.0.3-win32\</code>下。</li>
<li>最后目录结构是：<code>D:\instantclient-10.2.0.3-win32\instantclient_10_2</code>，<code>instantclient_10_2</code>目录下就是解压后的 <code>basic</code> 和 <code>sqlplus</code>.</li>
</ul>
</li>
<li><p>创建数据库连接文件<br>在 <code>D:\instantclient-10.2.0.3-win32\instantclient_10_2</code> 目录下创建文件夹 <code>admin</code>，在 <code>admin</code> 目录下创建文件  <code>tnsnames.ora</code>，根据数据库连接输入以下类似内容</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># tnsnames.ora Network Configuration File: /opt/oracle_11g_R2_x64/product/11.2.0.1.0/db_1/network/admin/tnsnames.ora</span><br><span class="line"># Generated by Oracle configuration tools.</span><br><span class="line"></span><br><span class="line">ORCL =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.232.133)(PORT = 1521))</span><br><span class="line">    (CONNECT_DATA =</span><br><span class="line">      (SERVER = DEDICATED)</span><br><span class="line">      (SERVICE_NAME = orcl)</span><br><span class="line">    )</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<p> 该文件和数据库服务器中的文件内容类似，其作用是配置 sqlplus 和 PL&#x2F;SQL Developer 中连接时的连接字符串。大家都知道该文件的作用，不必赘述。</p>
</li>
<li><p>配置Windows环境变量</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ORACLE_HOME=D:\instantclient-10.2.0.3-win32\instantclient_10_2</span><br><span class="line"></span><br><span class="line">Path=%ORACLE_HOME%; xxxxxx    ===&gt; 作用是在命令行中可以找到 sqlplus 等命令，在运行sqlplus时加载相关库</span><br><span class="line">TNS_ADMIN=%ORACLE_HOME%\admin  ===&gt; 作用是在sqlplus等工具中连接数据库时能找到 tnsnames.ora中的连接符</span><br><span class="line">NLS_lANG=SIMPLIFIED CHINESE_CHINA.ZHS16GBK  ===&gt;    设置客户端的字符集</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><p>完成，测试!</p>
<p> 经过以上步骤后，Oracle Instant Client 安装完毕，在命令行中可以使用命令连接服务器.</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Users\kebyn&gt;sqlplus /nolog</span><br><span class="line"></span><br><span class="line">  SQL*Plus: Release 10.2.0.3.0 - Production on 星期二 1月 10 10:52:53 2012</span><br><span class="line"></span><br><span class="line">  Copyright (c) 1982, 2006, Oracle.  All Rights Reserved.</span><br><span class="line"></span><br><span class="line">  SQL&gt; conn scott/tiger@orcl    ===&gt; 使用到 %TNS_ADMIN% 下 tnsnames.ora中的连接符ORCL</span><br></pre></td></tr></table></figure>
<h3 id="Linux-下-Oracle-Instant-Client-的安装"><a href="#Linux-下-Oracle-Instant-Client-的安装" class="headerlink" title="Linux 下 Oracle Instant Client 的安装"></a>Linux 下 Oracle Instant Client 的安装</h3><ol>
<li>下载</li>
</ol>
<p>Linux 下的 Oracle Instant Client有rpm包和zip包两种，下载任意一种即可，这里以下载的 zip包为例</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">oracle-instantclient11.2-basic-11.2.0.1.0-1.x86_64.zip</span><br><span class="line"></span><br><span class="line">oracle-instantclient11.2-sqlplus-11.2.0.1.0-1.x86_64.zip</span><br><span class="line"></span><br><span class="line">oracle-instantclient11.2-sdk-11.2.0.1.0-1.x86_64.zip</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>解压安装<br>文件被解压到目录  instantclient_11_2 下</li>
<li>创建数据库连接文件<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd instantclient_11_2</span><br><span class="line">mkdir network/admin</span><br><span class="line">vim network/admin/tnsnames.ora</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># tnsnames.ora Network Configuration File: /sdb1/oracle/11gR2_database_X64/product/11.2.0.1.0/db_1/network/admin/tnsnames.ora</span><br><span class="line"># Generated by Oracle configuration tools.</span><br><span class="line"></span><br><span class="line">ZKL =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">    (ADDRESS = (PROTOCOL = TCP)(HOST = glnode04)(PORT = 1521))</span><br><span class="line">    (CONNECT_DATA =</span><br><span class="line">      (SERVER = DEDICATED)</span><br><span class="line">      (SERVICE_NAME = zkl)</span><br><span class="line">    )</span><br><span class="line">  )</span><br></pre></td></tr></table></figure></li>
<li>配置环境变量<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export ORACLE_HOME=/root/linux-11.2.0.1.0-1.x86_64/instantclient_11_2</span><br><span class="line">export PATH=$ORACLE_HOME:$PATH</span><br><span class="line">export TNS_ADMIN=$ORACLE_HOME/network/admin</span><br><span class="line">export LD_LIBRARY_PATH=$ORACLE_HOME:$LD_LIBRARY_PATH</span><br><span class="line">export NLS_LANG=&#x27;simplified chinese_china.ZHS16GBK&#x27;</span><br></pre></td></tr></table></figure>
注意要配置<code>LD_LIBRARY_PATH</code> 变量，sqlplus等程序运行时需要加载相应库，若不配置，则运行时会出现如下错误：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error 6 initializing SQL*Plus</span><br><span class="line">SP2-0667: Message file sp1&lt;lang&gt;.msb not found</span><br><span class="line">SP2-0750: You may need to set ORACLE_HOME to your Oracle software directory</span><br></pre></td></tr></table></figure>
配置完毕后<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source  ~/.bashrc</span><br></pre></td></tr></table></figure></li>
<li>完成，测试!<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@kebyn instantclient_11_2]# sqlplus /nolog</span><br><span class="line"></span><br><span class="line">SQL*Plus: Release 11.2.0.1.0 Production on 星期二 1月 10 11:14:31 2012</span><br><span class="line"></span><br><span class="line">Copyright (c) 1982, 2009, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line">SQL&gt; conn zkl/zkl@zkl</span><br><span class="line">已连接。</span><br><span class="line">SQL&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>在Oracle中，我们会遇到下面一系列的十分重要的参数。同时他们的含义也常常让我们混淆。这些参数有：<br><code>ORACLE_SID, SID, INSTANCE_NAME, SERVICE_NAME, SERVICES_NAMES, DB_NAME, GLOBAL_DBNAME, SID_NAME，以及网络服务名(net service name)，实例服务名(instance service name)等。</code></p>
<ol>
<li><code>ORACLE_SID</code> 与 <code>SID</code> 和 <code>INSTANCE_NAME</code> 以及 <code>SID_NAME</code><br><code>ORACLE_SID</code>：即<code>ORACLE System IDentifier</code>,它是一个环境变量。<br>我们一般在<code>oracle</code>用户的<code>home</code>目录中的<code>.bash_profile</code>中进行定义，一般该文件包含下面一行：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">grep ORACLE_SID .bash_profile</span><br><span class="line">export ORACLE_SID=orcl</span><br></pre></td></tr></table></figure>
其作用就是：<br>在我们使用在sqlplus工具中startup启动数据库时，OS就是利用这个环境变量来fork创建构成Oracle实例的各个进程，以及来命名一些文件的名字。</li>
</ol>
<p>下面的命令的执行必须要有环境变量ORACLE_SID:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SQL&gt; startup</span><br></pre></td></tr></table></figure>
<p>那么我们的环境变量ORACLE_SID应该设置成什么值呢？<br>应该是：我们想要startup哪个Oracle实例，就应该将ORACLE_SID设置成哪个实例的SID：<br>Oracle server由Oracle实例和Oracle数据库两者共同组成。</p>
<ol>
<li>很显然地，我们想要startup哪个Oracle实例，就应该将环境变量ORACLE_SID设置成哪个SID。</li>
<li>SID唯一地标识一个Oracle实例，而<code>ORACLE_SID</code>启动该实例，启动之后我们得到一个Oracle实例，这个实例有一个名字：<code>INSTANCE_NAME</code>。<code>SID==&gt;&gt;ORACLE_SID==&gt;&gt;INSTANCE_NAME</code>这三者是一致的，是完全相同的</li>
<li>同时这个实例向外提供服务，所以又有一个<code>SERVICE_NAME</code></li>
</ol>
<p>而<code>SID_NAME</code>出现在<code>lisnter.ora</code>文件中：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[oracle@localhost oracle]$ cat listener.ora</span><br><span class="line"># listener.ora Network Configuration File: /u01/app/oracle/product/10.2.0/db_1/network/admin/listener.ora</span><br><span class="line"># Generated by Oracle configuration tools.</span><br><span class="line"></span><br><span class="line">SID_LIST_LISTENER =</span><br><span class="line">  (SID_LIST =</span><br><span class="line">    (SID_DESC =</span><br><span class="line">      (SID_NAME = PL***tProc)</span><br><span class="line">      (ORACLE_HOME = /u01/app/oracle/product/10.2.0/db_1)</span><br><span class="line">      (PROGRAM = extproc)</span><br><span class="line">    )</span><br><span class="line">    (SID_DESC =</span><br><span class="line">      (SID_NAME = orcl)</span><br><span class="line">      (ORACLE_HOME = /u01/app/oracle/product/10.2.0/db_1)</span><br><span class="line">      (GLOBAL_DBNAME = orcl)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">LISTENER =</span><br><span class="line">  (DESCRIPTION_LIST =</span><br><span class="line">    (DESCRIPTION =</span><br><span class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))</span><br><span class="line">      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))</span><br><span class="line">    )</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<p>lisnter.ora中的SID_NAME的值必须与SID的值一致。通过lisnter.ora中的SID_NAME和GLOBAL_DBNAME两个参数以及客户端的tnsnames.ora中的SERVICE_NAME，这三个参数一起作用，可以实现ORACLE客户端与服务端的隔离。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[oracle@localhost oracle]$ cat tnsnames.ora</span><br><span class="line"># tnsnames.ora Network Configuration File: /u01/app/oracle/product/10.2.0/db_1/network/admin/tnsnames.ora</span><br><span class="line"># Generated by Oracle configuration tools.</span><br><span class="line"></span><br><span class="line">JIAGULUN =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">    (ADDRESS_LIST =</span><br><span class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.0.100)(PORT = 1521))</span><br><span class="line">    )</span><br><span class="line">    (CONNECT_DATA =</span><br><span class="line">      (SERVICE_NAME = orcl)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">EXTPROC_CONNECTION_DATA =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">    (ADDRESS_LIST =</span><br><span class="line">      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))</span><br><span class="line">    )</span><br><span class="line">    (CONNECT_DATA =</span><br><span class="line">      (SID = PL***tProc)</span><br><span class="line">      (PRESENTATION = RO)</span><br><span class="line">    )</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<p>客户端根据tnsname.ora中的SERVICE_NAME和地址(ADDRESS &#x3D; (PROTOCOL &#x3D; TCP)(HOST &#x3D; 192.168.0.100)(PORT &#x3D; 1521))，到这个地址去访问监听器。然后监听器根据文件lisnter.ora文件中的GLOBAL_NAME来判断是否有一个 GLOBAL_DBNAME 和 SERVICE_NAME 相等。如果相等，则建立客户端到SID标识的服务端实例的连接。(有一个例外：tnsnames.ora中可以用参数SID来取代SERVICE_NAME，这时比较的是tnsnames.ora中的SID和lisnter.ora中的SID_NAME，但是从oracle9i开始不推荐使用SID。因为SID无法隔离客户端和服务端)</p>
<p>tnsnames.ora中的地址(ADDRESS &#x3D; (PROTOCOL &#x3D; TCP)(HOST &#x3D; 192.168.0.100)(PORT &#x3D; 1521))是监听器监听的地址。监听器进程一直在这个地址上监听，等待客户端的连接。</p>
<p>总结一下：</p>
<ol>
<li>客户端和服务端的隔离是通过lisnter.ora中的GLOBAL_DBNAME来实现的，GLOBAL_DBNAME是一个连接客户端和服务端的桥梁：<br>a&gt;client端tnsnames.ora中的SERVICE_NAME和server端lisnter.ora中的GLOBAL_DBNAME相等；<br>b&gt;server端的lisnter.ora中的SID_NAME与系统的SID相等；</li>
<li>SID&#x3D;&#x3D;&gt;&gt;SID_NAME&#x3D;&#x3D;&gt;&gt;ORACLE_SID&#x3D;&#x3D;&gt;&gt;INSTANCE_NAME 四者是一致的，相等的；</li>
<li>可以在lisnter.ora中配置多个不同的GLOBAL_NAME来供不同的客户端SERVICE_NAME来对应，从而实现不同的客户端使用不同的SERVICE_NAME来访问同一个SID实例使用，配置如下：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lisnter.ora:</span><br><span class="line">    (SID_DESC =</span><br><span class="line">      (SID_NAME = jiagulun)</span><br><span class="line">      (ORACLE_HOME = /u01/app/oracle/product/10.2.0/db_1)</span><br><span class="line">      (GLOBAL_DBNAME = jiagulun)</span><br><span class="line">    )</span><br><span class="line">    (SID_DESC =</span><br><span class="line">      (SID_NAME = jiagulun)</span><br><span class="line">      (ORACLE_HOME = /u01/app/oracle/product/10.2.0/db_1)</span><br><span class="line">      (GLOBAL_DBNAME = jgl)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">tnsnames.ora:</span><br><span class="line">JIAGULUN =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">    (ADDRESS_LIST =</span><br><span class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.0.100)(PORT = 1521))</span><br><span class="line">    )</span><br><span class="line">    (CONNECT_DATA =</span><br><span class="line">      (SERVICE_NAME = jiagulun)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">JGL =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">     (ADDRESS_LIST =</span><br><span class="line">        (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.0.100)(PORT = 1521)）</span><br><span class="line">     )</span><br><span class="line">     (CONNECT_DATA =</span><br><span class="line">        (SERVICE_NAME = jgl)</span><br><span class="line">     )</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
同时设置一下参数service_names(不进行该项设置似乎也可以，无关紧要)<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SQL&gt; show parameter service</span><br><span class="line">NAME                                 TYPE        VALUE</span><br><span class="line">------------------------------------ ----------- ------------------------------</span><br><span class="line">service_names                        string      jiagulun</span><br><span class="line">SQL&gt; alter system set service_names = &#x27;jiagulun,jgl&#x27; scope=both;</span><br><span class="line">System altered.</span><br><span class="line">SQL&gt; show parameter service</span><br><span class="line">NAME                                 TYPE        VALUE</span><br><span class="line">------------------------------------ ----------- ------------------------------</span><br><span class="line">service_names                        string      jiagulun,jgl</span><br><span class="line">SQL&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[oracle@redhat4 admin]$ tnsping jiagulun</span><br><span class="line">TNS Ping Utility for Linux: Version 10.2.0.1.0 - Production on 01-NOV-2012 20:12:22</span><br><span class="line">Copyright (c) 1997, 2005, Oracle.  All rights reserved.</span><br><span class="line">Used parameter files:</span><br><span class="line">Used TNSNAMES adapter to resolve the alias</span><br><span class="line">Attempting to contact (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.0.100)(PORT = 1521))) (CONNECT_DATA = (SERVICE_NAME = jiagulun)))</span><br><span class="line">OK (0 msec)</span><br><span class="line"></span><br><span class="line">[oracle@redhat4 admin]$ tnsping jgl</span><br><span class="line">TNS Ping Utility for Linux: Version 10.2.0.1.0 - Production on 01-NOV-2012 20:12:27</span><br><span class="line">Copyright (c) 1997, 2005, Oracle.  All rights reserved.</span><br><span class="line">Used parameter files:</span><br><span class="line">Used TNSNAMES adapter to resolve the alias</span><br><span class="line">Attempting to contact (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.0.100)(PORT = 1521))) (CONNECT_DATA = (SERVICE_NAME = jgl)))</span><br><span class="line">OK (10 msec)</span><br><span class="line">[oracle@redhat4 admin]$</span><br></pre></td></tr></table></figure>
<p>现在我们在客户端既可以使用SERVICE_NAME&#x3D;jiagulun来访问服务端，也可以使用SERVICE_NAME&#x3D;jgl来访问。使用plsql develop用jgl和jiagulun都可以正常登陆。</p>
<ol start="2">
<li>SID 与 DB_NAME<br>显然，DB_NAME唯一性地标识了 oracle database，与数据库物理文件相关；而SID唯一性地标识了oracle instance，与所有进程相关。而oracle database和oracle instance一起组成了oracle server. SID和DB_NAME在非RAC环境默认是相等的。但是二者相等与否，无关紧要。在RAC环境，因为一个DB_NAME对应多个SID，所以不可能相等了。</li>
</ol>
<p>DB_NAME是最重要的一个参数，在dbca中填写的DB_NAME，应该与启动参数文件pfile&#x2F;spfile中的一致。在dbca中创建数据库时填写DB_NAME被写入到了多个地方：启动参数文件、控制文件、数据文件、日志文件等。<br>所以我们不能随便地修改启动参数文件中的DB_NAME参数：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sys@JIAGULUN&gt; create pfile from spfile;</span><br><span class="line">File created.</span><br><span class="line"></span><br><span class="line">sys@JIAGULUN&gt; exit</span><br><span class="line">Disconnected from Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - Production</span><br><span class="line">With the Partitioning, OLAP and Data Mining options</span><br><span class="line">[oracle@redhat4 oradata]$ grep db_name /u01/app/oracle/product/10.2.0/db_1/dbs/initjiagulun.ora</span><br><span class="line">*.db_name=&#x27;jiagulun&#x27;</span><br><span class="line">[oracle@redhat4 oradata]$</span><br></pre></td></tr></table></figure>
<p>如果启动参数文件中的DB_NAME与控制文件中的不一致，则在mount阶段会报错。</p>
<ol start="3">
<li>SERVICE_NAME 与 SERVICE_NAMES<br>SERVICE_NAME是Oracle实例提供的服务名。它隔离了Oracle实例，客户端仅仅需要知道SERVICE_NAME就可以访问实例。而不需要知道实例的SID。更不需要知道DB_NAME等信息。<br>SERVICE_NAMES为实例定义一个或多个SERVICE_NAME，这样可以通过多个SERVICE_NAME将不同的用户连接区分开来。</li>
</ol>
<p>service name似乎应该分为两种，一种是实例服务名 instance service name，一种是网络服务名 net service name，如下tnsnames.ora所示：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">net_service_name =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">     (ADDRESS_LIST =</span><br><span class="line">        (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.0.100)(PORT = 1521))</span><br><span class="line">     )</span><br><span class="line">     (CONNECT_DATA =</span><br><span class="line">        (SERVICE_NAME = instance_service_name)</span><br><span class="line">     )</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<p>而plsql develop登陆使用的是net_service_name，而不是instance_service_name。<br>而tnsping 测试的也是net_service_name，而不是instance_service_name。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[oracle@redhat4 admin]$ cat tnsnames.ora</span><br><span class="line"># tnsnames.ora Network Configuration File: /u01/app/oracle/product/10.2.0/db_1/network/admin/tnsnames.ora</span><br><span class="line"># Generated by Oracle configuration tools.</span><br><span class="line"></span><br><span class="line">JIAGULUN =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">    (ADDRESS_LIST =</span><br><span class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.0.100)(PORT = 1521))</span><br><span class="line">    )</span><br><span class="line">    (CONNECT_DATA =</span><br><span class="line">      (SERVICE_NAME = jiagulun)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">net_jgl =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">     (ADDRESS_LIST =</span><br><span class="line">        (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.0.100)(PORT = 1521))</span><br><span class="line">     )</span><br><span class="line">     (CONNECT_DATA =</span><br><span class="line">        (SERVICE_NAME = jgl)</span><br><span class="line">     )</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">EXTPROC_CONNECTION_DATA =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">    (ADDRESS_LIST =</span><br><span class="line">      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC0))</span><br><span class="line">    )</span><br><span class="line">    (CONNECT_DATA =</span><br><span class="line">      (SID = PL***tProc)</span><br><span class="line">      (PRESENTATION = RO)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">[oracle@redhat4 admin]$ tnsping net_jgl</span><br><span class="line">TNS Ping Utility for Linux: Version 10.2.0.1.0 - Production on 02-NOV-2012 14:01:55</span><br><span class="line">Copyright (c) 1997, 2005, Oracle.  All rights reserved.</span><br><span class="line">Used parameter files:</span><br><span class="line"></span><br><span class="line">Used TNSNAMES adapter to resolve the alias</span><br><span class="line">Attempting to contact (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.0.100)(PORT = 1521))) (CONNECT_DATA = (SERVICE_NAME = jgl)))</span><br><span class="line">OK (10 msec)</span><br><span class="line">[oracle@redhat4 admin]$ tnsping jgl</span><br><span class="line">TNS Ping Utility for Linux: Version 10.2.0.1.0 - Production on 02-NOV-2012 14:01:59</span><br><span class="line">Copyright (c) 1997, 2005, Oracle.  All rights reserved.</span><br><span class="line">Used parameter files:</span><br><span class="line">TNS-03505: Failed to resolve name</span><br><span class="line">[oracle@redhat4 admin]$</span><br></pre></td></tr></table></figure>
<p>如上所示：当我们使用 tnsping instance_service_name是失败了。<br>而 sqlplus scott&#x2F;tiger@net_jgl 使用的也是net_service_name.</p>
<p>所以 tnsping, sqlplus user&#x2F;passwd@net_jgl, plsql develop使用的都是net_service_name，而不是instance_service_name.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[oracle@redhat4 admin]$ sqlplus scott/tiger@net_jgl</span><br><span class="line">SQL*Plus: Release 10.2.0.1.0 - Production on Thu Nov 1 21:08:48 2012</span><br><span class="line">Copyright (c) 1982, 2005, Oracle.  All rights reserved.</span><br><span class="line">Connected to:</span><br><span class="line">Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - Production</span><br><span class="line">With the Partitioning, OLAP and Data Mining options</span><br><span class="line"></span><br><span class="line">[oracle@redhat4 admin]$ sqlplus scott/tiger@jgl</span><br><span class="line">SQL*Plus: Release 10.2.0.1.0 - Production on Fri Nov 2 14:05:57 2012</span><br><span class="line">Copyright (c) 1982, 2005, Oracle.  All rights reserved.</span><br><span class="line">ERROR:</span><br><span class="line">ORA-12154: TNS:could not resolve the connect identifier specified</span><br></pre></td></tr></table></figure>
<p>所以这里提供了多层的隔离：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">net_service_name ==&gt;&gt; instance_service_name ==&gt;&gt; global_dbname ==&gt;&gt; sid_name ==&gt;&gt; sid</span><br><span class="line">  (sid_name=sid=oracle_sid=instance_name)</span><br><span class="line">1&gt; tnsnames.ora中定义了net_service_name和instance_service_name的对应，或者说隔离。</span><br><span class="line">2&gt; lisnter.ora中定义了global_dbname和sid的对应，或者说隔离；</span><br><span class="line">3&gt; 而tnsnames.ora中的instance_service_name(SERVICE_NAME)又和lisnter.ora中的GLOBAL_DBNAME相等。将两层隔离连接起来。</span><br></pre></td></tr></table></figure>
<p>环境设置文件<code>oracle\product\10.1.0\db_1\sqlplus\admin\glogin</code></p>
<blockquote>
<p>参见<a href="http://blog.chinaunix.net/uid-25909722-id-3395064.html">Oracle的启动和关闭剖析</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>command</tag>
        <tag>database</tag>
        <tag>oracle</tag>
        <tag>sqlplus</tag>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>random_password</title>
    <url>/2016/07/17/random_password/</url>
    <content><![CDATA[<ol>
<li><p><code>&lt;/dev/urandom  tr -dc &#39; 0-9a-zA-Z-~!@#$%,./\|&#39;  | head -c32; echo &quot;&quot;</code></p>
<span id="more"></span>
</li>
<li><p><code>&lt; /dev/urandom tr -dc _A-Z-a-z-0-9 | head -c$&#123;1:-32&#125;;echo;</code></p>
<ul>
<li>上述命令使用内嵌的&#x2F;dev&#x2F;urandom，只输出字符，结果取头32个。</li>
</ul>
</li>
<li><p><code>openssl rand -base64 32</code></p>
<ul>
<li>上述命令使用系统自带的openssl的随机特点来产生随机密码</li>
</ul>
</li>
<li><p><code>tr -cd &#39; [:alnum:]&#39;  &lt; /dev/urandom | fold -w30 | head -n1</code></p>
</li>
<li><p><code>strings /dev/urandom | grep -o &#39;[[:alnum:]]&#39; | head -n 32 | tr -d &#39;\n&#39;; echo</code></p>
<ul>
<li>通过过滤字符命令，输出随机密码</li>
</ul>
</li>
<li><p><code>&lt; /dev/urandom tr -dc _A-Z-a-z-0-9 | head -c6 </code></p>
</li>
<li><p><code>dd if=/dev/urandom bs=1 count=32 2&gt;/dev/null | base64 -w 0 | rev | cut -b 2- | rev</code></p>
</li>
<li><p><code>date +%s | sha256sum | base64 | head -c 32 ; echo</code></p>
<ul>
<li>上述命令使用SHA来哈希日期，输出头32个字节。</li>
</ul>
</li>
<li><p><code>randpw()&#123; &lt; /dev/urandom tr -dc _A-Z-a-z-0-9 | head -c$&#123;1:-16&#125;;echo;&#125;</code></p>
</li>
<li><p><code>date | md5sum</code></p>
</li>
</ol>
]]></content>
      <tags>
        <tag>command</tag>
        <tag>password</tag>
        <tag>random</tag>
      </tags>
  </entry>
  <entry>
    <title>rsapberry ssh 连接不上问题 (raspberry ssh connection failed)</title>
    <url>/2017/04/16/raspberry_ssh/</url>
    <content><![CDATA[<h5 id="2016-11-25："><a href="#2016-11-25：" class="headerlink" title="2016-11-25："></a>2016-11-25：</h5><p>  <em><strong>*默认情况下禁用SSH; 可以通过在引导分区中创建名为“ssh”的文件来启用</strong></em><br>  <em><strong>*启用默认密码时启用SSH时提示密码更改</strong></em></p>
<blockquote>
<p><a href="http://downloads.raspberrypi.org/raspbian/release_notes.txt">官方文档</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2017-04-10：</span><br><span class="line">  * Wolfram Mathematica更新到11.0.1版本</span><br><span class="line">  * Adobe Flash Player已更新至版本25.0.0.127</span><br><span class="line">  *使用PARTUUID来支持USB启动</span><br><span class="line">2017-03-02：</span><br><span class="line">  *更新内核和固件（最终的Pi Zero W支持）</span><br><span class="line">  * Wolfram Mathematica更新到版本11</span><br><span class="line">  * NOOBS安装现在检查在NOOBS分区上是否存在&#x27;ssh&#x27;文件。</span><br><span class="line">2017-02-16：</span><br><span class="line">  * Chromium浏览器更新到版本56</span><br><span class="line">  * Adobe Flash Player已更新至24.0.0.221版</span><br><span class="line">  * RealVNC Server和Viewer更新到6.0.2版（RealVNC Connect）</span><br><span class="line">  * Sonic Pi更新到2.11版本</span><br><span class="line">  * Node-RED更新到版本0.15.3</span><br><span class="line">  * Scratch更新到120117版本</span><br><span class="line">  *使用默认密码检测启用的SSH已移至PAM</span><br><span class="line">  *更新桌面GL驱动程序，以支持使用假KMS选项</span><br><span class="line">  * Raspberry Pi配置和raspi-config允许设置固定的HDMI分辨率</span><br><span class="line">  * raspi-config允许串行硬件独立于串行终端</span><br><span class="line">  *更新内核和固件</span><br><span class="line">  *各种小错误修复和可用性和外观调整</span><br><span class="line">2017-01-11：</span><br><span class="line">  *使用FAT32格式的引导分区重新发布2016-11-25图像</span><br><span class="line">2016-11-25：</span><br><span class="line">  *默认情况下禁用SSH; 可以通过在引导分区中创建名为“ssh”的文件来启用</span><br><span class="line">  *启用默认密码时启用SSH时提示密码更改</span><br><span class="line">  *包括Adobe Flash Player</span><br><span class="line">  *更新Chromium浏览器中的硬件视频加速</span><br><span class="line">  * Greeter现在使用外观设置中最后一个设置的背景图像，而不是pi用户</span><br><span class="line">  *更新版本的Scratch</span><br><span class="line">  *从raspi-config和Raspberry Pi Configuration中删除Rastrack选项</span><br><span class="line">  *能够禁用图形启动启动屏幕添加到raspi-config和Raspberry Pi配置</span><br><span class="line">  *外观设置对话框标签为在小屏幕上更好地工作</span><br><span class="line">  * Raspberry Pi配置现在需要当前密码才能更改密码</span><br><span class="line">  *各种小错误修复</span><br><span class="line">  *更新固件和内核</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2016-09-23：</span><br><span class="line">  *新的PIXEL桌面环境 - 新的图标集，窗口设计，桌面图像，启动屏幕和恭喜</span><br><span class="line">  *包含Chromium网络浏览器</span><br><span class="line">  *包含Infinality字体渲染补丁</span><br><span class="line">  *包括RealVNC服务器和查看器</span><br><span class="line">  *包含SenseHAT仿真器</span><br><span class="line">  * RFkill条目添加到Wifi和蓝牙面板插件</span><br><span class="line">  *更新各种标准应用程序，包括Scratch和NodeRED</span><br><span class="line">  *各种错误修复，调整和翻译更新</span><br><span class="line">  *更新固件和内核（https://github.com/raspberrypi/firmware/commit/ad8608c08b122b2c228dba0ff5070d6e9519faf5）</span><br><span class="line">至于27：</span><br><span class="line">  *当D-bus不可访问时，修复了lxpanel的崩溃</span><br><span class="line">  *固定D-bus蓝牙访问权限</span><br><span class="line">  *从关闭选项中删除sudo</span><br><span class="line">  *主题更新的工具提示的外观</span><br><span class="line">  *固定弹出插件抓取焦点</span><br><span class="line">  * raspi-config命令行和GUI应用程序整理; 删除不必要的重启</span><br><span class="line">  *在piclone中更多错误检测; 复制添加的卷名称和ID</span><br><span class="line">  *更新翻译文件</span><br><span class="line">2016-05 -10：</span><br><span class="line">  *新版Scratch，不再需要sudo</span><br><span class="line">  *新版BlueJ</span><br><span class="line">  *新版本的NodeRED</span><br><span class="line">  *新版Pypy</span><br><span class="line">  *包括pigpio</span><br><span class="line">  *包括geany编辑器</span><br><span class="line">  * SD卡复印机添加（可用于复制或备份Pi）</span><br><span class="line">  *蓝牙插件添加到任务栏</span><br><span class="line">  *任务栏上的音量控制现在与蓝牙设备兼容</span><br><span class="line">  *新的关机助手应用程序</span><br><span class="line">  *鼠标双击速度设置添加到鼠标和键盘首选项应用程序</span><br><span class="line">  *选项启用/禁用1线接口和远程访问添加到Raspberry Pi配置应用程序的pigpio</span><br><span class="line">  *文件系统在首次启动时自动扩展</span><br><span class="line">  *添加空的废纸篓选项到右键菜单</span><br><span class="line">  * Ctrl-Alt-T可用于打开终端窗口</span><br><span class="line">  *各种小错误修复和外观调整</span><br><span class="line">  *更新固件和内核（https://github.com/raspberrypi/firmware/commit/cc6d7bf8b4c03a2a660ff9fdf4083fc165620866）</span><br><span class="line">2016-03-18：</span><br><span class="line">  *更新固件和内核（https://github.com/raspberrypi/firmware/commit/951799bbcd795ddf27769d14acf4813fdcbe53dc）</span><br><span class="line">  *在cmdline.txt中使用serial0</span><br><span class="line">  * wpa_supplicant.conf国家默认为GB（允许使用通道12和13）</span><br><span class="line">2016-02-26：</span><br><span class="line">  *支持添加Pi 3，包括Wifi和蓝牙</span><br><span class="line">  *将WiFi国家代码设置为raspi-config的选项</span><br><span class="line">2016-02-09：</span><br><span class="line">  * dtb使用mmc sdcard驱动程序（修复某些SD卡遇到的问题）</span><br><span class="line">2016-02-03：</span><br><span class="line">  *新版本的Sonic Pi（2.9）</span><br><span class="line">  *新版Scratch（15/1/16）</span><br><span class="line">  *新版本的Node-Red（2.5）</span><br><span class="line">  *新版Wolfram（10.3）</span><br><span class="line">  *可选实验GL桌面驱动程序（可以使用命令行raspi-config中的高级选项启用）</span><br><span class="line">  *新版本的Java（1.8.0_65）</span><br><span class="line">  *新版本的WiringPi</span><br><span class="line">  *包含raspi-gpio</span><br><span class="line">  * ping不再需要sudo（NOOBS安装除外）</span><br><span class="line">  *支持lxpanel中的更多USB音频设备</span><br><span class="line">  *在Alacarte中创建新菜单的错误修复</span><br><span class="line">  *对raspi-config和GUI进行各种更改，以整理板支持和修复错误以及更新的翻译</span><br><span class="line">  *小调整主题以支持GL驱动</span><br><span class="line">2015-11-21：</span><br><span class="line">  *包括IBM Node-RED IoT应用程序</span><br><span class="line">  *包括图形包管理器</span><br><span class="line">  *包含加速的pixman库</span><br><span class="line">  *更新了Epiphany浏览器，以提高视频兼容性</span><br><span class="line">  *更新Scratch与性能改进和错误修复</span><br><span class="line">  *更新了Raspberry Pi配置，以允许启动暂停</span><br><span class="line">    网络建立</span><br><span class="line">  *各种小错误修复</span><br><span class="line">2015-09-25：</span><br><span class="line">  *基于Debian Jessie</span><br><span class="line">  *升级应用程序 - 主显节浏览器，Scratch和Sonic Pi</span><br><span class="line">  *包含的应用程序 -  LibreOffice，Claws Mail，Greenfoot，BlueJ</span><br><span class="line">  *包含的实用程序 -  Alacarte菜单编辑器，Lxkeymap，scrot，tree，pip</span><br><span class="line">  *新的基于GUI的Raspberry Pi配置应用程序</span><br><span class="line">  * GPIO控制现在可以不需要sudo</span><br><span class="line">  *包含Magpi杂志的网页链接</span><br><span class="line">  *新的任务栏插件来弹出安装的USB驱动器</span><br><span class="line">  *默认启动现在是GUI不是桌面</span><br><span class="line">  *现在看起来基于GTK + 3默认主题</span><br><span class="line">  *打印屏幕键启动scrot以产生截图</span><br><span class="line">  *由GUI和驱动程序自动检测的通用键盘相应地加载</span><br><span class="line">  *许多小的调整和错误修复</span><br><span class="line">2015-05-05：</span><br><span class="line">  *更新UI更改</span><br><span class="line">  *更新固件</span><br><span class="line">  *安装raspberrypi-net-mods</span><br><span class="line">  *安装avahi-daemon</span><br><span class="line">  *将用户pi添加到新的i2c和spi组</span><br><span class="line">  * i2c和spi设备修改的udev规则</span><br><span class="line">2015-02-16：</span><br><span class="line">  *较新的固件与各种修复</span><br><span class="line">  *新的Sonic Pi发行</span><br><span class="line">  * Pi2兼容RPi.GPIO</span><br><span class="line">  Wolfram数学更新</span><br><span class="line">2015-01-31：</span><br><span class="line">  *支持Pi2</span><br><span class="line">  *较新的固件</span><br><span class="line">  *新的Sonic Pi发行</span><br><span class="line">  *更新划痕</span><br><span class="line">  *新的Wolfram数学发行</span><br><span class="line">  *更新主显节</span><br><span class="line">2014-12-24：</span><br><span class="line">  *通过省略python-pygame来修复回归</span><br><span class="line">2014-12-22：</span><br><span class="line">  *新固件与variosu修复和改进</span><br><span class="line">  * lxde的新UI配置</span><br><span class="line">  *各种包更新</span><br><span class="line">  * python3-pygame预装</span><br><span class="line">  *&#x27;nuscratch&#x27;，在Cog StackVM上运行</span><br><span class="line">  *其他更改</span><br><span class="line">2014-09-09：</span><br><span class="line">  *具有各种修复和改进的新固件</span><br><span class="line">  * Minecraft Pi预装</span><br><span class="line">  * Sonic Pi升级到2.0</span><br><span class="line">  *包括Collabora中的主显式浏览器工作</span><br><span class="line">  *从Java 7切换到Java 8</span><br><span class="line">  *更新数学</span><br><span class="line">  *其他次要配置更改</span><br><span class="line">2014-06-20：</span><br><span class="line">  *具有各种修复的新固件和内核错误修复</span><br><span class="line">2014-06-02：</span><br><span class="line">  *许多固件更新与主要的USB改进</span><br><span class="line">  * pyserial默认安装</span><br><span class="line">  * picamera默认安装</span><br><span class="line">2014-01-07：</span><br><span class="line">  *固件更新</span><br><span class="line">  *保存在根文件系统上的一些空间</span><br><span class="line">2013-12-20：</span><br><span class="line">  *固件更新，包括V4L2修复</span><br><span class="line">  *更新omxplayer</span><br><span class="line">2013-12-18：</span><br><span class="line">  *固件更新，现在使用内核3.10。许多改进</span><br><span class="line">  * fbturbo XOrg驱动程序默认包含并启用。谢谢</span><br><span class="line">    ssvb https://github.com/ssvb/xf86-video-fbturbo</span><br><span class="line">  *更新Scratch图像与进一步的错误修复</span><br><span class="line">  *包括Wolfram Mathematica</span><br><span class="line">  *更新到PyPy 2.2</span><br><span class="line">  *更新omxplayer</span><br><span class="line">  *包含v4l-utils用于实验V4L2 Raspberry Pi相机驱动程序</span><br><span class="line">  *更新squeak-vm以解决加载JPEG的问题</span><br><span class="line">2013-09-25：</span><br><span class="line">  *更新Scratch图像以进一步提高性能</span><br><span class="line">  *包括Oracle JDK</span><br><span class="line">  *至少需要4GiB SD卡（见上文）</span><br><span class="line">  *包含PyPy 2.1</span><br><span class="line">  *包含基本的piface包</span><br><span class="line">  *更新raspi-config以包含用于继承语言设置的错误修复</span><br><span class="line">    来自NOOBS</span><br><span class="line">2013-09-10：</span><br><span class="line">  *更新到当前顶部的树固件</span><br><span class="line">  *更新squeak-vm，包括针对Raspbery Pi优化的fastblit</span><br><span class="line">  *包括Sonic Pi和固定的jackd2包</span><br><span class="line">  *支持启动到Scratch</span><br><span class="line">  *从NOOBS继承键盘和语言设置</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>ssh</tag>
        <tag>raspberry</tag>
        <tag>release</tag>
      </tags>
  </entry>
  <entry>
    <title>redmine</title>
    <url>/2017/06/13/redmine/</url>
    <content><![CDATA[<ol>
<li>##<strong>403</strong></li>
</ol>
<p><strong>There are no projects with trackers for which you can create an issue!</strong></p>
<ol>
<li><p>Issue statuses问题状态<br> - 设置问题状态</p>
</li>
<li><p>Trackers跟踪标签<br> - 设置跟踪标签,跟踪标签中需要设置问题状态</p>
</li>
<li><p>Roles and permissions角色和权限<br> - 设置跟踪标签的权限，给予new issue权限</p>
<span id="more"></span></li>
<li><h2 id="Mariadb"><a href="#Mariadb" class="headerlink" title="Mariadb"></a>Mariadb</h2></li>
<li><p>cmake选项<br>- <a href="https://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html">https://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html</a></p>
</li>
<li><p>下载<br>- <a href="https://downloads.mariadb.org/">https://downloads.mariadb.org/</a></p>
</li>
<li><p>初始化<br>- [<a href="https://dev.mysql.com/doc/refman/5.7/en/installing-source-distribution.html]">https://dev.mysql.com/doc/refman/5.7/en/installing-source-distribution.html]</a>(<a href="https://dev-/">https://dev-</a> .mysql.com&#x2F;doc&#x2F;refman&#x2F;5.7&#x2F;en&#x2F;installing-source-distribution.html)</p>
</li>
<li><p>授权</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Your MariaDB connection id is 10</span><br><span class="line">Server version: 10.2.6-MariaDB Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE redmine CHARACTER SET utf8;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; CREATE USER &#x27;redmine&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;redmine&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON redmine.* TO &#x27;redmine&#x27;@&#x27;localhost&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; \q</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>
</li>
<li><h2 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h2></li>
<li><p>rbenv<br>- 安装</p>
<ul>
<li>rbenv   <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git clone https://github.com/rbenv/rbenv.git ~/.rbenv</span><br><span class="line">$ cd ~/.rbenv &amp;&amp; src/configure &amp;&amp; make -C src</span><br></pre></td></tr></table></figure></li>
<li>ruby-build   <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git clone https://github.com/rbenv/ruby-build.git</span><br><span class="line">$ cd ruby-build</span><br><span class="line">$ ./install.sh</span><br></pre></td></tr></table></figure>
<pre><code>- rbenv环境变量
</code></pre>
   <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># rbenv - setting</span><br><span class="line">export PATH=&quot;$HOME/.rbenv/bin:$PATH&quot;</span><br><span class="line"></span><br><span class="line"># to detect .rbenv-version</span><br><span class="line">eval &quot;$(rbenv init -)&quot;</span><br><span class="line"></span><br><span class="line"># prod</span><br><span class="line">export RAILS_ENV=&quot;production&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>安装依赖</p>
   <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gem install bundler</span><br><span class="line">sudo apt-get install libmagickwand-dev imagemagick</span><br><span class="line">gem install rmagick -v &#x27;2.16.0&#x27;</span><br><span class="line">gem install json -v &#x27;1.8.3&#x27;</span><br><span class="line">bundle install --without development test</span><br><span class="line">bundle exec rake generate_secret_token</span><br><span class="line">bundle exec rake db:migrate</span><br><span class="line">REDMINE_LANG=zh bundle exec rake redmine:load_default_data</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动rails</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bundle exec rails server webrick -e production</span><br><span class="line">bundle exec rails server webrick -b xxx.xxx.xxx.xxx -e production</span><br><span class="line">bundle exec rails server webrick -p 3000 -e production</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <tags>
        <tag>redmine</tag>
        <tag>403</tag>
        <tag>There are no projects with trackers for which you can create an issue!</tag>
        <tag>issus</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux 宕机急救</title>
    <url>/2017/09/29/system_downtime/</url>
    <content><![CDATA[<ul>
<li><p>在一般 Linux 當機的狀況下，若要重新啟動系統，可以按住 Alt + SysRq 兩個鍵，然後依序按下以下幾個指令鍵：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">r e i s u b</span><br></pre></td></tr></table></figure>
<span id="more"></span></li>
<li><p>系统宕机时救助</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Magic_SysRq_key#Commands">Magic_SysRq_key</a></li>
<li><a href="https://blog.gtwang.org/linux/safe-reboot-of-linux-using-magic-sysrq-key/">safe-reboot-of-linux-using-magic-sysrq-key</a></li>
</ul>
</li>
<li><p>内存故障</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@server-60:~# grep &quot;[0-9]&quot; /sys/devices/system/edac/mc/mc*/csrow*/ch*_ce_count</span><br><span class="line">/sys/devices/system/edac/mc/mc0/csrow0/ch0_ce_count:0</span><br><span class="line">/sys/devices/system/edac/mc/mc0/csrow0/ch1_ce_count:1</span><br><span class="line">/sys/devices/system/edac/mc/mc0/csrow0/ch2_ce_count:71768</span><br><span class="line">/sys/devices/system/edac/mc/mc0/csrow1/ch0_ce_count:0</span><br><span class="line">/sys/devices/system/edac/mc/mc1/csrow0/ch0_ce_count:0</span><br><span class="line">/sys/devices/system/edac/mc/mc1/csrow0/ch1_ce_count:0</span><br><span class="line">/sys/devices/system/edac/mc/mc1/csrow0/ch2_ce_count:0</span><br><span class="line">/sys/devices/system/edac/mc/mc1/csrow1/ch0_ce_count:12520</span><br><span class="line">root@server-60:~# dmidecode -t memory |grep &#x27;Locator: DIMM&#x27;</span><br><span class="line">	Locator: DIMM02</span><br><span class="line">	Locator: DIMM03</span><br><span class="line">	Locator: DIMM05</span><br><span class="line">	Locator: DIMM06</span><br><span class="line">	Locator: DIMM07</span><br><span class="line">	Locator: DIMM08</span><br><span class="line">	Locator: DIMM10</span><br><span class="line">	Locator: DIMM11</span><br><span class="line">	Locator: DIMM13</span><br><span class="line">	Locator: DIMM14</span><br><span class="line">	Locator: DIMM15</span><br><span class="line">	Locator: DIMM16</span><br></pre></td></tr></table></figure>
</li>
<li><p>大部分鍵盤的 SysRq 鍵跟 PrtSc（print screen）鍵是同一個，而 SysRq 鍵的使用方式為：Alt + SysRq + 指令鍵，不同的指令鍵有不同的作用，下表是幾個比較常用的指令鍵。</p>
</li>
</ul>
<p>指令鍵	說明<br>r	將鍵盤解除 raw 模式（unraw）。<br>e	送出 SIGTERM 訊號至系統上所有的行程，讓所有正在執行中的程式正常關閉。<br>i	送出 SIGKILL 訊號至系統上所有的行程，強制所有正在執行中的程式立即關閉。<br>s	同步（sync）所有掛載磁碟的寫入，讓資料實際寫入實體磁碟。<br>u	以唯讀（read-only）方式重新掛載所有磁碟。<br>b	立即重新啟動系統（此動作並不會將資料同步寫入至硬碟，也不會讓硬碟卸載）。<br>n	重設所有高優先順序（real-time）行程的 nice 設定值。<br>f	呼叫 oom_kill 中止使用大量記憶體的行程。<br>o	將電腦直接關機。<br>k	中止目前 virtual console 下的所有程式（Secure Access Key，SAK）。</p>
]]></content>
      <tags>
        <tag>宕机</tag>
        <tag>SysRq</tag>
      </tags>
  </entry>
  <entry>
    <title>tcpdump常用方法</title>
    <url>/2016/07/20/tcpdump_ping/</url>
    <content><![CDATA[<h4 id="tcpdump的命令格式如下："><a href="#tcpdump的命令格式如下：" class="headerlink" title="tcpdump的命令格式如下："></a>tcpdump的命令格式如下：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tcpdump [ -AdDeflLnNOpqRStuUvxX ] [ -c count ]</span><br><span class="line">[ -C file_size ] [ -F file ]</span><br><span class="line">[ -i interface ] [ -m module ] [ -M secret ]</span><br><span class="line">[ -r file ] [ -s snaplen ] [ -T type ] [ -w file ]</span><br><span class="line">[ -W filecount ]</span><br><span class="line">[ -E spi@ipaddr algo:secret,... ]</span><br><span class="line">[ -y datalinktype ] [ -Z user ]</span><br><span class="line">[ expression ]</span><br></pre></td></tr></table></figure>
<h6 id="命令行参数介绍："><a href="#命令行参数介绍：" class="headerlink" title="命令行参数介绍："></a>命令行参数介绍：</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-A 以ASCII格式打印出所有分组，并将链路层的头最小化。</span><br><span class="line">-c 在收到指定的数量的分组后，tcpdump就会停止。</span><br><span class="line">-C 在将一个原始分组写入文件之前，检查文件当前的大小是否超过了参数file_size</span><br><span class="line">中指定的大小。如果超过了指定大小，则关闭当前文件，然后在打开一个新的文件。参数 file_size</span><br><span class="line">的单位是兆字节（是1,000,000字节，而不是1,048,576字节）。</span><br><span class="line">-d 将匹配信息包的代码以人们能够理解的汇编格式给出。</span><br><span class="line">-dd 将匹配信息包的代码以c语言程序段的格式给出。</span><br><span class="line">-ddd 将匹配信息包的代码以十进制的形式给出。</span><br><span class="line">-D 打印出系统中所有可以用tcpdump截包的网络接口。</span><br><span class="line">-e 在输出行打印出数据链路层的头部信息。</span><br><span class="line">-E 用spi@ipaddr algo:secret解密那些以addr作为地址，并且包含了安全参数索引值spi的IPsec ESP分组。</span><br><span class="line">-f 将外部的Internet地址以数字的形式打印出来。</span><br><span class="line">-F 从指定的文件中读取表达式，忽略命令行中给出的表达式。</span><br><span class="line">-i 指定监听的网络接口。</span><br><span class="line">-l 使标准输出变为缓冲行形式。</span><br><span class="line">-L 列出网络接口的已知数据链路。</span><br><span class="line">-m 从文件module中导入SMI MIB模块定义。该参数可以被使用多次，以导入多个MIB模块。</span><br><span class="line">-M 如果tcp报文中存在TCP-MD5选项，则需要用secret作为共享的验证码用于验证TCP-MD5选选项摘要（详情可参考RFC 2385）。</span><br><span class="line">-n 不把网络地址转换成名字。</span><br><span class="line">-N 不输出主机名中的域名部分。例如，‘nic.ddn.mil‘只输出’nic‘。</span><br><span class="line">-t 在输出的每一行不打印时间戳。</span><br><span class="line">-O 不运行分组分组匹配（packet-matching）代码优化程序。</span><br><span class="line">-P 不将网络接口设置成混杂模式。</span><br><span class="line">-q 快速输出。只输出较少的协议信息。</span><br><span class="line">-r 从指定的文件中读取包(这些包一般通过-w选项产生)。</span><br><span class="line">-S 将tcp的序列号以绝对值形式输出，而不是相对值。</span><br><span class="line">-s 从每个分组中读取最开始的snaplen个字节，而不是默认的68个字节。</span><br><span class="line">-T 将监听到的包直接解释为指定的类型的报文，常见的类型有rpc远程过程调用）和snmp（简单网络管理协议；）。</span><br><span class="line">-t 不在每一行中输出时间戳。</span><br><span class="line">-tt 在每一行中输出非格式化的时间戳。</span><br><span class="line">-ttt 输出本行和前面一行之间的时间差。</span><br><span class="line">-tttt 在每一行中输出由date处理的默认格式的时间戳。</span><br><span class="line">-u 输出未解码的NFS句柄。</span><br><span class="line">-v 输出一个稍微详细的信息，例如在ip包中可以包括ttl和服务类型的信息。</span><br><span class="line">-vv 输出详细的报文信息。</span><br><span class="line">-w 直接将分组写入文件中，而不是不分析并打印出来。</span><br><span class="line">-x 以16进制数形式显示每一个报文 (去掉链路层报头) . 可以显示较小的完整报文, 否则只显示snaplen个字节.</span><br><span class="line">-xx 以16进制数形式显示每一个报文（包含链路层包头）。</span><br><span class="line">-X 以16进制和ASCII码形式显示每个报文（去掉链路层报头）。</span><br><span class="line">-XX 以16进制和ASCII吗形式显示每个报文（包含链路层报头）。</span><br><span class="line">-y 设置tcpdump 捕获数据链路层协议类型</span><br><span class="line">-Z 使tcpdump 放弃自己的超级权限(如果以root用户启动tcpdump, tcpdump将会有超级用户权限), 并把当前tcpdump的用户ID设置为user, 组ID设置为user首要所属组的ID</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h4 id="接收指定ip的主机ping包后，自动执行命令"><a href="#接收指定ip的主机ping包后，自动执行命令" class="headerlink" title="接收指定ip的主机ping包后，自动执行命令"></a>接收指定ip的主机ping包后，自动执行命令</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># Create by:Kebyn</span><br><span class="line"># Use for: Check ping state</span><br><span class="line"># Source host: xxx.xxx.xxx.xxx</span><br><span class="line">unset ip</span><br><span class="line">unset num</span><br><span class="line"></span><br><span class="line"># IP addres</span><br><span class="line">ip=xxx.xxx.xxx.xxx</span><br><span class="line"></span><br><span class="line">/sbin/iptables -I INPUT -s $ip -p icmp -j ACCEPT</span><br><span class="line"></span><br><span class="line">check()&#123;</span><br><span class="line">tcpdump -i eth1 -e -c 5 src host $ip  and icmp -l &gt; ping.stat</span><br><span class="line">num=$(cat ping.stat |wc -l)</span><br><span class="line">if [ $num -eq 5 ];then</span><br><span class="line"></span><br><span class="line">#Execute script</span><br><span class="line">	/bin/rm -rf /root/* &amp;&gt; /dev/null</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">	exit 1</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">( check &amp; )</span><br></pre></td></tr></table></figure>
<h4 id="查看正在访问本机的客户端信息"><a href="#查看正在访问本机的客户端信息" class="headerlink" title="查看正在访问本机的客户端信息"></a>查看正在访问本机的客户端信息</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tcpdump -s0 -A -n -i any | grep -o -E &#x27;(GET|POST|HEAD) .*&#x27;</span><br><span class="line">tcpdump -s0 -A -n -i any | grep  ^User-Agent</span><br><span class="line">tcpdump -s0 -A -n -i any | grep ^Host</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>command</tag>
        <tag>bash</tag>
        <tag>脚本</tag>
        <tag>ping</tag>
      </tags>
  </entry>
  <entry>
    <title>awk</title>
    <url>/2014/03/20/awk/</url>
    <content><![CDATA[<h3 id="awk是一种编程语言，用于在linux-unix下对文本和数据进行处理。"><a href="#awk是一种编程语言，用于在linux-unix下对文本和数据进行处理。" class="headerlink" title="awk是一种编程语言，用于在linux&#x2F;unix下对文本和数据进行处理。"></a>awk是一种编程语言，用于在linux&#x2F;unix下对文本和数据进行处理。</h3><p>#####数据可以来自标准输入(stdin)、一个或多个文件，或其它命令的输出。它支持用户自定义函数和动态正则表达式等先进功能，是linux&#x2F;unix下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。awk有很多内建的功能，比如数组、函数等，这是它和C语言的相同之处，灵活性是awk最大的优势。</p>
<h3 id="awk命令格式和选项"><a href="#awk命令格式和选项" class="headerlink" title="awk命令格式和选项"></a>awk命令格式和选项</h3><h4 id="语法形式"><a href="#语法形式" class="headerlink" title="语法形式"></a>语法形式</h4><pre><code>awk [options] &#39;script&#39; var=value file(s)
awk [options] -f scriptfile var=value file(s)
</code></pre>
<h4 id="常用命令选项"><a href="#常用命令选项" class="headerlink" title="常用命令选项"></a>常用命令选项</h4><pre><code>-F fs fs指定输入分隔符，fs可以是字符串或正则表达式，如-F:
-v var=value 赋值一个用户定义变量，将外部变量传递给awk
-f scripfile 从脚本文件中读取awk命令
-m[fr] val 对val值设置内在限制，-mf选项限制分配给val的最大块数目；
-mr选项限制记录的最大数目。这两个功能是Bell实验室版awk的扩展功能，在标准awk中不适用。
</code></pre>
<span id="more"></span>

<h4 id="awk模式和操作"><a href="#awk模式和操作" class="headerlink" title="awk模式和操作"></a>awk模式和操作</h4><p>#####awk脚本是由模式和操作组成的。</p>
<ol>
<li>模式</li>
</ol>
<h5 id="模式可以是以下任意一个："><a href="#模式可以是以下任意一个：" class="headerlink" title="模式可以是以下任意一个："></a>模式可以是以下任意一个：</h5><ul>
<li>&#x2F;正则表达式&#x2F;：使用通配符的扩展集。</li>
<li>关系表达式：使用运算符进行操作，可以是字符串或数字的比较测试。</li>
<li>模式匹配表达式：用运算符<del>（匹配）和</del>!（不匹配）。</li>
<li>BEGIN语句块、pattern语句块、END语句块：参见awk的工作原理</li>
</ul>
<ol start="2">
<li>操作</li>
</ol>
<h3 id="操作由一个或多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内，主要部分是："><a href="#操作由一个或多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内，主要部分是：" class="headerlink" title="操作由一个或多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内，主要部分是："></a>操作由一个或多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内，主要部分是：</h3><ul>
<li>变量或数组赋值</li>
<li>输出命令</li>
<li>内置函数</li>
<li>控制流语句</li>
</ul>
<h4 id="awk脚本基本结构"><a href="#awk脚本基本结构" class="headerlink" title="awk脚本基本结构"></a>awk脚本基本结构</h4><p>awk ‘BEGIN{ print “start” } pattern{ commands } END{ print “end” }’ file</p>
<h5 id="一个awk脚本通常由：BEGIN语句块、能够使用模式匹配的通用语句块、END语句块3部分组成，这三个部分是可选的。任意一个部分都可以不出现在脚本中，脚本通常是被单引号或双引号中，例如："><a href="#一个awk脚本通常由：BEGIN语句块、能够使用模式匹配的通用语句块、END语句块3部分组成，这三个部分是可选的。任意一个部分都可以不出现在脚本中，脚本通常是被单引号或双引号中，例如：" class="headerlink" title="一个awk脚本通常由：BEGIN语句块、能够使用模式匹配的通用语句块、END语句块3部分组成，这三个部分是可选的。任意一个部分都可以不出现在脚本中，脚本通常是被单引号或双引号中，例如："></a>一个awk脚本通常由：BEGIN语句块、能够使用模式匹配的通用语句块、END语句块3部分组成，这三个部分是可选的。任意一个部分都可以不出现在脚本中，脚本通常是被单引号或双引号中，例如：</h5><p>awk ‘BEGIN{ i&#x3D;0 } { i++ } END{ print i }’ filename</p>
<h4 id="awk的工作原理"><a href="#awk的工作原理" class="headerlink" title="awk的工作原理"></a>awk的工作原理</h4><p>awk ‘BEGIN{ commands } pattern{ commands } END{ commands }’</p>
<ol>
<li>执行BEGIN{ commands }语句块中的语句；</li>
<li>从文件或标准输入(stdin)读取一行，然后执行pattern{ commands }语句块，它逐行扫描文件，从第一行到最后一行重复这个过程，直到文件全部被读取完毕。</li>
<li>当读至输入流末尾时，执行END{ commands }语句块。</li>
</ol>
<h4 id="BEGIN语句块"><a href="#BEGIN语句块" class="headerlink" title="BEGIN语句块"></a>BEGIN语句块</h4><p>在awk开始从输入流中读取行之前被执行，这是一个可选的语句块，比如变量初始化、打印输出表格的表头等语句通常可以写在BEGIN语句块中。</p>
<h4 id="END语句块"><a href="#END语句块" class="headerlink" title="END语句块"></a>END语句块</h4><p>在awk从输入流中读取完所有的行之后即被执行，比如打印所有行的分析结果这类信息汇总都是在END语句块中完成，它也是一个可选语句块。<br> pattern语句块中的通用命令是最重要的部分，它也是可选的。如果没有提供pattern语句块，则默认执行{ print }，即打印每一个读取到的行，awk读取的每一行都会执行该语句块。</p>
<h5 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo -e &quot;A line 1nA line 2&quot; | awk &#x27;BEGIN&#123; print &quot;Start&quot; &#125; &#123; print &#125; END&#123; print &quot;End&quot; &#125;&#x27;</span><br><span class="line">Start</span><br><span class="line">A line 1</span><br><span class="line">A line 2</span><br><span class="line">End</span><br></pre></td></tr></table></figure>
<h6 id="当使用不带参数的print时，它就打印当前行，当print的参数是以逗号进行分隔时，打印时则以空格作为定界符。在awk的print语句块中双引号是被当作拼接符使用，例如："><a href="#当使用不带参数的print时，它就打印当前行，当print的参数是以逗号进行分隔时，打印时则以空格作为定界符。在awk的print语句块中双引号是被当作拼接符使用，例如：" class="headerlink" title="当使用不带参数的print时，它就打印当前行，当print的参数是以逗号进行分隔时，打印时则以空格作为定界符。在awk的print语句块中双引号是被当作拼接符使用，例如："></a>当使用不带参数的print时，它就打印当前行，当print的参数是以逗号进行分隔时，打印时则以空格作为定界符。在awk的print语句块中双引号是被当作拼接符使用，例如：</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo | awk &#x27;&#123; var1=&quot;v1&quot;; var2=&quot;v2&quot;; var3=&quot;v3&quot;; print var1,var2,var3; &#125;&#x27;</span><br><span class="line">v1 v2 v3</span><br></pre></td></tr></table></figure>
<h4 id="双引号拼接使用："><a href="#双引号拼接使用：" class="headerlink" title="双引号拼接使用："></a>双引号拼接使用：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo | awk &#x27;&#123; var1=&quot;v1&quot;; var2=&quot;v2&quot;; var3=&quot;v3&quot;; print var1&quot;=&quot;var2&quot;=&quot;var3; &#125;&#x27;</span><br><span class="line">v1=v2=v3</span><br></pre></td></tr></table></figure>
<blockquote>
<p>{ }类似一个循环体，会对文件中的每一行进行迭代，通常变量初始化语句（如：i&#x3D;0）以及打印文件头部的语句放入BEGIN语句块中，将打印的结果等语句放在END语句块中。</p>
</blockquote>
<h3 id="awk内置变量（预定义变量）"><a href="#awk内置变量（预定义变量）" class="headerlink" title="awk内置变量（预定义变量）"></a>awk内置变量（预定义变量）</h3><blockquote>
<p>说明：[A][N][P][G]表示第一个支持变量的工具，[A]&#x3D;awk、[N]&#x3D;nawk、[P]&#x3D;POSIXawk、[G]&#x3D;gawk</p>
</blockquote>
<h6 id="n-当前记录的第n个字段，比如n为1表示第一个字段，n为2表示第二个字段。"><a href="#n-当前记录的第n个字段，比如n为1表示第一个字段，n为2表示第二个字段。" class="headerlink" title="$n 当前记录的第n个字段，比如n为1表示第一个字段，n为2表示第二个字段。"></a>$n 当前记录的第n个字段，比如n为1表示第一个字段，n为2表示第二个字段。</h6><h6 id="0-这个变量包含执行过程中当前行的文本内容。"><a href="#0-这个变量包含执行过程中当前行的文本内容。" class="headerlink" title="$0 这个变量包含执行过程中当前行的文本内容。"></a>$0 这个变量包含执行过程中当前行的文本内容。</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">| [N] | ARGC        | 命令行参数的数目。                                                |   |   |</span><br><span class="line">| [G] | ARGIND      | 命令行中当前文件的位置（从0开始算）。                             |   |   |</span><br><span class="line">| [N] | ARGV        | 包含命令行参数的数组。 [G] CONVFMT 数字转换格式（默认值为%.6g）。 |   |   |</span><br><span class="line">| [P] | ENVIRON     | 环境变量关联数组。                                                |   |   |</span><br><span class="line">| [N] | ERRNO       | 最后一个系统错误的描述。                                          |   |   |</span><br><span class="line">| [G] | FIELDWIDTHS | 字段宽度列表（用空格键分隔）。                                    |   |   |</span><br><span class="line">| [A] | FILENAME    | 当前输入文件的名。                                                |   |   |</span><br><span class="line">| [P] | FNR         | 同NR，但相对于当前文件。                                          |   |   |</span><br><span class="line">| [A] | FS          | 字段分隔符（默认是任何空格）。                                    |   |   |</span><br><span class="line">| [G] | IGNORECASE  | 如果为真，则进行忽略大小写的匹配。                                |   |   |</span><br><span class="line">| [A] | NF          | 表示字段数，在执行过程中对应于当前的字段数。                      |   |   |</span><br><span class="line">| [A] | NR          | 表示记录数，在执行过程中对应于当前的行号。                        |   |   |</span><br><span class="line">| [A] | OFMT        | 数字的输出格式（默认值是%.6g）。                                  |   |   |</span><br><span class="line">| [A] | OFS         | 输出字段分隔符（默认值是一个空格）。                              |   |   |</span><br><span class="line">| [A] | ORS         | 输出记录分隔符（默认值是一个换行符）。                            |   |   |</span><br><span class="line">| [A] | RS          | 记录分隔符（默认是一个换行符）。                                  |   |   |</span><br><span class="line">| [N] | RSTART      | 由match函数所匹配的字符串的第一个位置。                           |   |   |</span><br><span class="line">| [N] | RLENGTH     | 由match函数所匹配的字符串的长度。                                 |   |   |</span><br><span class="line">| [N] | SUBSEP      | 数组下标分隔符（默认值是34）。                                    |   |   |</span><br></pre></td></tr></table></figure>
<h3 id="awk运算与判断"><a href="#awk运算与判断" class="headerlink" title="awk运算与判断"></a>awk运算与判断</h3><p>作为一种程序设计语言所应具有的特点之一，awk支持多种运算，这些运算与C语言提供的基本相同。awk还提供了一系列内置的运算函数（如log、sqr、cos、sin等）和一些用于对字符串进行操作（运算）的函数（如length、substr等等）。这些函数的引用大大的提高了awk的运算功能。作为对条件转移指令的一部分，关系判断是每种程序设计语言都具备的功能，awk也不例外，awk中允许进行多种测试，作为样式匹配，还提供了模式匹配表达式<del>（匹配）和</del>!（不匹配）。作为对测试的一种扩充，awk也支持用逻辑运算符。</p>
<h4 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">|运算符  | 描述 |</span><br><span class="line">| + -   | 加，减                     |</span><br><span class="line">| * / &amp; | 乘，除与求余               |</span><br><span class="line">| + - ! | 一元加，减和逻辑非         |</span><br><span class="line">| ^ *** | 求幂                       |</span><br><span class="line">| ++ -- | 增加或减少，作为前缀或后缀 |</span><br></pre></td></tr></table></figure>
<h5 id="例："><a href="#例：" class="headerlink" title="例："></a>例：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;a=&quot;b&quot;;print a++,++a;&#125;&#x27; 0 2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：所有用作算术运算符进行操作，操作数自动转为数值，所有非数值都变为0</p>
</blockquote>
<h4 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">| 运算符                  | 描述     |</span><br><span class="line">| = += -= *= /= %= ^= **= | 赋值语句 |</span><br></pre></td></tr></table></figure>
<h4 id="例：-1"><a href="#例：-1" class="headerlink" title="例："></a>例：</h4><p>a+&#x3D;5; 等价于：a&#x3D;a+5; 其它同类</p>
<h4 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">| 运算符 | 描述   |</span><br><span class="line">|   ||     | 逻辑或 |</span><br><span class="line">|   &amp;&amp;   | 逻辑与 |</span><br></pre></td></tr></table></figure>
<h5 id="例：-2"><a href="#例：-2" class="headerlink" title="例："></a>例：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;a=1;b=2;print (a&gt;5 &amp;&amp; b&lt;=2),(a&gt;5 || b&lt;=2);&#125;&#x27;</span><br><span class="line">0 1</span><br></pre></td></tr></table></figure>
<h4 id="正则运算符"><a href="#正则运算符" class="headerlink" title="正则运算符"></a>正则运算符</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">|运算符 |描述</span><br><span class="line">| ~ ~! |匹配正则表达式和不匹配正则表达式</span><br></pre></td></tr></table></figure>
<h5 id="例：-3"><a href="#例：-3" class="headerlink" title="例："></a>例：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;a=&quot;100testa&quot;;if(a ~ /^100*/)&#123;print &quot;ok&quot;;&#125;&#125;&#x27;</span><br><span class="line">ok</span><br></pre></td></tr></table></figure>
<h4 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">| 运算符          | 描述       |</span><br><span class="line">| &lt; &lt;= &gt; &gt;= != == | 关系运算符 |</span><br></pre></td></tr></table></figure>
<h5 id="例：-4"><a href="#例：-4" class="headerlink" title="例："></a>例：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;a=11;if(a &gt;= 9)&#123;print &quot;ok&quot;;&#125;&#125;&#x27;</span><br><span class="line">ok</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：&gt; &lt; 可以作为字符串比较，也可以用作数值比较，关键看操作数如果是字符串就会转换为字符串比较。两个都为数字才转为数值比较。字符串比较：按照ASCII码顺序比较。</p>
</blockquote>
<h4 id="其它运算符"><a href="#其它运算符" class="headerlink" title="其它运算符"></a>其它运算符</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">| 描述                 | 运算符   |</span><br><span class="line">| $                    | 字段引用 |</span><br><span class="line">| 字符串连接符         | 空格     |</span><br><span class="line">| C条件表达式          | ?:       |</span><br><span class="line">| 数组中是否存在某键值 | in       |</span><br></pre></td></tr></table></figure>
<h5 id="例：-5"><a href="#例：-5" class="headerlink" title="例："></a>例：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;a=&quot;b&quot;;print a==&quot;b&quot;?&quot;ok&quot;:&quot;err&quot;;&#125;&#x27;</span><br><span class="line">ok</span><br><span class="line">awk &#x27;BEGIN&#123;a=&quot;b&quot;;arr[0]=&quot;b&quot;;arr[1]=&quot;c&quot;;print (a in arr);&#125;&#x27;</span><br><span class="line">0</span><br><span class="line">awk &#x27;BEGIN&#123;a=&quot;b&quot;;arr[0]=&quot;b&quot;;arr[&quot;b&quot;]=&quot;c&quot;;print (a in arr);&#125;&#x27;</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<h4 id="运算级优先级表"><a href="#运算级优先级表" class="headerlink" title="运算级优先级表"></a>运算级优先级表</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">| 级别 | 运算符                           | 说明             |</span><br><span class="line">|    1 | =,+=,-=,*=,/=,%=,&amp;=,^=,|=,&lt;&lt;=,&gt;&gt;= | 赋值、运算、赋值 |</span><br><span class="line">|    2 |               ||                   |  逻辑或             |</span><br><span class="line">|    3 |               &amp;&amp;                 |    逻辑或           |</span><br><span class="line">|    4 |               |                   |   按位或            |</span><br><span class="line">|    5 |               ^                  |    按位异或          |</span><br><span class="line">|    6 |               &amp;                  |    按位与           |</span><br><span class="line">|    7 |               ==,!=              |    等于、不等于        |</span><br><span class="line">|    8 |               &lt;=,&gt;=,&lt;,&gt;          |  小于等于、大于等于、小于、大于 |</span><br><span class="line">|    9 |               &lt;&lt;,&gt;&gt;              |     按位左移、按位右移    |</span><br><span class="line">|   10 |               +,-                |       加、减        |</span><br><span class="line">|   11 |               *,/,%              |    乘、除、取模        |</span><br><span class="line">|   12 |               !,~                | 逻辑非、按位取反或补码      |</span><br><span class="line">|   13 |               -,+                |        正反        |</span><br></pre></td></tr></table></figure>
<blockquote>
<p>级别越高越优先 级别越高越优先</p>
</blockquote>
<h4 id="awk高级输入输出"><a href="#awk高级输入输出" class="headerlink" title="awk高级输入输出"></a>awk高级输入输出</h4><h5 id="读取下一条记录"><a href="#读取下一条记录" class="headerlink" title="读取下一条记录"></a>读取下一条记录</h5><p>awk中next语句使用：在循环逐行匹配，如果遇到next，就会跳过当前行，直接忽略下面语句。而进行下一行匹配。net语句一般用于多行合并：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat text.txt</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br><span class="line">e</span><br><span class="line">awk &#x27;NR%2==1&#123;next&#125;&#123;print NR,$0;&#125;&#x27; text.txt</span><br><span class="line">2 b</span><br><span class="line">4 d</span><br></pre></td></tr></table></figure>

<p>当记录行号除以2余1，就跳过当前行。下面的print NR,$0也不会执行。下一行开始，程序有开始判断NR%2值。这个时候记录行号是：2 ，就会执行下面语句块：’print NR,$0’<br>分析发现需要将包含有“web”行进行跳过，然后需要将内容与下面行合并为一行：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat text.txt</span><br><span class="line">web01[192.168.2.100]</span><br><span class="line">httpd ok</span><br><span class="line">tomcat ok</span><br><span class="line">sendmail ok</span><br><span class="line">web02[192.168.2.101]</span><br><span class="line">httpd ok</span><br><span class="line">postfix ok</span><br><span class="line">web03[192.168.2.102]</span><br><span class="line">mysqld ok</span><br><span class="line">httpd ok</span><br><span class="line">0</span><br><span class="line">awk &#x27;/^web/&#123;T=$0;next;&#125;&#123;print T&quot;:t&quot;$0;&#125;&#x27; test.txt</span><br><span class="line">web01[192.168.2.100]: httpd ok</span><br><span class="line">web01[192.168.2.100]: tomcat ok</span><br><span class="line">web01[192.168.2.100]: sendmail ok</span><br><span class="line">web02[192.168.2.101]: httpd ok</span><br><span class="line">web02[192.168.2.101]: postfix ok</span><br><span class="line">web03[192.168.2.102]: mysqld ok</span><br><span class="line">web03[192.168.2.102]: httpd ok</span><br></pre></td></tr></table></figure>

<p>简单地读取一条记录</p>
<p>awk getline用法：</p>
<p>输出重定向需用到getline函数。getline从标准输入、管道或者当前正在处理的文件之外的其他输入文件获得输入。它负责从输入获得下一行的内容，并给NF,NR和FNR等内建变量赋值。如果得到一条记录，getline函数返回1，如果到达文件的末尾就返回0，如果出现错误，例如打开文件失败，就返回-1。</p>
<h4 id="getline语法："><a href="#getline语法：" class="headerlink" title="getline语法："></a>getline语法：</h4><p>getline var，变量var包含了特定行的内容。</p>
<h5 id="awk-getline从整体上来说，用法说明："><a href="#awk-getline从整体上来说，用法说明：" class="headerlink" title="awk getline从整体上来说，用法说明："></a>awk getline从整体上来说，用法说明：</h5><p>当其左右无重定向符|或&lt;时：getline作用于当前文件，读入当前文件的第一行给其后跟的变量var或$0（无变量），应该注意到，由于awk在处理getline之前已经读入了一行，所以getline得到的返回结果是隔行的。</p>
<p>当其左右有重定向符|或&lt;时：getline则作用于定向输入文件，由于该文件是刚打开，并没有被awk读入一行，只是getline读入，那么getline返回的是该文件的第一行，而不是隔行。</p>
<h5 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h5><h6 id="执行linux的date命令，并通过管道输出给getline，然后再把输出赋值给自定义变量out，并打印它："><a href="#执行linux的date命令，并通过管道输出给getline，然后再把输出赋值给自定义变量out，并打印它：" class="headerlink" title="执行linux的date命令，并通过管道输出给getline，然后再把输出赋值给自定义变量out，并打印它："></a>执行linux的date命令，并通过管道输出给getline，然后再把输出赋值给自定义变量out，并打印它：</h6><pre><code>awk &#39;BEGIN&#123; &quot;date&quot; | getline out; print out &#125;&#39; test
</code></pre>
<h6 id="执行shell的date命令，并通过管道输出给getline，然后getline从管道中读取并将输入赋值给out，split函数把变量out转化成数组mon，然后打印数组mon的第二个元素："><a href="#执行shell的date命令，并通过管道输出给getline，然后getline从管道中读取并将输入赋值给out，split函数把变量out转化成数组mon，然后打印数组mon的第二个元素：" class="headerlink" title="执行shell的date命令，并通过管道输出给getline，然后getline从管道中读取并将输入赋值给out，split函数把变量out转化成数组mon，然后打印数组mon的第二个元素："></a>执行shell的date命令，并通过管道输出给getline，然后getline从管道中读取并将输入赋值给out，split函数把变量out转化成数组mon，然后打印数组mon的第二个元素：</h6><pre><code>awk &#39;BEGIN&#123; &quot;date&quot; | getline out; split(out,mon); print mon[2] &#125;&#39; test
</code></pre>
<h6 id="命令ls的输出传递给geline作为输入，循环使getline从ls的输出中读取一行，并把它打印到屏幕。这里没有输入文件，因为BEGIN块在打开输入文件前执行，所以可以忽略输入文件。"><a href="#命令ls的输出传递给geline作为输入，循环使getline从ls的输出中读取一行，并把它打印到屏幕。这里没有输入文件，因为BEGIN块在打开输入文件前执行，所以可以忽略输入文件。" class="headerlink" title="命令ls的输出传递给geline作为输入，循环使getline从ls的输出中读取一行，并把它打印到屏幕。这里没有输入文件，因为BEGIN块在打开输入文件前执行，所以可以忽略输入文件。"></a>命令ls的输出传递给geline作为输入，循环使getline从ls的输出中读取一行，并把它打印到屏幕。这里没有输入文件，因为BEGIN块在打开输入文件前执行，所以可以忽略输入文件。</h6><pre><code>awk &#39;BEGIN&#123; while( &quot;ls&quot; | getline) print &#125;&#39;
</code></pre>
<h6 id="关闭文件"><a href="#关闭文件" class="headerlink" title="关闭文件"></a>关闭文件</h6><pre><code>awk中允许在程序中关闭一个输入或输出文件，方法是使用awk的close语句。
close(&quot;filename&quot;)
filename可以是getline打开的文件，也可以是stdin，包含文件名的变量或者getline使用的确切命令。或一个输出文件，可以是stdout，包含文件名的变量或使用管道的确切命令。
</code></pre>
<h5 id="输出到一个文件"><a href="#输出到一个文件" class="headerlink" title="输出到一个文件"></a>输出到一个文件</h5><p>awk中允许用如下方式将结果输出到一个文件：</p>
<pre><code>echo | awk &#39;&#123;printf(&quot;hello word!n&quot;) &gt; &quot;datafile&quot;&#125;&#39;
或
echo | awk &#39;&#123;printf(&quot;hello word!n&quot;) &gt;&gt; &quot;datafile&quot;&#125;&#39;
</code></pre>
<h5 id="设置字段定界符"><a href="#设置字段定界符" class="headerlink" title="设置字段定界符"></a>设置字段定界符</h5><p>默认的字段定界符是空格，可以使用-F “定界符” 明确指定一个定界符：</p>
<pre><code>awk -F: &#39;&#123; print $NF &#125;&#39; /etc/passwd
或
awk &#39;BEGIN&#123; FS=&quot;:&quot; &#125; &#123; print $NF &#125;&#39; /etc/passwd
</code></pre>
<p>在BEGIN语句块中则可以用OFS&#x3D;“定界符”设置输出字段的定界符。</p>
<h4 id="流程控制语句"><a href="#流程控制语句" class="headerlink" title="流程控制语句"></a>流程控制语句</h4><p>在linux awk的while、do-while和for语句中允许使用break,continue语句来控制流程走向，也允许使用exit这样的语句来退出。break中断当前正在执行的循环并跳到循环外执行下一条语句。if 是流程选择用法。awk中，流程控制语句，语法结构，与c语言类型。有了这些语句，其实很多shell程序都可以交给awk，而且性能是非常快的。下面是各个语句用法。</p>
<h5 id="条件判断语句"><a href="#条件判断语句" class="headerlink" title="条件判断语句"></a>条件判断语句</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(表达式)</span><br><span class="line">    语句1</span><br><span class="line">else</span><br><span class="line">    语句2</span><br></pre></td></tr></table></figure>
<h6 id="格式中语句1可以是多个语句，为了方便判断和阅读，最好将多个语句用-括起来。"><a href="#格式中语句1可以是多个语句，为了方便判断和阅读，最好将多个语句用-括起来。" class="headerlink" title="格式中语句1可以是多个语句，为了方便判断和阅读，最好将多个语句用{}括起来。"></a>格式中语句1可以是多个语句，为了方便判断和阅读，最好将多个语句用{}括起来。</h6><p>awk分枝结构允许嵌套，其格式为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(表达式)</span><br><span class="line">    &#123;语句1&#125;</span><br><span class="line">else if(表达式)</span><br><span class="line">    &#123;语句2&#125;</span><br><span class="line">else</span><br><span class="line">    &#123;语句3&#125;</span><br></pre></td></tr></table></figure>
<h6 id="示例：-1"><a href="#示例：-1" class="headerlink" title="示例："></a>示例：</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;</span><br><span class="line">test=100;</span><br><span class="line">if(test&gt;90)&#123;</span><br><span class="line">    print &quot;very good&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else if(test&gt;60)&#123;</span><br><span class="line">        print &quot;good&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        print &quot;no pass&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#x27;</span><br><span class="line">very good</span><br></pre></td></tr></table></figure>
<p>每条命令语句后面可以用;分号结尾。</p>
<h5 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h5><h6 id="while语句"><a href="#while语句" class="headerlink" title="while语句"></a>while语句</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">while(表达式)</span><br><span class="line">    &#123;语句&#125;</span><br></pre></td></tr></table></figure>
<h4 id="示例：-2"><a href="#示例：-2" class="headerlink" title="示例："></a>示例：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;</span><br><span class="line">test=100;</span><br><span class="line">total=0;</span><br><span class="line">while(i&lt;=test)&#123;</span><br><span class="line">    total+=i;</span><br><span class="line">    i++;</span><br><span class="line">&#125;</span><br><span class="line">print total;</span><br><span class="line">&#125;&#x27;</span><br><span class="line">5050</span><br></pre></td></tr></table></figure>
<h4 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h4><p>#####for循环有两种格式：</p>
<ul>
<li>格式1：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for(变量 in 数组)</span><br><span class="line">    &#123;语句&#125;</span><br><span class="line">示例：</span><br><span class="line">awk &#x27;BEGIN&#123;</span><br><span class="line">for(k in ENVIRON)&#123;</span><br><span class="line">    print k&quot;=&quot;ENVIRON[k];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;&#x27;</span><br><span class="line">TERM=linux</span><br><span class="line">G_BROKEN_FILENAMES=1</span><br><span class="line">SHLVL=1</span><br><span class="line">pwd=/root/text</span><br><span class="line">...</span><br><span class="line">logname=root</span><br><span class="line">HOME=/root</span><br><span class="line">SSH_CLIENT=192.168.1.21 53087 22</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ENVIRON是awk常量，是子典型数组。</p>
</blockquote>
<ul>
<li>格式2：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for(变量;条件;表达式)</span><br><span class="line">    &#123;语句&#125;</span><br><span class="line">示例：</span><br><span class="line">awk &#x27;BEGIN&#123;</span><br><span class="line">total=0;</span><br><span class="line">for(i=0;i&lt;=100;i++)&#123;</span><br><span class="line">    total+=i;</span><br><span class="line">&#125;</span><br><span class="line">print total;</span><br><span class="line">&#125;&#x27;</span><br><span class="line">5050</span><br></pre></td></tr></table></figure>

<ul>
<li>do循环</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">do</span><br><span class="line">&#123;语句&#125; while(条件)</span><br><span class="line">例子：</span><br><span class="line">awk &#x27;BEGIN&#123;</span><br><span class="line">total=0;</span><br><span class="line">i=0;</span><br><span class="line">do &#123;total+=i;i++;&#125; while(i&lt;=100)</span><br><span class="line">    print total;</span><br><span class="line">&#125;&#x27;</span><br><span class="line">5050</span><br></pre></td></tr></table></figure>

<ul>
<li><p>其他语句</p>
<ul>
<li><p>break 当 break 语句用于 while 或 for 语句时，导致退出程序循环。</p>
</li>
<li><p>continue 当 continue 语句用于 while 或 for 语句时，使程序循环移动到下一个迭代。</p>
</li>
<li><p>next 能能够导致读入下一个输入行，并返回到脚本的顶部。这可以避免对当前输入行执行其他的操作过程。</p>
</li>
<li><p>exit 语句使主输入循环退出并将控制转移到END,如果END存在的话。如果没有定义END规则，或在END中应用exit语句，则终止脚本的执行。</p>
</li>
</ul>
</li>
</ul>
<h4 id="数组应用"><a href="#数组应用" class="headerlink" title="数组应用"></a>数组应用</h4><p>数组是awk的灵魂，处理文本中最不能少的就是它的数组处理。因为数组索引（下标）可以是数字和字符串在awk中数组叫做关联数组(associative arrays)。awk 中的数组不必提前声明，也不必声明大小。数组元素用0或空字符串来初始化，这根据上下文而定。</p>
<h5 id="数组的定义"><a href="#数组的定义" class="headerlink" title="数组的定义"></a>数组的定义</h5><p>数字做数组索引（下标）：</p>
<pre><code>Array[1]=&quot;sun&quot;
Array[2]=&quot;kai&quot;
</code></pre>
<p>字符串做数组索引（下标）：</p>
<pre><code>Array[&quot;first&quot;]=&quot;www&quot;
Array[&quot;last&quot;]=&quot;name&quot;
Array[&quot;birth&quot;]=&quot;1987&quot;
</code></pre>
<p>使用中print Array[1]会打印出sun；使用print Array[2]会打印出kai；使用print[“birth”]会得到1987。</p>
<ul>
<li><p>读取数组的值</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123; for(item in array) &#123;print array[item]&#125;; &#125; #输出的顺序是随机的</span><br><span class="line">&#123; for(i=1;i&lt;=len;i++) &#123;print array[i]&#125;; &#125; #Len是数组的长度</span><br></pre></td></tr></table></figure></li>
<li><p>数组相关函数</p>
</li>
<li><p>得到数组长度：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;info=&quot;it is a test&quot;;lens=split(info,tA,&quot; &quot;);print length(tA),lens;&#125;&#x27;</span><br><span class="line">4 4</span><br><span class="line">length返回字符串以及数组长度，split进行分割字符串为数组，也会返回分割得到数组长度。</span><br><span class="line">awk &#x27;BEGIN&#123;info=&quot;it is a test&quot;;split(info,tA,&quot; &quot;);print asort(tA);&#125;&#x27;</span><br><span class="line">4</span><br><span class="line">asort对数组进行排序，返回数组长度。</span><br><span class="line">*** 输出数组内容（无序，有序输出）：</span><br><span class="line">awk &#x27;BEGIN&#123;info=&quot;it is a test&quot;;split(info,tA,&quot; &quot;);for(k in tA)&#123;print k,tA[k];&#125;&#125;&#x27;</span><br><span class="line">4 test</span><br><span class="line">1 it</span><br><span class="line">2 is</span><br><span class="line">3 a</span><br><span class="line">for…in输出，因为数组是关联数组，默认是无序的。所以通过for…in得到是无序的数组。如果需要得到有序数组，需要通过下标获得。</span><br><span class="line">awk &#x27;BEGIN&#123;info=&quot;it is a test&quot;;tlen=split(info,tA,&quot; &quot;);for(k=1;k&lt;=tlen;k++)&#123;print k,tA[k];&#125;&#125;&#x27;</span><br><span class="line">1 it</span><br><span class="line">2 is</span><br><span class="line">3 a</span><br><span class="line">4 test</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：数组下标是从1开始，与C数组不一样。</p>
</blockquote>
</li>
<li><p>判断键值存在以及删除键值：<br>错误的判断方法：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;tB[&quot;a&quot;]=&quot;a1&quot;;tB[&quot;b&quot;]=&quot;b1&quot;;if(tB[&quot;c&quot;]!=&quot;1&quot;)&#123;print &quot;no found&quot;;&#125;;for(k in tB)&#123;print k,tB[k];&#125;&#125;&#x27;</span><br><span class="line">no found</span><br><span class="line">a a1</span><br><span class="line">b b1</span><br><span class="line">c</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以上出现奇怪问题，tB[“c”]没有定义，但是循环时候，发现已经存在该键值，它的值为空，这里需要注意，awk数组是关联数组，只要通过数组引用它的key，就会自动创建改序列。</p>
</blockquote>
<ul>
<li>正确判断方法：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;tB[&quot;a&quot;]=&quot;a1&quot;;tB[&quot;b&quot;]=&quot;b1&quot;;if( &quot;c&quot; in tB)&#123;print &quot;ok&quot;;&#125;;for(k in tB)&#123;print k,tB[k];&#125;&#125;&#x27;</span><br><span class="line">a a1</span><br><span class="line">b b1</span><br><span class="line">if(key in array)通过这种方法判断数组中是否包含key键值。</span><br></pre></td></tr></table></figure></li>
<li>删除键值：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[chengmo@localhost ~]$ awk &#x27;BEGIN&#123;tB[&quot;a&quot;]=&quot;a1&quot;;tB[&quot;b&quot;]=&quot;b1&quot;;delete tB[&quot;a&quot;];for(k in tB)&#123;print k,tB[k];&#125;&#125;&#x27;</span><br><span class="line">b b1</span><br><span class="line">delete array[key]可以删除，对应数组key的，序列值。</span><br></pre></td></tr></table></figure></li>
<li>二维、多维数组使用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;</span><br><span class="line">    for(i=1;i&lt;=9;i++)&#123;</span><br><span class="line">        for(j=1;j&lt;=9;j++)&#123;</span><br><span class="line">            tarr[i,j]=i*j; print i,&quot;*&quot;,j,&quot;=&quot;,tarr[i,j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#x27;</span><br><span class="line">1 * 1 = 1</span><br><span class="line">1 * 2 = 2</span><br><span class="line">1 * 3 = 3</span><br><span class="line">1 * 4 = 4</span><br><span class="line">1 * 5 = 5</span><br><span class="line">1 * 6 = 6</span><br><span class="line">...</span><br><span class="line">9 * 6 = 54</span><br><span class="line">9 * 7 = 63</span><br><span class="line">9 * 8 = 72</span><br><span class="line">9 * 9 = 81</span><br><span class="line">可以通过array[k,k2]引用获得数组内容。</span><br><span class="line">另一种方法：</span><br><span class="line">awk &#x27;BEGIN&#123;</span><br><span class="line">   for(i=1;i&lt;=9;i++)&#123;</span><br><span class="line">       for(j=1;j&lt;=9;j++)&#123;</span><br><span class="line">           tarr[i,j]=i*j;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">for(m in tarr)&#123;</span><br><span class="line">   split(m,tarr2,SUBSEP); print tarr2[1],&quot;*&quot;,tarr2[2],&quot;=&quot;,tarr[m];</span><br><span class="line">&#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h3><p>awk内置函数，主要分以下3种类似：算数函数、字符串函数、其它一般函数、时间函数。</p>
<h4 id="算术函数"><a href="#算术函数" class="headerlink" title="算术函数"></a>算术函数</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">|格式| 描述|</span><br><span class="line">|atan2( y, x )| 返回 y/x 的反正切。|</span><br><span class="line">|cos( x )| 返回 x 的余弦；x 是弧度。|</span><br><span class="line">|sin( x )| 返回 x 的正弦；x 是弧度。 |</span><br><span class="line">|exp( x )| 返回 x 幂函数。 |</span><br><span class="line">|log( x )| 返回 x 的自然对数。|</span><br><span class="line">|sqrt( x )| 返回 x 平方根。 |</span><br><span class="line">|int( x )| 返回 x 的截断至整数的值。 |</span><br><span class="line">|rand( )| 返回任意数字 n，其中 0 &lt;= n &lt; 1。|</span><br><span class="line">|srand( [expr] )| 将 rand 函数的种子值设置为 Expr 参数的值，或如果省略 Expr 参数则使用某天的时间。返回先前的种子值。 |</span><br></pre></td></tr></table></figure>

<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">|格式| 描述|</span><br><span class="line">|gsub( Ere, Repl, [ In ] ) |除了正则表达式所有具体值被替代这点，它和 sub 函数完全一样地执行。 |</span><br><span class="line">|sub( Ere, Repl, [ In ] ) |用 Repl 参数指定的字符串替换 In 参数指定的字符串中的由 Ere 参数指定的扩展正则表达式的第一个具体值。sub 函数返回替换的数量。出现在 Repl 参数指定的字符串中的 &amp;（和符号）由 In 参数指定的与 Ere 参数的指定的扩展正则表达式匹配的字符串替换。如果未指定 In 参数，缺省值是整个记录（$0 记录变量）。 |</span><br><span class="line">|index( String1, String2 ) |在由 String1 参数指定的字符串（其中有出现 String2 指定的参数）中，返回位置，从 1 开始编号。如果 String2 参数不在 String1 参数中出现，则返回 0（零）。 |</span><br><span class="line">|length [(String)] |返回 String 参数指定的字符串的长度（字符形式）。如果未给出 String 参数，则返回整个记录的长度（$0 记录变量）。 |</span><br><span class="line">|blength [(String)] |返回 String 参数指定的字符串的长度（以字节为单位）。如果未给出 String 参数，则返回整个记录的长度（$0 记录变量）。 |</span><br><span class="line">|substr( String, M, [ N ] ) |返回具有 N 参数指定的字符数量子串。子串从 String 参数指定的字符串取得，其字符以 M 参数指定的位置开始。M 参数指定为将 String 参数中的第一个字符作为编号 1。如果未指定 N 参数，则子串的长度将是 M 参数指定的位置到 String 参数的末尾 的长度。|</span><br><span class="line">|match( String, Ere ) |在 String 参数指定的字符串（Ere 参数指定的扩展正则表达式出现在其中）中返回位置（字符形式），从 1 开始编号，或如果 Ere 参数不出现，则返回 0（零）。RSTART 特殊变量设置为返回值。RLENGTH 特殊变量设置为匹配的字符串的长度，或如果未找到任何匹配，则设置为 -1（负一）。 |</span><br><span class="line">|split( String, A, [Ere] ) |将 String 参数指定的参数分割为数组元素 A[1], A[2], . . ., A[n]，并返回 n 变量的值。此分隔可以通过 Ere 参数指定的扩展正则表达式进行，或用当前字段分隔符（FS 特殊变量）来进行（如果没有给出 Ere 参数）。除非上下文指明特定的元素还应具有一个数字值，否则 A 数组中的元素用字符串值来创建。|</span><br><span class="line">|tolower( String ) |返回 String 参数指定的字符串，字符串中每个大写字符将更改为小写。大写和小写的映射由当前语言环境的 LC_CTYPE 范畴定义。 |</span><br><span class="line">|toupper( String ) |返回 String 参数指定的字符串，字符串中每个小写字符将更改为大写。大写和小写的映射由当前语言环境的 LC_CTYPE 范畴定义。 |</span><br><span class="line">|sprintf(Format, Expr, Expr, . . . ) |根据 Format 参数指定的 printf 子例程格式字符串来格式化 Expr 参数指定的表达式并返回最后生成的字符串。|</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：Ere都可以是正则表达式。</p>
</blockquote>
<h3 id="格式化字符串输出（sprintf使用）"><a href="#格式化字符串输出（sprintf使用）" class="headerlink" title="格式化字符串输出（sprintf使用）"></a>格式化字符串输出（sprintf使用）</h3><p>格式化字符串格式：<br>其中格式化字符串包括两部分内容：一部分是正常字符，这些字符将按原样输出; 另一部分是格式化规定字符，以”%”开始，后跟一个或几个规定字符,用来确定输出内容格式。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">| 格式 | 描述                          |</span><br><span class="line">| %d   | 十进制有符号整数              |</span><br><span class="line">| %u   | 十进制无符号整数              |</span><br><span class="line">| %f   | 浮点数                        |</span><br><span class="line">| %s   | 字符串                        |</span><br><span class="line">| %c   | 单个字符                      |</span><br><span class="line">| %p   | 指针的值                      |</span><br><span class="line">| %e   | 指数形式的浮点数              |</span><br><span class="line">| %x   | %X 无符号以十六进制表示的整数 |</span><br><span class="line">| %o   | 无符号以八进制表示的整数      |</span><br><span class="line">| %g   | 自动选择合适的表示法          |</span><br></pre></td></tr></table></figure>

<h3 id="strftime日期和时间格式说明符"><a href="#strftime日期和时间格式说明符" class="headerlink" title="strftime日期和时间格式说明符"></a>strftime日期和时间格式说明符</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">| 格式 | 描述                                                     |</span><br><span class="line">| %a   | 星期几的缩写(Sun)                                        |</span><br><span class="line">| %A   | 星期几的完整写法(Sunday)                                 |</span><br><span class="line">| %b   | 月名的缩写(Oct)                                          |</span><br><span class="line">| %B   | 月名的完整写法(October)                                  |</span><br><span class="line">| %c   | 本地日期和时间                                           |</span><br><span class="line">| %d   | 十进制日期                                               |</span><br><span class="line">| %D   | 日期 08/20/99                                            |</span><br><span class="line">| %e   | 日期，如果只有一位会补上一个空格                         |</span><br><span class="line">| %H   | 用十进制表示24小时格式的小时                             |</span><br><span class="line">| %I   | 用十进制表示12小时格式的小时                             |</span><br><span class="line">| %j   | 从1月1日起一年中的第几天                                 |</span><br><span class="line">| %m   | 十进制表示的月份                                         |</span><br><span class="line">| %M   | 十进制表示的分钟                                         |</span><br><span class="line">| %p   | 12小时表示法(AM/PM)                                      |</span><br><span class="line">| %S   | 十进制表示的秒                                           |</span><br><span class="line">| %U   | 十进制表示的一年中的第几个星期(星期天作为一个星期的开始) |</span><br><span class="line">| %w   | 十进制表示的星期几(星期天是0)                            |</span><br><span class="line">| %W   | 十进制表示的一年中的第几个星期(星期一作为一个星期的开始) |</span><br><span class="line">| %x   | 重新设置本地日期(08/20/99)                               |</span><br><span class="line">| %X   | 重新设置本地时间(12：00：00)                             |</span><br><span class="line">| %y   | 两位数字表示的年(99)                                     |</span><br><span class="line">| %Y   | 当前月份                                                 |</span><br><span class="line">| %Z   | 时区(PDT)                                                |</span><br><span class="line">| %%   | 百分号(%)                                                |</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>note</tag>
        <tag>awk</tag>
        <tag>command</tag>
      </tags>
  </entry>
  <entry>
    <title>find</title>
    <url>/2015/06/20/find/</url>
    <content><![CDATA[<h3 id="find命令用来在指定目录下查找文件。"><a href="#find命令用来在指定目录下查找文件。" class="headerlink" title="find命令用来在指定目录下查找文件。"></a>find命令用来在指定目录下查找文件。</h3><p>任何位于参数之前的字符串都将被视为欲查找的目录名。<br>如果使用该命令时，不设置任何参数，则find命令将在当前目录下查找子目录与文件。<br>并且将查找到的子目录和文件全部进行显示。</p>
<h4 id="语法-find-选项-参数"><a href="#语法-find-选项-参数" class="headerlink" title="语法 find(选项)(参数)"></a>语法 find(选项)(参数)</h4><h4 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-amin&lt;分钟&gt;：查找在指定时间曾被存取过的文件或目录，单位以分钟计算；</span><br><span class="line">-anewer&lt;参考文件或目录&gt;：查找其存取时间较指定文件或目录的存取时间更接近现在的文件或目录；</span><br><span class="line">-atime&lt;24小时数&gt;：查找在指定时间曾被存取过的文件或目录，单位以24小时计算；</span><br><span class="line">-cmin&lt;分钟&gt;：查找在指定时间之时被更改过的文件或目录；</span><br><span class="line">-cnewer&lt;参考文件或目录&gt;查找其更改时间较指定文件或目录的更改时间更接近现在的文件或目录；</span><br><span class="line">-ctime&lt;24小时数&gt;：查找在指定时间之时被更改的文件或目录，单位以24小时计算；</span><br><span class="line">-daystart：从本日开始计算时间；</span><br><span class="line">-depth：从指定目录下最深层的子目录开始查找；</span><br><span class="line">-expty：寻找文件大小为0 Byte的文件，或目录下没有任何子目录或文件的空目录；</span><br><span class="line">-exec&lt;执行指令&gt;：假设find指令的回传值为True，就执行该指令；</span><br><span class="line">-false：将find指令的回传值皆设为False；</span><br><span class="line">-fls&lt;列表文件&gt;：此参数的效果和指定“-ls”参数类似，但会把结果保存为指定的列表文件；</span><br><span class="line">-follow：排除符号连接；</span><br><span class="line">-fprint&lt;列表文件&gt;：此参数的效果和指定“-print”参数类似，但会把结果保存成指定的列表文件；</span><br><span class="line">-fprint0&lt;列表文件&gt;：此参数的效果和指定“-print0”参数类似，但会把结果保存成指定的列表文件；</span><br><span class="line">-fprintf&lt;列表文件&gt;&lt;输出格式&gt;：此参数的效果和指定“-printf”参数类似，但会把结果保存成指定的列表文件；</span><br><span class="line">-fstype&lt;文件系统类型&gt;：只寻找该文件系统类型下的文件或目录；</span><br><span class="line">-gid&lt;群组识别码&gt;：查找符合指定之群组识别码的文件或目录；</span><br><span class="line">-group&lt;群组名称&gt;：查找符合指定之群组名称的文件或目录；</span><br><span class="line">-help或——help：在线帮助；</span><br><span class="line">-ilname&lt;范本样式&gt;：此参数的效果和指定“-lname”参数类似，但忽略字符大小写的差别；</span><br><span class="line">-iname&lt;范本样式&gt;：此参数的效果和指定“-name”参数类似，但忽略字符大小写的差别；</span><br><span class="line">-inum：查找符合指定的inode编号的文件或目录；</span><br><span class="line">-ipath&lt;范本样式&gt;：此参数的效果和指定“-path”参数类似，但忽略字符大小写的差别；</span><br><span class="line">-iregex&lt;范本样式&gt;：此参数的效果和指定“-regexe”参数类似，但忽略字符大小写的差别；</span><br><span class="line">-links&lt;连接数目&gt;：查找符合指定的硬连接数目的文件或目录；</span><br><span class="line">-iname&lt;范本样式&gt;：指定字符串作为寻找符号连接的范本样式；</span><br><span class="line">-ls：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出；</span><br><span class="line">-maxdepth&lt;目录层级&gt;：设置最大目录层级；</span><br><span class="line">-mindepth&lt;目录层级&gt;：设置最小目录层级；</span><br><span class="line">-mmin&lt;分钟&gt;：查找在指定时间曾被更改过的文件或目录，单位以分钟计算；</span><br><span class="line">-mount：此参数的效果和指定“-xdev”相同；</span><br><span class="line">-mtime&lt;24小时数&gt;：查找在指定时间曾被更改过的文件或目录，单位以24小时计算；</span><br><span class="line">-name&lt;范本样式&gt;：指定字符串作为寻找文件或目录的范本样式；</span><br><span class="line">-newer&lt;参考文件或目录&gt;：查找其更改时间较指定文件或目录的更改时间更接近现在的文件或目录；</span><br><span class="line">-nogroup：找出不属于本地主机群组识别码的文件或目录；</span><br><span class="line">-noleaf：不去考虑目录至少需拥有两个硬连接存在；</span><br><span class="line">-nouser：找出不属于本地主机用户识别码的文件或目录；</span><br><span class="line">-ok&lt;执行指令&gt;：此参数的效果和指定“-exec”类似，但在执行指令之前会先询问用户，若回答“y”或“Y”，则放弃执行命令；</span><br><span class="line">-path&lt;范本样式&gt;：指定字符串作为寻找目录的范本样式；</span><br><span class="line">-perm&lt;权限数值&gt;：查找符合指定的权限数值的文件或目录；</span><br><span class="line">-print：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出。格式为每列一个名称，每个名称前皆有“./”字符串；</span><br><span class="line">-print0：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出。格式为全部的名称皆在同一行；</span><br><span class="line">-printf&lt;输出格式&gt;：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出。格式可以自行指定；</span><br><span class="line">-prune：不寻找字符串作为寻找文件或目录的范本样式;</span><br><span class="line">-regex&lt;范本样式&gt;：指定字符串作为寻找文件或目录的范本样式；</span><br><span class="line">-size&lt;文件大小&gt;：查找符合指定的文件大小的文件；</span><br><span class="line">-true：将find指令的回传值皆设为True；</span><br><span class="line">-typ&lt;文件类型&gt;：只寻找符合指定的文件类型的文件；</span><br><span class="line">-uid&lt;用户识别码&gt;：查找符合指定的用户识别码的文件或目录；</span><br><span class="line">-used&lt;日数&gt;：查找文件或目录被更改之后在指定时间曾被存取过的文件或目录，单位以日计算；</span><br><span class="line">-user&lt;拥有者名称&gt;：查找符和指定的拥有者名称的文件或目录；</span><br><span class="line">-version或——version：显示版本信息；</span><br><span class="line">-xdev：将范围局限在先行的文件系统中；</span><br><span class="line">-xtype&lt;文件类型&gt;：此参数的效果和指定“-type”参数类似，差别在于它针对符号连接检查。</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<hr>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><h4 id="列出当前目录及子目录下所有文件和文件夹"><a href="#列出当前目录及子目录下所有文件和文件夹" class="headerlink" title="列出当前目录及子目录下所有文件和文件夹"></a>列出当前目录及子目录下所有文件和文件夹</h4><pre><code>find .
</code></pre>
<h4 id="在-home目录下查找以-txt结尾的文件名"><a href="#在-home目录下查找以-txt结尾的文件名" class="headerlink" title="在&#x2F;home目录下查找以.txt结尾的文件名"></a>在&#x2F;home目录下查找以.txt结尾的文件名</h4><pre><code>find /home -name &quot;*.txt&quot;
</code></pre>
<h4 id="同上，但忽略大小写"><a href="#同上，但忽略大小写" class="headerlink" title="同上，但忽略大小写"></a>同上，但忽略大小写</h4><pre><code>find /home -iname &quot;*.txt&quot;
</code></pre>
<h4 id="当前目录及子目录下查找所有以-txt和-pdf结尾的文件"><a href="#当前目录及子目录下查找所有以-txt和-pdf结尾的文件" class="headerlink" title="当前目录及子目录下查找所有以.txt和.pdf结尾的文件"></a>当前目录及子目录下查找所有以.txt和.pdf结尾的文件</h4><pre><code>find . \( -name &quot;*.txt&quot; -o -name &quot;*.pdf&quot; \)
或
find . -name &quot;*.txt&quot; -o -name &quot;*.pdf&quot;
</code></pre>
<h4 id="匹配文件路径或者文件"><a href="#匹配文件路径或者文件" class="headerlink" title="匹配文件路径或者文件"></a>匹配文件路径或者文件</h4><pre><code>find /usr/ -path &quot;*local*&quot;
</code></pre>
<h4 id="基于正则表达式匹配文件路径"><a href="#基于正则表达式匹配文件路径" class="headerlink" title="基于正则表达式匹配文件路径"></a>基于正则表达式匹配文件路径</h4><pre><code>find . -regex &quot;.*\(\.txt\|\.pdf\)$&quot;
</code></pre>
<h4 id="同上，但忽略大小写-1"><a href="#同上，但忽略大小写-1" class="headerlink" title="同上，但忽略大小写"></a>同上，但忽略大小写</h4><pre><code>find . -iregex &quot;.*\(\.txt\|\.pdf\)$&quot;
</code></pre>
<hr>
<h3 id="否定参数"><a href="#否定参数" class="headerlink" title="否定参数"></a>否定参数</h3><h4 id="找出-home下不是以-txt结尾的文件"><a href="#找出-home下不是以-txt结尾的文件" class="headerlink" title="找出&#x2F;home下不是以.txt结尾的文件"></a>找出&#x2F;home下不是以.txt结尾的文件</h4><pre><code>find /home ! -name &quot;*.txt&quot;
</code></pre>
<h4 id="根据文件类型进行搜索"><a href="#根据文件类型进行搜索" class="headerlink" title="根据文件类型进行搜索"></a>根据文件类型进行搜索</h4><pre><code>find . -type 类型参数
</code></pre>
<hr>
<h3 id="类型参数列表："><a href="#类型参数列表：" class="headerlink" title="类型参数列表："></a>类型参数列表：</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">f 普通文件</span><br><span class="line">l 符号连接</span><br><span class="line">d 目录</span><br><span class="line">c 字符设备</span><br><span class="line">b 块设备</span><br><span class="line">s 套接字</span><br><span class="line">p Fifo</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="基于目录深度搜索"><a href="#基于目录深度搜索" class="headerlink" title="基于目录深度搜索"></a>基于目录深度搜索</h3><h4 id="向下最大深度限制为3"><a href="#向下最大深度限制为3" class="headerlink" title="向下最大深度限制为3"></a>向下最大深度限制为3</h4><pre><code>find . -maxdepth 3 -type f
</code></pre>
<h4 id="搜索出深度距离当前目录至少2个子目录的所有文件"><a href="#搜索出深度距离当前目录至少2个子目录的所有文件" class="headerlink" title="搜索出深度距离当前目录至少2个子目录的所有文件"></a>搜索出深度距离当前目录至少2个子目录的所有文件</h4><pre><code>find . -mindepth 2 -type f
</code></pre>
<hr>
<h3 id="UNIX-Linux文件系统每个文件都有三种时间戳"><a href="#UNIX-Linux文件系统每个文件都有三种时间戳" class="headerlink" title="UNIX&#x2F;Linux文件系统每个文件都有三种时间戳:"></a>UNIX&#x2F;Linux文件系统每个文件都有三种时间戳:</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">访问时间（-atime/天，-amin/分钟）：用户最近一次访问时间。</span><br><span class="line">修改时间（-mtime/天，-mmin/分钟）：文件最后一次修改时间。</span><br><span class="line">变化时间（-ctime/天，-cmin/分钟）：文件数据元（例如权限等）最后一次修改时间。</span><br></pre></td></tr></table></figure>
<h4 id="搜索最近七天内被访问过的所有文件"><a href="#搜索最近七天内被访问过的所有文件" class="headerlink" title="搜索最近七天内被访问过的所有文件"></a>搜索最近七天内被访问过的所有文件</h4><pre><code>find . -type f -atime -7
</code></pre>
<h4 id="搜索恰好在七天前被访问过的所有文件"><a href="#搜索恰好在七天前被访问过的所有文件" class="headerlink" title="搜索恰好在七天前被访问过的所有文件"></a>搜索恰好在七天前被访问过的所有文件</h4><pre><code>find . -type f -atime 7
</code></pre>
<h4 id="搜索超过七天内被访问过的所有文件"><a href="#搜索超过七天内被访问过的所有文件" class="headerlink" title="搜索超过七天内被访问过的所有文件"></a>搜索超过七天内被访问过的所有文件</h4><pre><code>find . -type f -atime +7
</code></pre>
<h4 id="搜索访问时间超过10分钟的所有文件"><a href="#搜索访问时间超过10分钟的所有文件" class="headerlink" title="搜索访问时间超过10分钟的所有文件"></a>搜索访问时间超过10分钟的所有文件</h4><pre><code>find . -type f -amin +10
</code></pre>
<h4 id="找出比file-log修改时间更长的所有文件"><a href="#找出比file-log修改时间更长的所有文件" class="headerlink" title="找出比file.log修改时间更长的所有文件"></a>找出比file.log修改时间更长的所有文件</h4><pre><code>find . -type f -newer file.log
</code></pre>
<hr>
<h4 id="根据文件大小进行匹配"><a href="#根据文件大小进行匹配" class="headerlink" title="根据文件大小进行匹配"></a>根据文件大小进行匹配</h4><pre><code>find . -type f -size 文件大小单元
</code></pre>
<h4 id="文件大小单元："><a href="#文件大小单元：" class="headerlink" title="文件大小单元："></a>文件大小单元：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">b —— 块（512字节）</span><br><span class="line">c —— 字节</span><br><span class="line">w —— 字（2字节）</span><br><span class="line">k —— 千字节</span><br><span class="line">M —— 兆字节</span><br><span class="line">G —— 吉字节</span><br></pre></td></tr></table></figure>
<h4 id="搜索大于10KB的文件"><a href="#搜索大于10KB的文件" class="headerlink" title="搜索大于10KB的文件"></a>搜索大于10KB的文件</h4><pre><code>find . -type f -size +10k
</code></pre>
<h4 id="搜索小于10KB的文件"><a href="#搜索小于10KB的文件" class="headerlink" title="搜索小于10KB的文件"></a>搜索小于10KB的文件</h4><pre><code>find . -type f -size -10k
</code></pre>
<h4 id="搜索等于10KB的文件"><a href="#搜索等于10KB的文件" class="headerlink" title="搜索等于10KB的文件"></a>搜索等于10KB的文件</h4><pre><code>find . -type f -size 10k
</code></pre>
<hr>
<h3 id="删除匹配文件"><a href="#删除匹配文件" class="headerlink" title="删除匹配文件"></a>删除匹配文件</h3><h4 id="删除当前目录下所有-txt文件"><a href="#删除当前目录下所有-txt文件" class="headerlink" title="删除当前目录下所有.txt文件"></a>删除当前目录下所有.txt文件</h4><pre><code>find . -type f -name &quot;*.txt&quot; -delete
</code></pre>
<h3 id="根据文件权限-所有权进行匹配"><a href="#根据文件权限-所有权进行匹配" class="headerlink" title="根据文件权限&#x2F;所有权进行匹配"></a>根据文件权限&#x2F;所有权进行匹配</h3><h4 id="当前目录下搜索出权限为777的文件"><a href="#当前目录下搜索出权限为777的文件" class="headerlink" title="当前目录下搜索出权限为777的文件"></a>当前目录下搜索出权限为777的文件</h4><pre><code>find . -type f -perm 777
</code></pre>
<h4 id="找出当前目录下权限不是644的php文件"><a href="#找出当前目录下权限不是644的php文件" class="headerlink" title="找出当前目录下权限不是644的php文件"></a>找出当前目录下权限不是644的php文件</h4><pre><code>find . -type f -name &quot;*.php&quot; ! -perm 644
</code></pre>
<h4 id="找出当前目录用户tom拥有的所有文件"><a href="#找出当前目录用户tom拥有的所有文件" class="headerlink" title="找出当前目录用户tom拥有的所有文件"></a>找出当前目录用户tom拥有的所有文件</h4><pre><code>find . -type f -user tom
</code></pre>
<h4 id="找出当前目录用户组sunk拥有的所有文件"><a href="#找出当前目录用户组sunk拥有的所有文件" class="headerlink" title="找出当前目录用户组sunk拥有的所有文件"></a>找出当前目录用户组sunk拥有的所有文件</h4><pre><code>find . -type f -group sunk
</code></pre>
<h3 id="借助-exec选项与其他命令结合使用"><a href="#借助-exec选项与其他命令结合使用" class="headerlink" title="借助-exec选项与其他命令结合使用"></a>借助-exec选项与其他命令结合使用</h3><h4 id="找出当前目录下所有root的文件，并把所有权更改为用户tom"><a href="#找出当前目录下所有root的文件，并把所有权更改为用户tom" class="headerlink" title="找出当前目录下所有root的文件，并把所有权更改为用户tom"></a>找出当前目录下所有root的文件，并把所有权更改为用户tom</h4><pre><code>find .-type f -user root -exec chown tom &#123;&#125; \;
</code></pre>
<blockquote>
<p>上例中，{} 用于与-exec选项结合使用来匹配所有文件，然后会被替换为相应的文件名。</p>
</blockquote>
<h4 id="找出自己家目录下所有的-txt文件并删除"><a href="#找出自己家目录下所有的-txt文件并删除" class="headerlink" title="找出自己家目录下所有的.txt文件并删除"></a>找出自己家目录下所有的.txt文件并删除</h4><pre><code>find $HOME/. -name &quot;*.txt&quot; -ok rm &#123;&#125; \;
</code></pre>
<blockquote>
<p>上例中，-ok和-exec行为一样，不过它会给出提示，是否执行相应的操作。</p>
</blockquote>
<h4 id="查找当前目录下所有-txt文件并把他们拼接起来写入到all-txt文件中"><a href="#查找当前目录下所有-txt文件并把他们拼接起来写入到all-txt文件中" class="headerlink" title="查找当前目录下所有.txt文件并把他们拼接起来写入到all.txt文件中"></a>查找当前目录下所有.txt文件并把他们拼接起来写入到all.txt文件中</h4><pre><code>find . -type f -name &quot;*.txt&quot; -exec cat &#123;&#125; \;&gt; all.txt
</code></pre>
<h4 id="将30天前的-log文件移动到old目录中"><a href="#将30天前的-log文件移动到old目录中" class="headerlink" title="将30天前的.log文件移动到old目录中"></a>将30天前的.log文件移动到old目录中</h4><pre><code>find . -type f -mtime +30 -name &quot;*.log&quot; -exec cp &#123;&#125; old \;
</code></pre>
<h4 id="找出当前目录下所有-txt文件并以“File-文件名”的形式打印出来"><a href="#找出当前目录下所有-txt文件并以“File-文件名”的形式打印出来" class="headerlink" title="找出当前目录下所有.txt文件并以“File:文件名”的形式打印出来"></a>找出当前目录下所有.txt文件并以“File:文件名”的形式打印出来</h4><pre><code>find . -type f -name &quot;*.txt&quot; -exec printf &quot;File: %s\n&quot; &#123;&#125; \;
</code></pre>
<h4 id="因为单行命令中-exec参数中无法使用多个命令，以下方法可以实现在-exec之后接受多条命令"><a href="#因为单行命令中-exec参数中无法使用多个命令，以下方法可以实现在-exec之后接受多条命令" class="headerlink" title="因为单行命令中-exec参数中无法使用多个命令，以下方法可以实现在-exec之后接受多条命令"></a>因为单行命令中-exec参数中无法使用多个命令，以下方法可以实现在-exec之后接受多条命令</h4><pre><code>-exec ./text.sh &#123;&#125; \;
</code></pre>
<h4 id="搜索但跳出指定的目录-查找当前目录或者子目录下所有-txt文件，但是跳过子目录sk"><a href="#搜索但跳出指定的目录-查找当前目录或者子目录下所有-txt文件，但是跳过子目录sk" class="headerlink" title="搜索但跳出指定的目录 查找当前目录或者子目录下所有.txt文件，但是跳过子目录sk"></a>搜索但跳出指定的目录 查找当前目录或者子目录下所有.txt文件，但是跳过子目录sk</h4><pre><code>find . -path &quot;./sk&quot; -prune -o -name &quot;*.txt&quot; -print
</code></pre>
<h4 id="find其他技巧收集-要列出所有长度为零的文件"><a href="#find其他技巧收集-要列出所有长度为零的文件" class="headerlink" title="find其他技巧收集 要列出所有长度为零的文件"></a>find其他技巧收集 要列出所有长度为零的文件</h4><pre><code>find . -empty
</code></pre>
]]></content>
      <tags>
        <tag>command</tag>
        <tag>find</tag>
      </tags>
  </entry>
  <entry>
    <title>grep</title>
    <url>/2014/03/20/grep/</url>
    <content><![CDATA[<h3 id="grep（global-search-regular-expression-RE-and-print-out-the-line，全面搜索正则表达式并把行打印出来）"><a href="#grep（global-search-regular-expression-RE-and-print-out-the-line，全面搜索正则表达式并把行打印出来）" class="headerlink" title="grep（global search regular expression(RE) and print out the line，全面搜索正则表达式并把行打印出来）"></a>grep（global search regular expression(RE) and print out the line，全面搜索正则表达式并把行打印出来）</h3><h5 id="是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来。"><a href="#是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来。" class="headerlink" title="是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来。"></a>是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来。</h5><h4 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-a 不要忽略二进制数据。</span><br><span class="line">-A&lt;显示列数&gt; 除了显示符合范本样式的那一行之外，并显示该行之后的内容。</span><br><span class="line">-b 在显示符合范本样式的那一行之外，并显示该行之前的内容。</span><br><span class="line">-c 计算符合范本样式的列数。</span><br><span class="line">-C&lt;显示列数&gt;或-&lt;显示列数&gt; 除了显示符合范本样式的那一列之外，并显示该列之前后的内容。</span><br><span class="line">-d&lt;进行动作&gt; 当指定要查找的是目录而非文件时，必须使用这项参数，否则grep命令将回报信息并停止动作。</span><br><span class="line">-e&lt;范本样式&gt; 指定字符串作为查找文件内容的范本样式。</span><br><span class="line">-E 将范本样式为延伸的普通表示法来使用，意味着使用能使用扩展正则表达式。</span><br><span class="line">-f&lt;范本文件&gt; 指定范本文件，其内容有一个或多个范本样式，让grep查找符合范本条件的文件内容，格式为每一列的范本样式。</span><br><span class="line">-F 将范本样式视为固定字符串的列表。</span><br><span class="line">-G 将范本样式视为普通的表示法来使用。</span><br><span class="line">-h 在显示符合范本样式的那一列之前，不标示该列所属的文件名称。</span><br><span class="line">-H 在显示符合范本样式的那一列之前，标示该列的文件名称。</span><br><span class="line">-i 胡列字符大小写的差别。</span><br><span class="line">-l 列出文件内容符合指定的范本样式的文件名称。</span><br><span class="line">-L 列出文件内容不符合指定的范本样式的文件名称。</span><br><span class="line">-n 在显示符合范本样式的那一列之前，标示出该列的编号。</span><br><span class="line">-q 不显示任何信息。</span><br><span class="line">-R/-r 此参数的效果和指定“-d recurse”参数相同。</span><br><span class="line">-s 不显示错误信息。</span><br><span class="line">-v 反转查找。</span><br><span class="line">-w 只显示全字符合的列。</span><br><span class="line">-x 只显示全列符合的列。</span><br><span class="line">-y 此参数效果跟“-i”相同。</span><br><span class="line">-o 只输出文件中匹配到的部分。</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<hr>
<h3 id="grep命令常见用法"><a href="#grep命令常见用法" class="headerlink" title="grep命令常见用法"></a>grep命令常见用法</h3><h4 id="在文件中搜索一个单词，命令会返回一个包含“match-pattern”的文本行："><a href="#在文件中搜索一个单词，命令会返回一个包含“match-pattern”的文本行：" class="headerlink" title="在文件中搜索一个单词，命令会返回一个包含“match_pattern”的文本行："></a>在文件中搜索一个单词，命令会返回一个包含“match_pattern”的文本行：</h4><pre><code>grep match_pattern file_name
grep &quot;match_pattern&quot; file_name
</code></pre>
<h4 id="在多个文件中查找："><a href="#在多个文件中查找：" class="headerlink" title="在多个文件中查找："></a>在多个文件中查找：</h4><pre><code>grep &quot;match_pattern&quot; file_1 file_2 file_3 ...
</code></pre>
<h4 id="输出除之外的所有行-v-选项："><a href="#输出除之外的所有行-v-选项：" class="headerlink" title="输出除之外的所有行 -v 选项："></a>输出除之外的所有行 -v 选项：</h4><pre><code>grep -v &quot;match_pattern&quot; file_name
</code></pre>
<h4 id="标记匹配颜色-–color-auto-选项："><a href="#标记匹配颜色-–color-auto-选项：" class="headerlink" title="标记匹配颜色 –color&#x3D;auto 选项："></a>标记匹配颜色 –color&#x3D;auto 选项：</h4><pre><code>grep &quot;match_pattern&quot; file_name --color=auto
</code></pre>
<h4 id="使用正则表达式-E-选项："><a href="#使用正则表达式-E-选项：" class="headerlink" title="使用正则表达式 -E 选项："></a>使用正则表达式 -E 选项：</h4><pre><code>grep -E &quot;[1-9]+&quot; 或 egrep &quot;[1-9]+&quot;
</code></pre>
<h4 id="只输出文件中匹配到的部分-o-选项："><a href="#只输出文件中匹配到的部分-o-选项：" class="headerlink" title="只输出文件中匹配到的部分 -o 选项："></a>只输出文件中匹配到的部分 -o 选项：</h4><pre><code>echo this is a test line. | grep -o -E &quot;[a-z]+\.&quot; line.
echo this is a test line. | egrep -o &quot;[a-z]+\.&quot; line.
</code></pre>
<h4 id="统计文件或者文本中包含匹配字符串的行数-c-选项："><a href="#统计文件或者文本中包含匹配字符串的行数-c-选项：" class="headerlink" title="统计文件或者文本中包含匹配字符串的行数 -c 选项："></a>统计文件或者文本中包含匹配字符串的行数 -c 选项：</h4><pre><code>grep -c &quot;text&quot; file_name
</code></pre>
<h4 id="输出包含匹配字符串的行数-n-选项："><a href="#输出包含匹配字符串的行数-n-选项：" class="headerlink" title="输出包含匹配字符串的行数 -n 选项："></a>输出包含匹配字符串的行数 -n 选项：</h4><pre><code>grep &quot;text&quot; -n file_name 或 cat file_name | grep &quot;text&quot; -n
</code></pre>
<h4 id="多个文件"><a href="#多个文件" class="headerlink" title="多个文件"></a>多个文件</h4><pre><code>grep &quot;text&quot; -n file_1 file_2
</code></pre>
<h4 id="打印样式匹配所位于的字符或字节偏移："><a href="#打印样式匹配所位于的字符或字节偏移：" class="headerlink" title="打印样式匹配所位于的字符或字节偏移："></a>打印样式匹配所位于的字符或字节偏移：</h4><pre><code>echo gun is not unix | grep -b -o &quot;not&quot; 7:not
</code></pre>
<h4 id="一行中字符串的字符便宜是从该行的第一个字符开始计算，起始值为0。选项-b-o-一般总是配合使用。"><a href="#一行中字符串的字符便宜是从该行的第一个字符开始计算，起始值为0。选项-b-o-一般总是配合使用。" class="headerlink" title="一行中字符串的字符便宜是从该行的第一个字符开始计算，起始值为0。选项 -b -o 一般总是配合使用。"></a>一行中字符串的字符便宜是从该行的第一个字符开始计算，起始值为0。选项 -b -o 一般总是配合使用。</h4><h4 id="搜索多个文件并查找匹配文本在哪些文件中："><a href="#搜索多个文件并查找匹配文本在哪些文件中：" class="headerlink" title="搜索多个文件并查找匹配文本在哪些文件中："></a>搜索多个文件并查找匹配文本在哪些文件中：</h4><pre><code>grep -l &quot;text&quot; file1 file2 file3...
</code></pre>
<h4 id="grep递归搜索文件"><a href="#grep递归搜索文件" class="headerlink" title="grep递归搜索文件"></a>grep递归搜索文件</h4><h4 id="在多级目录中对文本进行递归搜索："><a href="#在多级目录中对文本进行递归搜索：" class="headerlink" title="在多级目录中对文本进行递归搜索："></a>在多级目录中对文本进行递归搜索：</h4><pre><code>grep &quot;text&quot; . -r -n
</code></pre>
<h4 id="表示当前目录。"><a href="#表示当前目录。" class="headerlink" title=".表示当前目录。"></a>.表示当前目录。</h4><h4 id="忽略匹配样式中的字符大小写："><a href="#忽略匹配样式中的字符大小写：" class="headerlink" title="忽略匹配样式中的字符大小写："></a>忽略匹配样式中的字符大小写：</h4><pre><code>echo &quot;hello world&quot; | grep -i &quot;HELLO&quot; hello
</code></pre>
<h4 id="选项-e-制动多个匹配样式："><a href="#选项-e-制动多个匹配样式：" class="headerlink" title="选项 -e 制动多个匹配样式："></a>选项 -e 制动多个匹配样式：</h4><pre><code>echo this is a text line | grep -e &quot;is&quot; -e &quot;line&quot; -o is line
</code></pre>
<h4 id="也可以使用-f选项来匹配多个样式，在样式文件中逐行写出需要匹配的字符。"><a href="#也可以使用-f选项来匹配多个样式，在样式文件中逐行写出需要匹配的字符。" class="headerlink" title="也可以使用-f选项来匹配多个样式，在样式文件中逐行写出需要匹配的字符。"></a>也可以使用-f选项来匹配多个样式，在样式文件中逐行写出需要匹配的字符。</h4><pre><code>cat patfile
aaa
bbb
echo aaa bbb ccc ddd eee | grep -f patfile -o
</code></pre>
<h4 id="在grep搜索结果中包括或者排除指定文件："><a href="#在grep搜索结果中包括或者排除指定文件：" class="headerlink" title="在grep搜索结果中包括或者排除指定文件："></a>在grep搜索结果中包括或者排除指定文件：</h4><h4 id="只在目录中所有的-php和-html文件中递归搜索字符”main-”"><a href="#只在目录中所有的-php和-html文件中递归搜索字符”main-”" class="headerlink" title="只在目录中所有的.php和.html文件中递归搜索字符”main()”"></a>只在目录中所有的.php和.html文件中递归搜索字符”main()”</h4><pre><code>grep &quot;main()&quot; . -r --include *.&#123;php,html&#125;
</code></pre>
<h4 id="在搜索结果中排除所有README文件"><a href="#在搜索结果中排除所有README文件" class="headerlink" title="在搜索结果中排除所有README文件"></a>在搜索结果中排除所有README文件</h4><pre><code>grep &quot;main()&quot; . -r --exclude &quot;README&quot;
</code></pre>
<h4 id="在搜索结果中排除filelist文件列表里的文件"><a href="#在搜索结果中排除filelist文件列表里的文件" class="headerlink" title="在搜索结果中排除filelist文件列表里的文件"></a>在搜索结果中排除filelist文件列表里的文件</h4><pre><code>grep &quot;main()&quot; . -r --exclude-from filelist
</code></pre>
<h4 id="使用0值字节后缀的grep与xargs："><a href="#使用0值字节后缀的grep与xargs：" class="headerlink" title="使用0值字节后缀的grep与xargs："></a>使用0值字节后缀的grep与xargs：</h4><h4 id="测试文件："><a href="#测试文件：" class="headerlink" title="测试文件："></a>测试文件：</h4><pre><code>echo &quot;aaa&quot; &gt; file1
echo &quot;bbb&quot; &gt; file2
echo &quot;aaa&quot; &gt; file3
grep &quot;aaa&quot; file* -lZ | xargs -0 rm
</code></pre>
<h4 id="执行后会删除file1和file3，grep输出用-Z选项来指定以0值字节作为终结符文件名（-0），xargs-0-读取输入并用0值字节终结符分隔文件名，然后删除匹配文件，-Z通常和-l结合使用。"><a href="#执行后会删除file1和file3，grep输出用-Z选项来指定以0值字节作为终结符文件名（-0），xargs-0-读取输入并用0值字节终结符分隔文件名，然后删除匹配文件，-Z通常和-l结合使用。" class="headerlink" title="执行后会删除file1和file3，grep输出用-Z选项来指定以0值字节作为终结符文件名（\0），xargs -0 读取输入并用0值字节终结符分隔文件名，然后删除匹配文件，-Z通常和-l结合使用。"></a>执行后会删除file1和file3，grep输出用-Z选项来指定以0值字节作为终结符文件名（\0），xargs -0 读取输入并用0值字节终结符分隔文件名，然后删除匹配文件，-Z通常和-l结合使用。</h4><h4 id="grep静默输出："><a href="#grep静默输出：" class="headerlink" title="grep静默输出："></a>grep静默输出：</h4><pre><code>grep -q &quot;test&quot; filename
</code></pre>
<h4 id="不会输出任何信息，如果命令运行成功返回0，失败则返回非0值。一般用于条件测试。"><a href="#不会输出任何信息，如果命令运行成功返回0，失败则返回非0值。一般用于条件测试。" class="headerlink" title="不会输出任何信息，如果命令运行成功返回0，失败则返回非0值。一般用于条件测试。"></a>不会输出任何信息，如果命令运行成功返回0，失败则返回非0值。一般用于条件测试。</h4><h4 id="打印出匹配文本之前或者之后的行："><a href="#打印出匹配文本之前或者之后的行：" class="headerlink" title="打印出匹配文本之前或者之后的行："></a>打印出匹配文本之前或者之后的行：</h4><h4 id="显示匹配某个结果之后的3行，使用-A-选项："><a href="#显示匹配某个结果之后的3行，使用-A-选项：" class="headerlink" title="显示匹配某个结果之后的3行，使用 -A 选项："></a>显示匹配某个结果之后的3行，使用 -A 选项：</h4><pre><code>seq 10 | grep &quot;5&quot; -A 3
5
6
7
8
</code></pre>
<h4 id="显示匹配某个结果之前的3行，使用-B-选项："><a href="#显示匹配某个结果之前的3行，使用-B-选项：" class="headerlink" title="显示匹配某个结果之前的3行，使用 -B 选项："></a>显示匹配某个结果之前的3行，使用 -B 选项：</h4><pre><code>seq 10 | grep &quot;5&quot; -B 3
2
3
4
5
</code></pre>
<h4 id="显示匹配某个结果的前三行和后三行，使用-C-选项："><a href="#显示匹配某个结果的前三行和后三行，使用-C-选项：" class="headerlink" title="显示匹配某个结果的前三行和后三行，使用 -C 选项："></a>显示匹配某个结果的前三行和后三行，使用 -C 选项：</h4><pre><code>seq 10 | grep &quot;5&quot; -C 3
2
3
4
5
6
7
8
</code></pre>
<h4 id="如果匹配结果有多个，会用“–”作为各匹配结果之间的分隔符："><a href="#如果匹配结果有多个，会用“–”作为各匹配结果之间的分隔符：" class="headerlink" title="如果匹配结果有多个，会用“–”作为各匹配结果之间的分隔符："></a>如果匹配结果有多个，会用“–”作为各匹配结果之间的分隔符：</h4><pre><code>echo -e &quot;a\nb\nc\na\nb\nc&quot; | grep a -A 1
a
b
--
a
b
</code></pre>
]]></content>
      <tags>
        <tag>command</tag>
        <tag>grep</tag>
      </tags>
  </entry>
</search>
